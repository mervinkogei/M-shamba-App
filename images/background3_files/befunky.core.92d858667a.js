!function(){"use strict";function e(){if(navigator.cookieEnabled){var e=window.getCookie("country_code");e&&BeFunky.requestAPI("auth/update-country",{iso:e}).then(function(e){(void 0!==e.error||void 0!==e.data&&"success"!==e.data)&&BeFunky.logError("Unable to update user country",e.error||e),window.setCookie("country_code","",-1)}).catch(function(e){BeFunky.logError("Unable to update user country",e)})}}window.BeFunky=window.BeFunky||{},BeFunky.Init=function(){var t=BeFunky.macOSVersion;BeFunky.isSafari&&t&&(t>=11&&t<=13&&(BeFunky.Params.swfFlashVars.forcejssave=1),t>=13&&(BeFunky.Params.swfFlashVars.forcejsupload=1));var n="en";try{n=window.language.substr(0,2)}catch(e){}if(""===BeFunky.Params.swfFlashVars.language)BeFunky.Params.swfFlashVars.promptLang=n;else{var o=(BeFunky.sessionRoutes[0]||window.location.href.replace(BeFunky.Params.siteUrl,"/")).split("/").filter(Boolean)[0];"en"!==(o=BeFunky.LanguageManager.appLanguages.includes(o)?o:"en")&&BeFunky.Params.swfFlashVars.language!==n&&BeFunky.Params.swfFlashVars.language!==o&&(BeFunky.Params.swfFlashVars.promptLang=o)}if(0==BeFunky.isUseHTML5&&"undefined"!=typeof swfobject&&null!==swfobject){try{document.getElementById("bfn-app").innerHTML=""}catch(e){}var i={id:BeFunky.Params.swfId,name:BeFunky.Params.swfId,src:BeFunky.Params.swfUrl+BeFunky.Params.swfId+".swf",movie:BeFunky.Params.swfUrl+BeFunky.Params.swfId+".swf",align:"middle",style:"background-color:#1e242c;",allowscriptaccess:"always",policyFile:BeFunky.Params.siteUrl+"crossdomain.xml"};swfobject.embedSWF(BeFunky.Params.swfUrl+BeFunky.Params.swfId+".swf","flashContainer",setInitFlashWidth(),setInitFlashHeight(),BeFunky.Params.swfMinVersion,BeFunky.Params.swfUrl+"playerProductInstall.swf",BeFunky.Params.swfFlashVars,{quality:"high",bgcolor:"#2D2D2D",allowscriptaccess:"always",allowFullScreen:"true",allowfullscreeninteractive:"true",wmode:"window"},i);var a=Date.now();BeFunky.waitUntil({condition:function(){return!!document.getElementById(BeFunky.Params.swfId)},onSuccess:function(){var e=Date.now()-a;console.log("Flash <object> injected in "+e/1e3+"s")},onTimeout:function(){BeFunky.logError("Flash <object> NOT injected")},maxAttempts:1e3})}BeFunky.prepareHtml5App(),BeFunky.isUseHTML5||(window.onbeforeunload=function(){if(isFlashOpenned&&isFlashCreationComplated)return"You are about to leave BeFunky, if you do not save your changes they will be lost."});try{BeFunky.Params.isShowAds>0&&0==BeFunky.isUseHTML5&&initAds()}catch(e){}try{BeFunky.isCreateRoute()&&null==$googleDriveState&&(null!==document.getElementById("befunky-state")&&(document.getElementById("befunky-state").style.display="block"),document.querySelector("#chrome-extension-button").addEventListener("click",function(e){var t=document.getElementById("chrome-extension-button").getAttribute("data-url");null!=t&&t.length>0&&(window.bf_eventTrack("EXTERNAL","CHROME_EXTENSION","OPEN"),setTimeout(function(){try{try{setApplicationMode("photoeditor")}catch(e){}if(t.includes("http"))if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).ToJsUrlUploader(t,null,!1)}catch(e){}else try{BFN.BfnService.ToJsUrlUploader(t,null,!0,"chrome_extension")}catch(e){}else{var e=t.split(",");if(t=e[1],0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).ToJsBase64Uploader(t)}catch(e){}else try{BFN.BfnService.ToJsBase64Uploader(t,void 0,"chrome_extension")}catch(e){}}}catch(e){}},1500))}))}catch(e){}requestIdleCallback(e)},BeFunky.signOut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:BeFunky.Params.siteUrl;return BeFunky.requestAPI("auth/sign-out",{},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";t()}).catch(function(e){if("not_logged_in"!==e)return"request_failed"!==e&&BeFunky.throwError("Sign-out failed:",e),Promise.reject(e);t()});function t(){!1!==e&&(window.onbeforeunload=null,window.location.href=e)}},BeFunky.updateLanguage=function(e){return BeFunky.requestAPI("auth/update-language",{lang:e}).then(function(e){if("success"!==e.data)throw"invalid_response"}).catch(function(e){BeFunky.logError("Unable to change language",e)})},window.ready(function(){}),window.defferInit=function(){if(BeFunky.isUseHTML5=window.webgl_is_supported&&"flash"!==window.useAppType,!1!==BeFunky.isUseHTML5)window.swfobject=null,BeFunky.Init();else{var e=function(){window.swfobject=swfobject();try{swfobject.getFlashPlayerVersion().major>=11&&1}catch(e){}CheckVersion(),window._onLoad(function(){BeFunky.Init()})};"undefined"!=typeof swfobject&&null!==swfobject?e():BeFunky.waitUntil({condition:function(){return"undefined"!=typeof swfobject&&null!==swfobject},onSuccess:function(){e()},onTimeout:function(){BeFunky.logError("swf object not loaded")},maxAttempts:1e3})}BeFunky.waitUntil({condition:function(){return void 0!==window.ga&&null!==window.ga},onSuccess:function(){!function(){try{ga("set","dimension2",1==BeFunky.isUseHTML5?"HTML5":"FLASH")}catch(e){}try{ga("send","pageview")}catch(e){}}()},onTimeout:function(){BeFunky.logError("window.ga is not defined")},maxAttempts:5e3})},window.language=window.navigator.languages?window.navigator.languages[0]:window.navigator.language||window.navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage,window.browserlng="en";try{var t=language.substr(0,2);"ar"!=t&&"tr"!=t&&"ru"!=t&&"ko"!=t&&"it"!=t&&"de"!=t&&"es"!=t&&"zh"!=t&&"ja"!=t&&"pt"!=t&&"fr"!=t||(window.browserlng=t)}catch(e){}var n;function o(e){var t=""+(e.getMonth()+1),n=""+e.getDate(),o=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[t,n,o].join("")}Object.assign(BeFunky.Params,{isFlashPlayerCorrect:!0,nextBillingDateMonthly:o((n=new Date,n.setMonth(n.getMonth()+1),n)),nextBillingDateAnnual:o(function(){var e=new Date;return e.setFullYear(e.getFullYear()+1),e}()),isShowAds:0}),BeFunky.User={email:"",username:"",language:"",isNewUser:!1,FlashVarsObject:{user_name:"",email:"",pl:""},counts:{myPhotos:0,followers:0,following:0,publicPhotos:0},aboutYouText:null,profileBackground:null};var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,o)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(o):void 0},l=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},c=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,i=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))},p=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};if(BeFunky.log=function(){},BeFunky.logError=function(){var e;(e=console).error.apply(e,arguments)},BeFunky.throwError=function(e){for(var t,n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];if(!(e instanceof Error||window.DOMError&&e instanceof DOMError))try{e=new Error(e)}catch(t){e=new Error("Unknown error "+(void 0===e?"undefined":i(e)))}(t=BeFunky).logError.apply(t,["Sending "+e.name+" to Sentry:",e.message].concat(o));window.Raven&&"function"==typeof window.Raven.captureException?Raven.captureException(e):setTimeout(function(){throw e},0)},BeFunky.reportUserAction=function(e){console.log("User action:",e)},BeFunky.isEdgeHTML=/Edge\/\d+/.test(navigator.userAgent),BeFunky.isEdge=/Edge?\/\d+/.test(navigator.userAgent),BeFunky.isInternetExplorer=/Trident|MSIE/.test(navigator.userAgent),BeFunky.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),BeFunky.isFirefox=/firefox/i.test(navigator.userAgent),BeFunky.isOpera=/Opera|OPR\//.test(navigator.userAgent),BeFunky.isChromium=window.chrome&&!BeFunky.isEdgeHTML,BeFunky.isChrome=BeFunky.isChromium&&!BeFunky.isOpera&&!BeFunky.isEdge,BeFunky.isMac=navigator.platform.includes("Mac"),BeFunky.isMac){var g=navigator.userAgent.match(/Mac[_ ]OS[_ ]X[_ ]10[_.]([\d]+)/);g&&(BeFunky.macOSVersion=parseInt(g[1]))}BeFunky.isIOS=/iPad|iPhone|iPod/.test(navigator.platform),BeFunky.isSafariMojave=BeFunky.isSafari&&/Mac OS X 10_14/.test(navigator.userAgent),BeFunky.isAndroid=/(android)/i.test(navigator.userAgent),BeFunky.isWindows=navigator.platform.includes("Win"),BeFunky.isDropShadowSupported=!(BeFunky.isChromium&&/Mac OS X 10_(10|11)/.test(navigator.userAgent)),BeFunky.isImageBitmapSupported="createImageBitmap"in window,BeFunky.supportsPointerEvents=!!window.PointerEvent;var h=function(e,t){return[].concat(p(e)).filter(function(e){return e instanceof HTMLElement}).map(function(e){return t(e)})},m=function(e,t){return t(e)};function f(e,t){return function(n){"boolean"!=typeof t&&(t=!n.classList.contains(e)),t?n.classList.add(e):n.classList.remove(e)}}if(NodeList.prototype.setStyles=HTMLCollection.prototype.setStyles=function(e){return h(this,function(t){return Object.assign(t.style,e)}),this},HTMLElement.prototype.setStyles=function(e){return m(this,function(t){return Object.assign(t.style,e)}),this},HTMLElement.prototype.setLang=function(e,t,n){if(!BeFunky.LanguageManager)return BeFunky.throwError("setLang called too early"),this;if(this.onLanguageUpdate&&(this.onLanguageUpdate=void 0),"object"===(void 0===t?"undefined":i(t)))return this.setAttribute("data-lang",e),BeFunky.LanguageManager.registerElement(this,t,n),this;var o=e;return/^[a-z0-9_]+$/.test(e)&&(this.setAttribute("data-lang",e),o=BeFunky.LanguageManager.getString(e,n)),o.includes("<")?this.innerHTML=o:this.textContent=o,this},HTMLElement.prototype.closestParent=function(e){return e(this)?this:this.parentElement?this.parentElement.closestParent(e):void 0},HTMLElement.prototype.hasClass=function(e){return this.classList.contains(e)},HTMLElement.prototype.setClass=function(e){return this.className=e,this},NodeList.prototype.addClass=HTMLCollection.prototype.addClass=function(e){return h(this,function(t){return t.classList.add(e)}),this},HTMLElement.prototype.addClass=function(e){return m(this,function(t){return t.classList.add(e)}),this},NodeList.prototype.removeClass=HTMLCollection.prototype.removeClass=function(e){return h(this,function(t){return t.classList.remove(e)}),this},HTMLElement.prototype.removeClass=function(e){return m(this,function(t){return t.classList.remove(e)}),this},NodeList.prototype.toggleClass=HTMLCollection.prototype.toggleClass=function(e,t){return h(this,f(e,t)),this},HTMLElement.prototype.toggleClass=function(e,t){return m(this,f(e,t)),this},BeFunky.isEdgeHTML||BeFunky.isInternetExplorer||BeFunky.isIOS){var y=HTMLElement.prototype.getBoundingClientRect;HTMLElement.prototype.getBoundingClientRect=function(){var e=y.bind(this)();return e.x=e.left,e.y=e.top,e}}Array.prototype.shuffle=function(){for(var e=this.length,t=void 0,n=void 0;0!==e;)n=Math.floor(Math.random()*e),t=this[e-=1],this[e]=this[n],this[n]=t},Array.prototype.unique=function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e},Array.prototype.isIdenticalTo=function(e){if(!Array.isArray(e))return!1;if(this.length!==e.length)return!1;for(var t=0,n=this.length;t<n;t++)if(Array.isArray(this[t])&&Array.isArray(e[t])){if(!this[t].isIdenticalTo(e[t]))return!1}else if(this[t]!==e[t])return!1;return!0},BeFunky.pointerover=BeFunky.supportsPointerEvents?"pointerover":"mouseover",BeFunky.pointerout=BeFunky.supportsPointerEvents?"pointerout":"mouseout",BeFunky.pointerdown=BeFunky.supportsPointerEvents?"pointerdown":"mousedown",BeFunky.pointermove=BeFunky.supportsPointerEvents?"pointermove":"mousemove",BeFunky.pointerup=BeFunky.supportsPointerEvents?"pointerup":"mouseup";var v={},_=null;Object.defineProperty(BeFunky,"globalPointerCoords",{get:function(){return _&&(v.x=_.pageX,v.y=_.pageY),v}}),Object.defineProperty(BeFunky,"globalPointerEvent",{get:function(){return _}});var k=function(e){_=e};document.addEventListener(BeFunky.pointerdown,k,!0),document.addEventListener(BeFunky.pointermove,k,!0),document.addEventListener(BeFunky.pointerup,k,!0),BeFunky.isPointerDown=!1,document.addEventListener(BeFunky.pointerdown,function(e){e.isTrusted&&(BeFunky.isPointerDown=!0)},!0),document.addEventListener(BeFunky.pointerup,function(e){e.isTrusted&&(BeFunky.isPointerDown=!1)},!0),document.addEventListener("touchstart",function(e){e.isTrusted&&(BeFunky.isPointerDown=!0)},!0),document.addEventListener("touchend",function(e){e.isTrusted&&(BeFunky.isPointerDown=!1)},!0),BeFunky.isTextBoxFocused=function(){var e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&["text","number","search","email","password","tel","url","time","date","datetime-local","month","week"].includes(e.type)},BeFunky.debounce=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=void 0;return function(){var i=this,a=arguments,r=n&&!o,s=function(){o=null,r||e.apply(i,a)};"raf"===t?(cancelAnimationFrame(o),o=requestAnimationFrame(s)):"ric"===t?(cancelIdleCallback(o),o=requestIdleCallback(s)):(clearTimeout(o),o=setTimeout(s,t)),r&&e.apply(i,a)}},BeFunky.throttle=function(e,t){var n=void 0,o=void 0,i=void 0;return function(){var a=this,r=arguments;n?(clearTimeout(o),o=setTimeout(function(){Date.now()-i>=t&&(e.apply(a,r),i=Date.now())},t-(Date.now()-i))):(e.apply(a,r),i=Date.now(),n=!0)}},BeFunky.randomString=function(e){return Math.round(Math.pow(36,e+1)-Math.random()*Math.pow(36,e)).toString(36).slice(1)},BeFunky.hash=function(e){for(var t=0,n=0,o=e.length;n<o;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return t+2147483647+1},BeFunky.getType=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"!==t?t:e&&e.constructor&&e.constructor.name||"Object"},BeFunky.waitUntil=function(e){var t=e.condition,n=e.interval,o=void 0===n?200:n,i=e.maxAttempts,a=void 0===i?10:i,r=e.onSuccess,s=e.onTimeout;if(![t,r,s].every(function(e){return"function"==typeof e}))throw new Error("3 functions must be provided to BeFunky.waitUntil");var l=0;!function e(){if(t())return r();if(l>=a)return s();l++;setTimeout(e,o)}()},BeFunky.getSvgHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.classes,o=void 0===n?"icon":n,i=t.style;if("string"!=typeof o)throw new Error("Invalid SVG class: "+BeFunky.getType(o));return('\n    <svg class="'+o+'" '+(i?'style="'+i+'"':"")+'>\n        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+e+'"></use>\n    </svg>\n    ').trim()},BeFunky.onDocumentReady=function(e){if("interactive"===document.readyState||"complete"===document.readyState)return e();document.addEventListener("DOMContentLoaded",e,!1)},BeFunky.once=function(e,t){var n=void 0;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}},BeFunky.isLoggedIn=function(){return!!window.latestUserData.user_name},BeFunky.isPlus=function(){return"1"===window.latestUserData.pl},BeFunky.callbackTimeout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=!1,o=!1,i=Date.now();return setTimeout(function(){n||(o=!0,BeFunky.throwError("Callback for "+e+" still not called after "+t+"ms"))},t),function(){n||(n=!0,o&&console.log("Callback for "+e+" was eventually called after "+(Date.now()-i)+"ms"))}},BeFunky.stringValue=function(e){var t=BeFunky.getType(e),n=e;if(e instanceof Error||window.DOMError&&e instanceof DOMError)t=e.name||t,n=e.message;else if(e instanceof Blob)n="{ size: "+e.size+", type: "+e.type+" }";else if(e instanceof Event)n="{ type: "+e.type+", target: "+e.target+", currentTarget: "+e.currentTarget+" }";else if("object"===(void 0===e?"undefined":i(e)))try{n=JSON.stringify(e)}catch(e){}else n="string"==typeof n?'"'+n+'"':""+n;return n.length>100&&(n=n.slice(0,100)+"..."),t+": "+n};var b=[],w=BeFunky.debounce(function(){window.BFN&&BFN.isDebugEnabled||requestIdleCallback(function(){BeFunky.waitUntil({condition:function(){return window.ga},onSuccess:function(){console.log("Sending "+b.length+" user timing(s)"),b.splice(0).forEach(function(e){var t;return(t=window).ga.apply(t,["send","timing"].concat(p(e)))})},onTimeout:function(){return BeFunky.throwError("Unable to track user timings")},interval:500,maxAttempts:20})})},2e3);BeFunky.trackUserTiming=function(e,t,n){var o=Date.now(),i=!1;return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now()-o;i||(i=!0,a<=1||(console.log("-- "+e+" timing : "+t+" "+n+" : "+a),BeFunky.Params.enableUserTimings&&(b.push([e,t,a,n]),w())))}},BeFunky.setLocal=function(e,t){try{return localStorage.setItem(e,t),!0}catch(e){return!1}},BeFunky.getLocal=function(e){try{return localStorage.getItem(e)}catch(e){return}},BeFunky.removeLocal=function(e){try{return localStorage.removeItem(e),!0}catch(e){return!1}},BeFunky.getUrlParameter=function(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},window.isRetina=function(){if(window.devicePixelRatio>=1.5||window.matchMedia&&window.matchMedia("\n        (-webkit-min-device-pixel-ratio: 1.5),\n        (min--moz-device-pixel-ratio: 1.5),\n        (-o-min-device-pixel-ratio: 3/2),\n        (min-resolution: 1.5dppx)").matches){if("chrome"in window){var e=window.outerWidth/window.innerWidth;if(e>1.02)return window.devicePixelRatio/e>=1.5}return!0}return!1},Array.prototype.shuffle=function(){for(var e,t,n=this.length;n;e=parseInt(Math.random()*n),t=this[--n],this[n]=this[e],this[e]=t);return this},void 0===Array.prototype.contains&&(Array.prototype.contains=function(e){for(var t=this.length;t--;)if(this[t]===e)return!0;return!1}),BeFunky.inFlightRequests={},BeFunky.request=function(e,t,n){var o=t.headers,i=void 0===o?{}:o,a=t.responseType,r=void 0===a?"json":a,s=t.method,l=void 0===s?"GET":s,u=t.body,c=void 0===u?null:u,d=t.downloadProgressHandler,p=t.uploadProgressHandler,g=t.fallbackURLs,h=void 0===g?[]:g,m="boolean"==typeof t.withCredentials?t.withCredentials:"POST"===l;if(!["","arraybuffer","blob","document","json","text"].includes(r))throw new Error("Invalid responseType: "+BeFunky.stringValue(r));if(!["GET","POST"].includes(l))throw new Error("Invalid method: "+BeFunky.stringValue(r));if(h.length&&(d||p))throw new Error("Cannot use progress w/ fallbackURLs b/c multiple XHR objects are created");if(Array.isArray(h)&&h.length){var f=n;n=function(n){if(n.hasOwnProperty("error")){BeFunky.logError("Failed to fetch URL: "+e.split("/").pop()+". Attempting next fallback URL.",n);var o=t.fallbackURLs.shift();BeFunky.request(o,t,f)}else f(n)}}var y=new XMLHttpRequest,v=BeFunky.inFlightRequests;for(var _ in y.onload=function(){delete v[e];var t=this.response,o=this.status;if("json"===r)try{t=JSON.parse(this.responseText)}catch(e){t=null}if(o<200||o>=400)t&&"string"==typeof t.error?n({error:t.error}):t&&t.error&&t.error.code&&t.error.message?n({error:t.error}):n({error:"invalid_response"});else{if("json"===r&&null===t)return BeFunky.throwError("Got invalid JSON from server",e,y.responseText),n({error:"invalid_response"});t.error&&BeFunky.throwError("Status code does not match response",JSON.stringify({url:e,status:o,response:t})),n({response:t})}},y.onerror=y.onabort=y.ontimeout=function(){delete v[e],n({error:"request_failed"})},d&&BeFunky.addProgressHandler(y,d),p&&BeFunky.addProgressHandler(y,p,!0),y.withCredentials=m,y.open(l,e,!0),"json"!==r&&(y.responseType=r),i)y.setRequestHeader(_,i[_]);e.includes("/api/")&&"POST"===l&&!i["X-CSRF-Token"]&&y.setRequestHeader("X-CSRF-Token",getCsToken()),y.wasAborted=!1,y.wasSent=!1;var k=y.abort;return y.abort=function(){y.wasSent?(y.wasAborted=!0,k.call(y)):y.wasAborted||(y.wasAborted=!0,y.onabort())},navigator.onLine?(y.wasSent=!0,y.send(c)):BeFunky.whenOnline().then(function(){y.wasAborted||(y.wasSent=!0,y.send(c))}),v[e]=y,y},BeFunky.requestAPI=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,a=new Promise(function(a,r){e.endsWith("/")||(e+="/");var s=getCsToken();t.CSRFtoken=s;var l=BeFunky.Params.siteUrl+"api/"+e,u={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":s},body:Object.entries(t).map(function(e){var t=c(e,2),n=t[0],o=t[1];return n+"="+encodeURIComponent(o)}).join("&")},d=Object.assign({},u,n);n.showLoadScreen&&("object"===i(n.showLoadScreen)?BeFunky.showLoadScreen(n.showLoadScreen):BeFunky.showLoadScreen()),o=BeFunky.request(l,d,function(e){var t=e.error,o=e.response;return n.showLoadScreen&&BeFunky.hideLoadScreen(),t?r(t):o&&o.data?void a(o):r("invalid_response")})});return a.request=o,a},BeFunky.addProgressHandler=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function o(e){e&&e.lengthComputable&&t(e.loaded,e.total)}!n&&e&&null===e.onprogress?e.onprogress=o:n&&e&&e.upload&&null===e.upload.onprogress&&(e.upload.onprogress=o)},BeFunky.failureReason=function(e){return"string"!=typeof e?"Unknown request error: "+BeFunky.getType(e):"not_logged_in"===e&&BeFunky.isLoggedIn()?BeFunky.LanguageManager.getString("acknowledge_session_expired"):/^[a-z0-9_]+$/.test(e)?BeFunky.LanguageManager.getString("error_"+e):"Error: "+e};var F=!1,B=function(){};BeFunky.whenOnline=function(){return!1!==navigator.onLine?Promise.resolve():(this.offlineMessageDisplayed||(BeFunky.logError("User is offline"),BeFunky.acknowledge?(B=BeFunky.acknowledge("user_offline",{isCritical:!0}),F=!0):setTimeout(function(){!1===navigator.onLine&&(B=BeFunky.acknowledge("user_offline",{isCritical:!0}),F=!0)},0)),new Promise(function(e){window.addEventListener("online",function(){F&&BeFunky.logError("User is back online"),e(),B(),F=!1})}))},BeFunky.loadScriptWithXHR=function(e){return new Promise(function(t,n){BeFunky.request(e,{responseType:"text"},function(e){var o=e.error,i=e.response;if(o)return n(o);var a=document.createElement("script"),r=document.getElementsByTagName("script")[0].parentElement;a.text=i,r.appendChild(a),t()})})};var E=new WeakMap,S=function(e){return"function"==typeof e&&E.has(e)},I=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,C=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t!==n;){var o=t.nextSibling;e.removeChild(t),t=o}},L={},P={},x="{{lit-"+String(Math.random()).slice(2)+"}}",A="\x3c!--"+x+"--\x3e",T=new RegExp(x+"|"+A),R=function e(t,n){a(this,e),this.parts=[],this.element=n;for(var o=[],i=[],r=document.createTreeWalker(n.content,133,null,!1),s=0,l=-1,u=0,c=t.strings,d=t.values.length;u<d;){var p=r.nextNode();if(null!==p){if(l++,1===p.nodeType){if(p.hasAttributes()){for(var g=p.attributes,h=g.length,m=0,f=0;f<h;f++)M(g[f].name,"$lit$")&&m++;for(;m-- >0;){var y=c[u],v=O.exec(y)[2],_=v.toLowerCase()+"$lit$",k=p.getAttribute(_);p.removeAttribute(_);var b=k.split(T);this.parts.push({type:"attribute",index:l,name:v,strings:b}),u+=b.length-1}}"TEMPLATE"===p.tagName&&(i.push(p),r.currentNode=p.content)}else if(3===p.nodeType){var w=p.data;if(w.indexOf(x)>=0){for(var F=p.parentNode,B=w.split(T),E=B.length-1,S=0;S<E;S++){var I=void 0,C=B[S];if(""===C)I=U();else{var L=O.exec(C);null!==L&&M(L[2],"$lit$")&&(C=C.slice(0,L.index)+L[1]+L[2].slice(0,-"$lit$".length)+L[3]),I=document.createTextNode(C)}F.insertBefore(I,p),this.parts.push({type:"node",index:++l})}""===B[E]?(F.insertBefore(U(),p),o.push(p)):p.data=B[E],u+=E}}else if(8===p.nodeType)if(p.data===x){var P=p.parentNode;null!==p.previousSibling&&l!==s||(l++,P.insertBefore(U(),p)),s=l,this.parts.push({type:"node",index:l}),null===p.nextSibling?p.data="":(o.push(p),l--),u++}else for(var A=-1;-1!==(A=p.data.indexOf(x,A+1));)this.parts.push({type:"node",index:-1}),u++}else r.currentNode=i.pop()}var R=!0,D=!1,N=void 0;try{for(var H,j=o[Symbol.iterator]();!(R=(H=j.next()).done);R=!0){var q=H.value;q.parentNode.removeChild(q)}}catch(e){D=!0,N=e}finally{try{!R&&j.return&&j.return()}finally{if(D)throw N}}},M=function(e,t){var n=e.length-t.length;return n>=0&&e.slice(n)===t},D=function(e){return-1!==e.index},U=function(){return document.createComment("")},O=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=\/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/,N=function(){function e(t,n,o){a(this,e),this.__parts=[],this.template=t,this.processor=n,this.options=o}return r(e,[{key:"update",value:function(e){var t=0,n=!0,o=!1,i=void 0;try{for(var a,r=this.__parts[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value;void 0!==s&&s.setValue(e[t]),t++}}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}var l=!0,u=!1,c=void 0;try{for(var d,p=this.__parts[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var g=d.value;void 0!==g&&g.commit()}}catch(e){u=!0,c=e}finally{try{!l&&p.return&&p.return()}finally{if(u)throw c}}}},{key:"_clone",value:function(){for(var e=I?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],n=this.template.parts,o=document.createTreeWalker(e,133,null,!1),i=0,a=0,r=void 0,s=o.nextNode();i<n.length;)if(r=n[i],D(r)){for(;a<r.index;)a++,"TEMPLATE"===s.nodeName&&(t.push(s),o.currentNode=s.content),null===(s=o.nextNode())&&(o.currentNode=t.pop(),s=o.nextNode());if("node"===r.type){var l=this.processor.handleTextExpression(this.options);l.insertAfterNode(s.previousSibling),this.__parts.push(l)}else{var u;(u=this.__parts).push.apply(u,p(this.processor.handleAttributeExpressions(s,r.name,r.strings,this.options)))}i++}else this.__parts.push(void 0),i++;return I&&(document.adoptNode(e),customElements.upgrade(e)),e}}]),e}(),H=" "+x+" ",j=function(){function e(t,n,o,i){a(this,e),this.strings=t,this.values=n,this.type=o,this.processor=i}return r(e,[{key:"getHTML",value:function(){for(var e=this.strings.length-1,t="",n=!1,o=0;o<e;o++){var i=this.strings[o],a=i.lastIndexOf("\x3c!--");n=(a>-1||n)&&-1===i.indexOf("--\x3e",a+1);var r=O.exec(i);t+=null===r?i+(n?H:A):i.substr(0,r.index)+r[1]+r[2]+"$lit$"+r[3]+x}return t+=this.strings[e]}},{key:"getTemplateElement",value:function(){var e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}]),e}(),q=(function(e){function t(){return a(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}l(t,j),r(t,[{key:"getHTML",value:function(){return"<svg>"+s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getHTML",this).call(this)+"</svg>"}},{key:"getTemplateElement",value:function(){var e=s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getTemplateElement",this).call(this),n=e.content,o=n.firstChild;return n.removeChild(o),function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t!==n;){var i=t.nextSibling;e.insertBefore(t,o),t=i}}(n,o.firstChild),e}}])}(),function(e){return null===e||!("object"===(void 0===e?"undefined":i(e))||"function"==typeof e)}),V=function(e){return Array.isArray(e)||!(!e||!e[Symbol.iterator])},G=function(){function e(t,n,o){a(this,e),this.dirty=!0,this.element=t,this.name=n,this.strings=o,this.parts=[];for(var i=0;i<o.length-1;i++)this.parts[i]=this._createPart()}return r(e,[{key:"_createPart",value:function(){return new W(this)}},{key:"_getValue",value:function(){for(var e=this.strings,t=e.length-1,n="",o=0;o<t;o++){n+=e[o];var i=this.parts[o];if(void 0!==i){var a=i.value;if(q(a)||!V(a))n+="string"==typeof a?a:String(a);else{var r=!0,s=!1,l=void 0;try{for(var u,c=a[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;n+="string"==typeof d?d:String(d)}}catch(e){s=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw l}}}}}return n+=e[t]}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}]),e}(),W=function(){function e(t){a(this,e),this.value=void 0,this.committer=t}return r(e,[{key:"setValue",value:function(e){e===L||q(e)&&e===this.value||(this.value=e,S(e)||(this.committer.dirty=!0))}},{key:"commit",value:function(){for(;S(this.value);){var e=this.value;this.value=L,e(this)}this.value!==L&&this.committer.commit()}}]),e}(),z=function(){function e(t){a(this,e),this.value=void 0,this.__pendingValue=void 0,this.options=t}return r(e,[{key:"appendInto",value:function(e){this.startNode=e.appendChild(U()),this.endNode=e.appendChild(U())}},{key:"insertAfterNode",value:function(e){this.startNode=e,this.endNode=e.nextSibling}},{key:"appendIntoPart",value:function(e){e.__insert(this.startNode=U()),e.__insert(this.endNode=U())}},{key:"insertAfterPart",value:function(e){e.__insert(this.startNode=U()),this.endNode=e.endNode,e.endNode=this.startNode}},{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){for(;S(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=L,e(this)}var t=this.__pendingValue;t!==L&&(q(t)?t!==this.value&&this.__commitText(t):t instanceof j?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):V(t)?this.__commitIterable(t):t===P?(this.value=P,this.clear()):this.__commitText(t))}},{key:"__insert",value:function(e){this.endNode.parentNode.insertBefore(e,this.endNode)}},{key:"__commitNode",value:function(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}},{key:"__commitText",value:function(e){var t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}},{key:"__commitTemplateResult",value:function(e){var t=this.options.templateFactory(e);if(this.value instanceof N&&this.value.template===t)this.value.update(e.values);else{var n=new N(t,e.processor,this.options),o=n._clone();n.update(e.values),this.__commitNode(o),this.value=n}}},{key:"__commitIterable",value:function(t){Array.isArray(this.value)||(this.value=[],this.clear());var n=this.value,o=0,i=void 0,a=!0,r=!1,s=void 0;try{for(var l,u=t[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;void 0===(i=n[o])&&(i=new e(this.options),n.push(i),0===o?i.appendIntoPart(this):i.insertAfterPart(n[o-1])),i.setValue(c),i.commit(),o++}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}o<n.length&&(n.length=o,this.clear(i&&i.endNode))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startNode;C(this.startNode.parentNode,e.nextSibling,this.endNode)}}]),e}(),X=function(){function e(t,n,o){if(a(this,e),this.value=void 0,this.__pendingValue=void 0,2!==o.length||""!==o[0]||""!==o[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=n,this.strings=o}return r(e,[{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){for(;S(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=L,e(this)}if(this.__pendingValue!==L){var t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=L}}}]),e}(),J=function(e){function t(e,n,o){a(this,t);var i=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));return i.single=2===o.length&&""===o[0]&&""===o[1],i}return l(t,G),r(t,[{key:"_createPart",value:function(){return new Y(this)}},{key:"_getValue",value:function(){return this.single?this.parts[0].value:s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getValue",this).call(this)}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}]),t}(),Y=function(e){function t(){return a(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,W),t}(),$=!1;try{var K={get capture(){return $=!0,!1}};window.addEventListener("test",K,K),window.removeEventListener("test",K,K)}catch(e){}var Q=function(){function e(t,n,o){var i=this;a(this,e),this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=n,this.eventContext=o,this.__boundHandleEvent=function(e){return i.handleEvent(e)}}return r(e,[{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){for(;S(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=L,e(this)}if(this.__pendingValue!==L){var t=this.__pendingValue,n=this.value,o=null==t||null!=n&&(t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive),i=null!=t&&(null==n||o);o&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=Z(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=L}}},{key:"handleEvent",value:function(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}]),e}(),Z=function(e){return e&&($?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)},ee=new(function(){function e(){a(this,e)}return r(e,[{key:"handleAttributeExpressions",value:function(e,t,n,o){var i=t[0];return"."===i?new J(e,t.slice(1),n).parts:"@"===i?[new Q(e,t.slice(1),o.eventContext)]:"?"===i?[new X(e,t.slice(1),n)]:new G(e,t,n).parts}},{key:"handleTextExpression",value:function(e){return new z(e)}}]),e}());function te(e){var t=ne.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},ne.set(e.type,t));var n=t.stringsArray.get(e.strings);if(void 0!==n)return n;var o=e.strings.join(x);return void 0===(n=t.keyString.get(o))&&(n=new R(e,e.getTemplateElement()),t.keyString.set(o,n)),t.stringsArray.set(e.strings,n),n}var ne=new Map,oe=new WeakMap,ie=function(e,t,n){var o=oe.get(t);void 0===o&&(C(t,t.firstChild),oe.set(t,o=new z(Object.assign({templateFactory:te},n))),o.appendInto(t)),o.setValue(e),o.commit()};(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");var ae,re=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return new j(e,n,"html",ee)},se=d(['<svg class="','" style="','">\n    <use xlink:href="','"></use>\n</svg>'],['<svg class="','" style="','">\n    <use xlink:href="','"></use>\n</svg>']),le=document.createElement("div"),ue=(ae=function(e,t){return function(n){return n.committer.element.setAttributeNS(e,n.committer.name,t)}},function(){var e=ae.apply(void 0,arguments);return E.set(e,!0),e});BeFunky.lit={lang:function(e,t){return Array.isArray(e)?re([BeFunky.LanguageManager.getStringReplacements(e[0],e[1],t)]):re([BeFunky.LanguageManager.getString(e,t)])},icon:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"icon",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return ie(function(e,t,n){return re(se,t,n,ue("http://www.w3.org/1999/xlink","#"+e))}(e,t,n),le),le.firstElementChild.cloneNode(!0)},elem:function(){var e=document.createElement("div");return ie(re.apply(void 0,arguments),e),e.firstElementChild},html:re,string:function(e,t){var n=document.createElement("string");return Array.isArray(e)?n.setLang(e[0],e[1],t):n.setLang(e,void 0,t),n},setupState:function(e,t){var n={},o={};Object.entries(e).forEach(function(e){var t=c(e,2),i=t[0],a=t[1];n[i]=a,Object.defineProperty(o,i,{get:function(){return n[i]}})});return t({}),[o,function(e){var o=function(e,t){var n=!1,o={};return Object.entries(t).forEach(function(t){var i=c(t,2),a=i[0],r=i[1];r!==e[a]&&(n=!0,o[a]=[e[a],r],e[a]=r)}),{hasUpdated:n,updates:o}}(n,e),i=o.hasUpdated,a=o.updates;i&&t(a)}]},render:ie};var ce=function(){function e(){a(this,e),this.init()}return r(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){var e=this;this.appLanguages=["en","es","pt","fr","de","it","tr","zh","ja","ko","ru","no","ar"],this.siteLanguages=["en","es","pt","fr","it"],this.contexts=["app","site","modal"],this.isDocumentReady=!1,BeFunky.onDocumentReady(function(){e.isDocumentReady=!0}),this.languageData=this.appLanguages.reduce(function(e,t){return e[t]={},e},{}),this.languageUpdateListeners=[],this.loadingPromises={},this.loadedLanguages=[],this.queueLanguageRender=BeFunky.debounce(this.renderLanguageStrings.bind(this),"raf"),this.defaultLanguage="en";var t=getCookie("lang"),n=document.documentElement.lang,o=[t,n,this.defaultLanguage].find(function(t){return e.appLanguages.includes(t)}),i=void 0;i="true"===document.documentElement.getAttribute("data-use-app-lang")?o:[n,this.defaultLanguage].find(function(t){return e.appLanguages.includes(t)}),this._language={app:o,site:i,modal:i},BeFunky.Params.swfFlashVars.language=o,this.loadLanguage(i).then(function(){return e.queueLanguageRender()},function(){}),this.loadLanguage(o).then(function(){return e.queueLanguageRender()},function(){})}},{key:"loadLanguage",value:function(e){var t=this;if(!this.appLanguages.includes(e))throw new Error("Invalid language ID");if(this.loadingPromises[e])return this.loadingPromises[e];var n=""+e+BeFunky.Params.languageVersions[e]+".json",o=BeFunky.Params.globalAssetsPath+"languages/all/"+n,a=new Promise(function(n,a){BeFunky.request(o,{},function(o){var r=o.response,s=o.error;if(s||!r||"object"!==(void 0===r?"undefined":i(r)))return t.loadingPromises[e]=void 0,BeFunky.logError('Unable to get translations for language "'+e+'"',s||"invalid_response"),a(s||"invalid_response");t.languageData[e]=r,t.loadedLanguages.push(e),n(r)})});return this.loadingPromises[e]=a,a}},{key:"setLanguage",value:function(e,t){var n=this;if(!this.appLanguages.includes(e))throw new Error("Invalid language ID");if(!Array.isArray(t)||!t.every(function(e){return n.contexts.includes(e)}))throw new Error("Invalid language context");t.forEach(function(t){n._language[t]!==e&&(n._language[t]=e,n.loadLanguage(e).then(function(){return n.queueLanguageRender()},function(){}))});var o=window.isFlashOpenned?this._language.app:this._language.site;this.language.modal!==o&&(this._language.modal=o,this.loadLanguage(o).then(function(){return n.queueLanguageRender()},function(){})),t.includes("app")&&(BeFunky.Params.swfFlashVars.language=this.language.app,window.BFN&&BFN.SettingsManager&&BFN.SettingsManager.updateSetting("language",this.language.app),window.BFN&&BFN.userVo&&(BFN.userVo.language=this.language.app))}},{key:"renderLanguageStrings",value:function(e){var t=this;if(!this.isDocumentReady)return this.queueLanguageRender();this.lastRender=this.lastRender||{app:"",site:"",modal:""};var n=[];Object.entries(this.lastRender).forEach(function(o){var i=c(o,2),a=i[0],r=i[1],s=t.language[a];if(s!==r){if("app"===a&&!BeFunky.appTemplatePosted)return;if(!t.loadedLanguages.includes(s))return;!function(e,t){e.forEach(function(e){if("function"!=typeof e.onLanguageUpdate){var n=e.getAttribute("data-lang");if(n.startsWith("<"))e.innerHTML=n;else{var o=BeFunky.LanguageManager.getString(n,t);"INPUT"===e.nodeName?e.setAttribute("placeholder",o):o.includes("<")?e.innerHTML=o:e.textContent=o}}else e.onLanguageUpdate()})}(function(t){if("app"===t)return[].concat(p(e?e.querySelectorAll("[data-lang]"):document.querySelectorAll("#bfn-app [data-lang]")));if("site"===t)return[].concat(p(document.querySelectorAll("#site_root [data-lang]")));if("modal"===t)return[].concat(p(document.querySelectorAll(".modal [data-lang], .dialog [data-lang]")))}(a),a),t.lastRender[a]=s,n.push(a)}}),n.length&&this.languageUpdateListeners.forEach(function(e){e(n)})}},{key:"registerElement",value:function(e,t,n){var o=this;if(!e||!e.dataset.lang)return BeFunky.logError("Element must have a data-lang attribute.");var i=e.dataset.lang;e.onLanguageUpdate=function(){e.innerHTML=o.getStringReplacements(i,t,n)},e.onLanguageUpdate()}},{key:"getString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"app";if("string"!=typeof e)return BeFunky.throwError(BeFunky.getType(e)+" passed to LanguageManger.getString",e),"";if(!this.contexts.includes(t))return BeFunky.throwError('Invalid context "'+t+'" passed to LanguageManger.getString'),"";var n=this.language[t],o=this.languageData[n][e];if(o)return o;if(n!==this.defaultLanguage){var i=this.languageData[this.defaultLanguage][e];if(i)return i}return/^[a-z0-9_]+$/.test(e)?e.split("_").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" "):e}},{key:"isTranslated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"app";return!!this.languageData[this.language[t]][e]}},{key:"getStringReplacements",value:function(e,t,n){return e=this.getString(e,n),Object.keys(t).forEach(function(n){var o=t[n];if("function"==typeof o&&(o=o()),"string"!=typeof o)return BeFunky.throwError("Invalid string replacement: "+BeFunky.getType(o),o);e=e.split("{{"+n+"}}").join(o)}),e}},{key:"addLanguageUpdateListener",value:function(e){this.languageUpdateListeners.includes(e)||this.languageUpdateListeners.push(e)}},{key:"removeLanguageUpdateListener",value:function(e){var t=this.languageUpdateListeners.indexOf(e);-1!==t&&this.languageUpdateListeners.splice(t,1)}},{key:"handleUserUpdateLanguage",value:function(e){this.setLanguage(e,["app"]),BFN&&BFN.BfnService&&BFN.BfnService.track("CREATE","LANGUAGE",this.language.app.toUpperCase())}},{key:"language",get:function(){return this._language}}]),e}();BeFunky.LanguageManager=new ce;var de=["#E14A43","#FB9F39","#F5E949","#B7D93F","#67C369","#6A91CD","#966DB8","#CF6399"],pe=[0,2,4,6,1,3,5,7],ge=24,he=Math.sqrt(Math.pow(ge,2)/2);function me(){(function(){this.animationFactor=0,this.running=!1,this.active=!1,this.show=function(){this.style.display="block",this.bladeContainer.classList.add("animate-iris-blade-container");for(var e=0;e<this.bladeHolders.length;e++){var t=this.bladeHolders[e];t.classList.add("animate-iris-blade-holder")}}.bind(this),this.hide=function(){this.style.display="none",this.bladeContainer.classList.remove("animate-iris-blade-container");for(var e=0;e<this.bladeHolders.length;e++){var t=this.bladeHolders[e];t.classList.remove("animate-iris-blade-holder")}}.bind(this),this.style.position="relative",this.style.pointerEvents="none",this.style.width=2*ge+"px",this.style.height=2*ge+"px",this.style.display="none"}).call(this),function(){this.bladeContainer=document.createElement("div"),this.bladeContainer.style.position="absolute",this.bladeContainer.style.left=ge+"px",this.bladeContainer.style.top=ge+"px",this.appendChild(this.bladeContainer)}.call(this),function(){this.bladeHolders=[];for(var e=0;e<pe.length;e++){var t=pe[e],n=de[t],o=t/de.length*(2*Math.PI),i=document.createElement("div");i.id="blade_holder_"+t,i.style.position="absolute",i.style.left=Math.cos(o)*ge-Math.cos(o+Math.PI/2)*(ge/1.5)+"px",i.style.top=Math.sin(o)*ge-Math.sin(o+Math.PI/2)*(ge/1.5)+"px",this.bladeContainer.appendChild(i),this.bladeHolders.push(i);var a=document.createElement("div");a.id="blade_"+t,a.style.position="absolute",a.style.transform="rotate("+o*(180/Math.PI)+"deg)",i.appendChild(a);var r=document.createElement("div");r.id="blade_graphic_"+t,r.style.position="absolute",r.style.backgroundColor="rgba(0,0,0,0)",r.style.transform="rotate(-45deg)",r.style.left="-"+he+"px",r.style.bottom="-"+(ge+he)+"px",r.style.border=he+1+"px solid rgba(0,0,0,0)",r.style.borderTop=he+1+"px solid "+n,r.style.opacity=.8,a.appendChild(r)}}.call(this)}var fe=function(){var e=document.createElement("div").setClass("load-screen");e.id="load_screen_root";var t=document.createElement("div").addClass("load-screen__iris");n=t,me.call(n);var n;var o=document.createElement("div").addClass("load-screen__message");return e.appendChild(t),e.appendChild(o),BeFunky.onDocumentReady(function(){e.parentElement||document.body.appendChild(e)}),function(e){var t=function(){return BeFunky.confirm("confirm_cancel",{onConfirm:function(){Ie=void 0,Ce(),"function"==typeof Se&&Se()},onCancel:function(){Ie=void 0},confirmText:"yes",cancelText:"no"})};e.addEventListener("click",function(){Ee&&(Ie=t())}),document.addEventListener("keyup",function(e){if(be&&!Ie&&27===e.which){var n=BeFunky.getModal();n&&n.isDialog||(e.stopImmediatePropagation(),Ee&&(Ie=t()))}})}(e),{containerElement:e,irisElement:t,messageElement:o}}(),ye=fe.containerElement,ve=fe.irisElement,_e=fe.messageElement,ke="load-screen--active",be=!1,we=!1,Fe="",Be=void 0,Ee=!1,Se=void 0,Ie=void 0;function Ce(){be&&(be=!1,ye.removeClass(ke),_e.innerHTML="",Fe="",Le(!1),"function"==typeof Ie&&Ie())}function Le(e){we!==e&&(we=e,e?ve.show():ve.hide())}BeFunky.showLoadScreen=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=void 0===t?"":t,o=e.showIris,i=void 0===o||o,a=e.progress,r=void 0===a?"":a,s=e.isCancellable,l=void 0===s||s,u=e.onCancel;be=!0;var c="";n&&(c+=function(e){try{return BeFunky.LanguageManager.getString(e)}catch(t){return e}}(n)),"number"==typeof r&&(r+="%"),"string"==typeof r&&r&&(c+=' <strong class="load-screen__progress">'+r+"</strong>"),_e.innerHTML=c,Fe=n,Le(i),n||i||BeFunky.throwError("Please specify a message when hiding the load screen iris"),ye.addClass(ke),function(e,t){if(clearTimeout(Be),Ee=!1,e){var n="function"==typeof t?500:1500;Be=setTimeout(function(){Ee=!0,Se=t},n)}}(l,u)},BeFunky.hideLoadScreen=Ce,BeFunky.moveLoadScreen=function(e){e!==ye.parentElement&&e.appendChild(ye)},BeFunky.getLoadScreenMessage=function(){return Fe},BeFunky.isLoadScreenActive=function(){return be};var Pe=document.createElement("div").addClass("notifications");function xe(e){return!("string"!=typeof e||!e.length)||!(!Array.isArray(e)||"string"!=typeof e[0]||!e[0].length)}function Ae(e){e&&Pe.removeChild(e)}BeFunky.onDocumentReady(function(){var e=document.querySelector(".section");e?e.insertBefore(Pe,e.firstChild):window.location.href.includes("/index-ui.html")||BeFunky.logError("Failed to append notifications container b/c section was not found")}),BeFunky.showNotification=function(e){var t=e.message,n=e.button,o=e.isDismissable,i=void 0===o||o,a=e.onDismiss,r=e.type,s=void 0===r?"error":r;if(!xe(t))throw new Error("Invalid message");if(n&&!xe(n.text))throw new Error("Invalid button");if(!["error","warning","success"].includes(s))throw new Error("Invalid type");n&&"function"!=typeof n.onClick&&(n.onClick=function(){}),"function"!=typeof a&&(a=function(){});var l=document.createElement("div").setClass("notification notification--"+s),u=document.createElement("string").setLang(t),c=void 0;n&&(c=document.createElement("button").setLang(n.text).setClass("button button--small button--link")).addEventListener("click",n.onClick);var d=document.createElement("div").setClass("notification__content");if(d.appendChild(u),c&&d.appendChild(c),l.appendChild(d),i){var p=document.createElement("button").setClass("button button--transparent button--icon button--small");p.innerHTML=BeFunky.getSvgHtml("global-cancel-icon",{classes:"icon icon-size-small"}),p.addEventListener("click",function(){a(),Ae(l)}),l.appendChild(p)}return function(e){Pe.insertBefore(e,Pe.firstChild)}(l),window.scrollTo(0,0),function(){return Ae(l)}};var Te="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)};function Re(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function Me(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&Re(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function De(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function Ue(e){return e.replace(/\/$/,"").split("/").length}function Oe(e,t){return Ue(t)-Ue(e)}function Ne(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map(function(t){var n=function(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(Me.PARAMETER_REGEXP,function(e,n,o){return t.push(o),Me.REPLACE_VARIABLE_REGEXP}).replace(Me.WILDCARD_REGEXP,Me.REPLACE_WILDCARD)+Me.FOLLOWED_BY_SLASH_REGEXP,Me.MATCH_REGEXP_FLAGS),paramNames:t}}(De(t.route)),o=n.regexp,i=n.paramNames,a=e.replace(/^\/+/,"/").match(o),r=function(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce(function(e,n,o){return null===e&&(e={}),e[t[o]]=decodeURIComponent(n),e},null):null}(a,i);return!!a&&{match:a,route:t,params:r}}).filter(function(e){return e})}function He(e,t){return Ne(e,t)[0]||!1}function je(e,t){var n=t.map(function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]}),o=De(e);return n.length>1?n.reduce(function(e,t){return e.length>t.length&&(e=t),e},n[0]):1===n.length?n[0]:o}function qe(e,t,n){var o,i=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),Re()&&!t?i(e).split(n)[0]:(o=e.split(n)).length>1?i(o[1]):i(o[0])}function Ve(e,t,n){if(t&&"object"===(void 0===t?"undefined":Te(t))){if(t.before)return void t.before(function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e(),t.after&&t.after(n))},n);if(t.after)return e(),void(t.after&&t.after(n))}e()}Me.prototype={helpers:{match:He,root:je,clean:De,getOnlyURL:qe},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var i=n[1];"object"===Te(n[1])&&(i=n[1].uses),this._defaultHandler={handler:i,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===Te(n[0])){Object.keys(n[0]).sort(Oe).forEach(function(t){e.on(t,n[0][t])})}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce(function(t,n){return n.handler!==e&&t.push(n),t},[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,o=this,i=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(i=i.replace(new RegExp("^/"+this._hash),"/"));var a=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),r=qe(i,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&r===this._lastRouteResolved.url&&a===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=He(r,this._routes))?(this._callLeave(),this._lastRouteResolved={url:r,query:a,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,Ve(function(){Ve(function(){n.route.route instanceof RegExp?t.apply(void 0,n.match.slice(1,n.match.length)):t(n.params,a)},n.route.hooks,n.params,o._genericHooks)},this._genericHooks,n.params),n):this._defaultHandler&&(""===r||"/"===r||r===this._hash||function(e,t,n){if(Re()&&!t)return!1;if(!e.match(n))return!1;var o=e.split(n);return o.length<2||""===o[1]}(r,this._useHash,this._hash))?(Ve(function(){Ve(function(){o._callLeave(),o._lastRouteResolved={url:r,query:a,hooks:o._defaultHandler.hooks},o._defaultHandler.handler(a)},o._defaultHandler.hooks)},this._genericHooks),!0):(this._notFoundHandler&&Ve(function(){Ve(function(){o._callLeave(),o._lastRouteResolved={url:r,query:a,hooks:o._notFoundHandler.hooks},o._notFoundHandler.handler(a)},o._notFoundHandler.hooks)},this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach(function(t){t.hasListenerAttached||(t.addEventListener("click",function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var o=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(o.replace(/\/+$/,"").replace(/^\/+/,"/")))}),t.hasListenerAttached=!0)})},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce(function(n,o){var i;if(o.name===e)for(i in n=o.route,t)n=n.toString().replace(":"+i,t[i]);return n},"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){Re()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===t?"undefined":Te(t))?{route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}:{route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root?this.root:(this.root=je(this._cLoc().split("?")[0],this._routes),this.root)},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,o=void 0;(o=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(o,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:De(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},Me.PARAMETER_REGEXP=/([:*])(\w+)/g,Me.WILDCARD_REGEXP=/\*/g,Me.REPLACE_VARIABLE_REGEXP="([^/]+)",Me.REPLACE_WILDCARD="(?:.*)",Me.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",Me.MATCH_REGEXP_FLAGS="";var Ge=BeFunky.Params.siteUrl.replace(/\/$/,""),We=new Me(Ge),ze=!1,Xe=void 0,Je=window.location.href.replace(Ge,"");if(Je.includes("//")){var Ye=window.location.href.replace(Je,"");Je=Je.replace(/\/+/g,"/");try{window.history.replaceState({},"",Ye+Je),BeFunky.logError("Removed duplicate slash from URL. Referrer = ",document.referrer)}catch(e){BeFunky.throwError(e)}}function $e(e){var t=e&&e.deepLink?e.deepLink:"";Ze(function(){if(!window.isFlashOpenned){if(BeFunky.myPhotosPage&&BeFunky.myPhotosPage.imageToEdit){var e=BeFunky.myPhotosPage.imageToEdit;return BeFunky.myPhotosPage.imageToEdit="",window.openUploadPanel({type:"photoeditor",img:e,ignoreExistingProject:!0})}window.openUploadPanel(t)}})}BeFunky.sessionRoutes=[Je],BeFunky.isReplacingRoute=!1,BeFunky.pushRoute=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((e=e.replace(/\/?(\?|#|$)/,"/$1")).startsWith("/")||(e="/"+e),!ze){if(at(e)===at(window.location.href))return;return BeFunky.logError("Queuing up route "+e+" while waiting on initial route resolution"),void(Xe=[e,t])}if(BeFunky.isReplacingRoute=t,BeFunky.isCreateRoute()&&BeFunky.isCreateRoute(e))if(BeFunky.isReplacingRoute=!0,BeFunky.isUseHTML5){console.log("Is in app? ",window.isFlashOpenned),console.log("Is html5app_created?",BeFunky.html5app_created);var n=document.getElementById("bfn-app");console.log("WebGL app visibility?",n&&getComputedStyle(n).display);var o=document.getElementById("appl-for-flash");console.log("Flash app visibility?",o&&getComputedStyle(o).display);var i=document.getElementById("site_root");console.log("Site visibility?",i&&getComputedStyle(i).display,"class =",i&&i.className),console.log("Load screen showing?",BeFunky.isLoadScreenActive()),console.log("New route = ",e),console.log("Canonical route = ",BeFunky.canonicalRoute),BeFunky.throwError("Unexpected create route pushed when app is already in create route.")}else e===at(window.location.href).replace(/\/?(\?|#|$)/,"/$1")&&setTimeout(function(){!BeFunky.isCreateRoute()||window.isFlashCreationComplated||BeFunky.isModalOpen()||BeFunky.promptUserToEnableFlash()},100);BeFunky.isReplacingRoute&&We.historyAPIUpdateMethod("replaceState"),We.navigate(e)},BeFunky.routes={"/explore":function(){Ze(function(){it(),BeFunky.explorePage.search(""),BeFunky.explorePage.openImage("")})},"/explore/photos":function(){Ze(function(){it(),BeFunky.explorePage.search(""),BeFunky.explorePage.openImage("")})},"/explore/photos/:keyword":function(e){var t=e.keyword;Ze(function(){it(),BeFunky.explorePage.search(t),BeFunky.explorePage.openImage("")})},"/explore/gallery/:imageID":function(e){var t=e.imageID;Ze(function(e){if(!e){it();var n=[BeFunky.explorePage,BeFunky.galleryPage,BeFunky.myPhotosPage].find(function(e){return!0===e.isAvailable});n?n.openImage(t):(document.getElementById("explore_single_image")||BeFunky.throwError("No page API handled single image route. Reloading page..."),setTimeout(function(){window.location.reload()},100))}})},"/gallery/:nick":function(e){e.nick;Ze(function(){it(),BeFunky.galleryPage.openImage("")})},"/myphotos":function(){Ze(function(){it(),BeFunky.myPhotosPage.selectFilter("all")})},"/myphotos/:filter":function(e){var t=e.filter;Ze(function(){it(),BeFunky.myPhotosPage.selectFilter(t)})},"/learn/search/:searchTerm":function(e){var t=e.searchTerm;Ze(function(){BeFunky.blogSearchResults.search(t)})},"/create":$e,"/es/crear":$e,"/pt/criar":$e,"/create/:deepLink":$e,"/es/crear/:deepLink":$e,"/pt/criar/:deepLink":$e},BeFunky.originalPageRoute=at(window.location.href);var Ke=void 0;BeFunky.waitUntil({condition:function(){return(Ke=document.querySelector('link[rel="canonical"]'))||document.body},onSuccess:function(){if(!Ke||!Ke.href)return BeFunky.logError("Unable to get canonical tag for this page");BeFunky.canonicalRoute=at(Ke.href)},onTimeout:function(){BeFunky.logError("Unable to get canonical tag for this page")}}),We.notFound(function(){Ze(function(e){if(!e){var t=at(window.location.href);t!==BeFunky.originalPageRoute&&t!==BeFunky.canonicalRoute?(console.log("Reloading page to force browser to navigate to server-side route:",window.location.href),window.location.reload()):BeFunky.isCreateRoute(t)||it()}})});var Qe=0;function Ze(e){var t=0===Qe;Qe++;var n=window.location.href.replace(Ge,"");t||(BeFunky.isReplacingRoute&&BeFunky.sessionRoutes.pop(),BeFunky.sessionRoutes.push(n),BeFunky.isReplacingRoute||(window.ga?(window.ga("set","page",n),window.ga("send","pageview")):BeFunky.logError("Unable to track client-side route in Google Analytics",{route:n})));var o=Date.now();BeFunky.onDocumentReady(function(){var i=Date.now()-o;i&&console.log("Waited "+i+"ms for DOM ready before resolving route "+n);if(console.log("Firing "+(t?"initial ":"")+"route callback",n),We.pause(),e(t),We.resume(),t&&(ze=!0,Xe)){var a=Xe,r=c(a,2),s=r[0],l=r[1];BeFunky.pushRoute(s,l)}})}setTimeout(function(){Object.keys(BeFunky.routes).forEach(function(e){e.startsWith("/")&&!e.endsWith("/")||BeFunky.throwError("Invalid route definition:",e)}),console.log("Resolving first route",window.location.href),We.on(BeFunky.routes).resolve()},0);var et=["/explore","/explore/photos","/explore/photos/:keyword"],tt=["/gallery/:nick"],nt=["/myphotos","/myphotos/:filter"],ot=["/learn/search/:searchTerm"];function it(){if(BeFunky.isUseHTML5){if(!window.isFlashOpenned)return}else{var e=window.getModalBackgroundImage(),t=e&&"block"===e.style.display;if(!window.isFlashOpenned&&!t)return}var n=BeFunky.LanguageManager.isTranslated("confirm_hide")?BeFunky.LanguageManager.getString("confirm_hide"):"Are you sure you would like to hide the application?";if(window.confirm(n))!function(){var e=BeFunky.getModal(),t=0;for(;e;){if(BeFunky.closeModal(e.modalID),console.log("Closed modal:",e.modalID),++t>10){BeFunky.throwError("Unexpected number of modals");break}e=BeFunky.getModal()}BeFunky.isUseHTML5||hideModalBackgroundImage()}(),window.hideEditor(!1),BeFunky.webglContextWasLost&&window.location.reload();else{var o=window.location.href;window.history.forward(),setTimeout(function(){o===window.location.href&&(console.log("Using Back instead of Forward to return to app"),window.history.back())},100)}}function at(e){var t=e.replace(Ge,"").split("?")[0].split("#")[0].replace(/\/$/,"");return t.startsWith("/")?t:"/"+t}BeFunky.waitUntil({condition:function(){return!!BeFunky.explorePage},onSuccess:function(){BeFunky.onDocumentReady(function(){function e(e){We._routes=We._routes.filter(function(t){var n=t.route;return!e.includes(n)})}BeFunky.explorePage.isAvailable||e(et),BeFunky.galleryPage.isAvailable||e(tt),BeFunky.myPhotosPage.isAvailable||e(nt),BeFunky.blogSearchResults.isAvailable||e(ot)})},onTimeout:function(){console.log("WebGL detection complete?",BeFunky.webGLDetectionComplete),console.log("BeFunky keys:",JSON.stringify(Object.keys(BeFunky).sort())),BeFunky.throwError("BeFunky.explorePage is unavailable")}}),BeFunky.onDocumentReady(function(){[].concat(p(document.querySelectorAll("a[data-route]"))).forEach(function(e){e.href.startsWith(Ge)&&e.addEventListener("click",function(t){t.preventDefault(),null!==e.offsetParent?(BeFunky.trackDeepLinkButtonClick(e),BeFunky.pushRoute(e.href.replace(Ge,""))):BeFunky.logError("Ignoring data-route link click b/c it's hidden")})})}),BeFunky.isCreateRoute=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,t=["create","es/crear","pt/criar"],n=t.some(function(t){return e.startsWith("/"+t)||e.startsWith(""+BeFunky.Params.siteUrl+t)});return!n&&t.some(function(t){return e.includes(t)})&&BeFunky.throwError('Route failed create-route test: "'+e+'"'),n},BeFunky.trackDeepLinkButtonClick=function(e){var t=e.href;if(t&&BeFunky.isCreateRoute(t)){var n=at(t).split("/").pop(),o=void 0;if(["create","crear","criar"].includes(n))o="PHOTO-EDITOR";else{if(!window.deepLinkRouteData[n])return void BeFunky.throwError("Unsure how to track deep link button click",link.href);o=window.deepLinkRouteData[n].trackingID}var i=void 0,a=document.getElementById("site_nav");a&&a.contains(e)&&(i="HEADER"),BeFunky.trackDeepLink(o,i)}};var rt=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],st=rt.join(","),lt="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function ut(e,t){t=t||{};var n,o,i,a=[],r=[],s=new ft(e.ownerDocument||e),l=e.querySelectorAll(st);for(t.includeContainer&&lt.call(e,st)&&(l=Array.prototype.slice.apply(l)).unshift(e),n=0;n<l.length;n++)ct(o=l[n],s)&&(0===(i=gt(o))?a.push(o):r.push({documentOrder:n,tabIndex:i,node:o}));return r.sort(ht).map(function(e){return e.node}).concat(a)}function ct(e,t){return!(!dt(e,t)||function(e){return function(e){return mt(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t=function(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t]}(e.ownerDocument.querySelectorAll('input[type="radio"][name="'+e.name+'"]'));return!t||t===e}(e)}(e)||gt(e)<0)}function dt(e,t){return t=t||new ft(e.ownerDocument||e),!(e.disabled||function(e){return mt(e)&&"hidden"===e.type}(e)||t.isUntouchable(e))}ut.isTabbable=function(e,t){if(!e)throw new Error("No node provided");return!1!==lt.call(e,st)&&ct(e,t)},ut.isFocusable=function(e,t){if(!e)throw new Error("No node provided");return!1!==lt.call(e,pt)&&dt(e,t)};var pt=rt.concat("iframe").join(",");function gt(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?function(e){return"true"===e.contentEditable}(e)?0:e.tabIndex:t}function ht(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}function mt(e){return"INPUT"===e.tagName}function ft(e){this.doc=e,this.cache=[]}ft.prototype.hasDisplayNone=function(e,t){if(e.nodeType!==Node.ELEMENT_NODE)return!1;var n=function(e,t){for(var n=0,o=e.length;n<o;n++)if(t(e[n]))return e[n]}(this.cache,function(t){return t===e});if(n)return n[1];var o=!1;return"none"===(t=t||this.doc.defaultView.getComputedStyle(e)).display?o=!0:e.parentNode&&(o=this.hasDisplayNone(e.parentNode)),this.cache.push([e,o]),o},ft.prototype.isUntouchable=function(e){if(e===this.doc.documentElement)return!1;var t=this.doc.defaultView.getComputedStyle(e);return!!this.hasDisplayNone(e,t)||"hidden"===t.visibility};var yt=ut;function vt(){var e=document.querySelector(".site-nav__popup-root"),t=document.querySelector(".site-nav__hamburger"),n=document.querySelector(".site-nav__popup-close"),o=document.querySelectorAll(".site-nav__popup-accordion"),i=document.getElementById("site_root");t.addEventListener("click",function(t){t.stopPropagation(),function(){if(a)return;a=!0,e.addClass("site-nav__popup-root--active"),i.addClass("site-root--site-nav-popup-active"),document.addEventListener("click",r)}()}),n.addEventListener("click",r),e.addEventListener("click",function(e){return e.stopPropagation()}),[].concat(p(o)).forEach(function(e){e.addEventListener("click",function(){return function(e){var t="site-nav__popup-accordion--open",n=e.hasClass(t);o.removeClass(t),n||e.addClass(t)}(e)})});var a=!1;function r(){a&&(a=!1,e.removeClass("site-nav__popup-root--active"),i.removeClass("site-root--site-nav-popup-active"),document.removeEventListener("click",r))}}BeFunky.updateSiteNavForUser=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.username,n=e.email,o=e.isPlus,i=document.getElementById("site_nav");if(i)if(t){var a=document.querySelector(".site-nav__user-circle"),r=[].concat(p(document.querySelectorAll(".site-nav__user-email"))),s=r.map(function(e){return e.parentElement});a.textContent=t.slice(0,1).toUpperCase()||"?",s.forEach(function(e){e.title=n}),r[0].textContent=l(n,20),r[1].textContent=l(n,25),i.removeClass("site-nav--not-signed-in").addClass("site-nav--signed-in").toggleClass("site-nav--user-is-plus",o),window.innerWidth>767&&BeFunky.measureSiteNavDropdowns()}else i.addClass("site-nav--not-signed-in").removeClass("site-nav--signed-in").removeClass("site-nav--user-is-plus");function l(e,t){var n=e.length-t;if(n<=0)return e;if(n>0){var o=Math.round(.618*t),i=e.split("@"),a=c(i,2),r=a[0],s=a[1];if(s.length<=o)return r.slice(0,r.length-n-1)+"...@"+s;if(r.length<o)return r+"@"+s.slice(0,s.length-n-1)+"...";var l=Math.ceil(n/2);return r.slice(0,r.length-l-1)+"...@"+s.slice(0,s.length-l-1)+"..."}}},BeFunky.onDocumentReady(function(){document.getElementById("site_root")&&(!function(){var e=document.querySelector(".site-nav__dropdown-root"),t=document.querySelector(".site-nav__dropdown-bg"),n=document.querySelector(".site-nav__dropdown-container"),o=document.querySelector(".site-nav__dropdown-arrow"),i=Array.from(document.querySelectorAll(".site-nav__item[data-dropdown]")),a=Array.from(document.querySelectorAll(".site-nav__dropdown-section[data-dropdown]")),r=[],s=!1;i.forEach(function(e){var t=e.getAttribute("data-dropdown"),n=a.find(function(e){return e.getAttribute("data-dropdown")===t});if(!n)return BeFunky.throwError('Unable to find dropdown section: "'+t+'"');var o=n.firstElementChild,i={index:r.length,name:t,opener:e,section:n,content:o,arrowOffset:parseInt(n.getAttribute("data-arrow-offset"))||-8};r.push(i),e.addEventListener("mouseenter",function(){u(i)}),e.addEventListener("click",function(){BeFunky.handleNextFocus(e,0,!1)}),e.delegateFocus=function(e){u(i);var t=yt(o);return-1===e?t[t.length-1]:t[0]},o.addClass("focus-avoid"),o.exitFocusTrap=function(t){o.addClass("focus-avoid"),BeFunky.handleNextFocus(e,t),s===i&&c()},e.setAttribute("aria-haspopup",!0),e.setAttribute("aria-expanded",!1)});var l=BeFunky.debounce(p,"ric");function u(i){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s!==i||a){if(s&&s!==i&&(s.opener.setAttribute("aria-expanded",!1),s.content.addClass("focus-avoid"),s=i,e.removeClass("site-nav__dropdown-root--disable-transitions")),!s)return s=i,e.addClass("site-nav__dropdown-root--disable-transitions"),u(i,!0),document.addEventListener("mouseover",d),void document.addEventListener("touchstart",d);s=i;var l=Math.round(i.openerMidX-i.contentWidth/2+i.xOffset),c=Math.round(i.openerMidX+i.arrowOffset);o.setStyles({transform:"translateX("+c+"px)"}),n.setStyles({transform:"translateX("+l+"px)",width:i.contentWidth+"px",height:i.contentHeight+"px"}),t.setStyles({transform:"translateX("+l+"px) scaleX("+i.contentWidth/100+") scaleY("+i.contentHeight/100+")"}),r.forEach(function(e){var t=e.index,n=e.section,o=void 0;o=t<i.index?"left":t===i.index?"active":"right",n.setClass("site-nav__dropdown-section site-nav__dropdown-section--"+o)}),i.opener.setAttribute("aria-expanded",!0),e.removeClass("site-nav__dropdown-root--inactive"),i.content.removeClass("focus-avoid")}}function c(){s&&(s.opener.setAttribute("aria-expanded",!1),s.content.addClass("focus-avoid"),s=!1,e.addClass("site-nav__dropdown-root--inactive"),document.removeEventListener("mouseover",d),document.removeEventListener("touchstart",d))}function d(t){i.includes(t.target)||e.contains(t.target)||"mouseover"===t.type&&s&&s.content.contains(document.activeElement)||c()}function p(){window.isFlashOpenned||BeFunky.isUseHTML5&&BeFunky.isCreateRoute()||(e.setStyles({transform:"none",transition:"none"}),window.requestAnimationFrame(function(){r.forEach(function(e){var t=window.innerWidth,n=e.content.getBoundingClientRect(),o=e.opener.getBoundingClientRect(),i=o.left+o.width/2,a=i-n.width/2,r=i+n.width/2,s=0;a<0?s=a:window.innerWidth<r&&(s=t-r),Object.assign(e,{contentWidth:n.width,contentHeight:n.height,openerMidX:i,xOffset:s})}),e.setStyles({transform:"",transition:""}),s&&u(s,!0)}))}window.addEventListener("load",l),window.addEventListener("resize",l),BeFunky.LanguageManager.addLanguageUpdateListener(function(e){e.includes("site")&&l()}),p(),BeFunky.measureSiteNavDropdowns=l}(),vt(),function(){[document.querySelector(".site-nav__dropdown-link--sign-out"),document.querySelector(".site-nav__popup-button--sign-out")].forEach(function(e){var t=window.location.href;t.endsWith("/")&&["/myphotos","/my-account"].every(function(e){return!t.includes(e)})&&(e.href+="?next="+encodeURIComponent(t))});var e=document.getElementById("site_nav"),t=document.querySelector(".section");t&&(t.hasClass("section--background-none")||t.hasClass("section--background-offwhite")?e.addClass("site-nav--over-light-background"):t.hasClass("section--background-dark")&&e.addClass("site-nav--over-dark-background"))}(),window.onUserStatusChange(function(e){if(!e.user_name)return BeFunky.updateSiteNavForUser();var t=e.user_name,n=e.email,o=e.pl;BeFunky.updateSiteNavForUser({username:t,email:n,isPlus:"1"===o})}))}),BeFunky.onDocumentReady(function(){document.getElementById("site_root")&&function(){var e=document.querySelectorAll(".site-footer__language-choice a");function t(){var t=[].concat(p(e)).find(function(e){return e.getAttribute("data-choose-lang")===BeFunky.LanguageManager.siteLanguage});t&&(document.querySelector(".site-footer__current-language").textContent=t.textContent)}t(),[].concat(p(e)).forEach(function(e){e.addEventListener("click",function(n){n.preventDefault();var o=e.getAttribute("data-choose-lang");if(!BeFunky.LanguageManager.siteLanguages.includes(o))return BeFunky.throwError("Language link missing valid language ID",o);var i=e.href.split("?")[0].split("#")[0]!==window.location.href.split("?")[0].split("#")[0],a=!1;function r(){a||(a=!0,window.location.href=e.href)}BeFunky.updateLanguage(o).then(function(){i&&r()}),i&&(BeFunky.showLoadScreen(),setTimeout(function(){BeFunky.throwError("Language change timed out after 1500ms"),setTimeout(r,50)},1500)),BeFunky.LanguageManager.setLanguage(o,["app","site"]),t()})}),[].concat(p(document.querySelectorAll("#get_started_modal .button"))).forEach(function(e){e.addEventListener("click",function(){return BeFunky.closeModal("get_started_modal")})})}()}),BeFunky.panelHeader=function(e,t){var n=t.name,o=void 0===n?"":n,i=t.tag,a=void 0===i?"h2":i,r=t.modifier,s=void 0===r?"":r,l=t.helpEnabled,u=void 0!==l&&l,d=t.closeEnabled,p=void 0!==d&&d,g=t.arrowEnabled,h=void 0!==g&&g,m=t.plusEnabled,f=void 0!==m&&m,y=t.selectEnabled,v=void 0!==y&&y,_=t.deselectEnabled,k=void 0!==_&&_,b=t.batchEnabled,w=void 0!==b&&b,F=t.isPlus,B=void 0!==F&&F;return function(){var e=this;this.setAttribute("class",n("",[s]));var t=B&&!BeFunky.isPlus()?'<svg class="icon icon-size-regular panel-header__upgrade-star hide-if-premium"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#upgrade-star"></use></svg>':"";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e?"panel-header__"+e:"panel-header",o=[n];return t.filter(Boolean).forEach(function(e){o.push(n+"--"+e)}),o.join(" ")}this.innerHTML="\n        <"+a+' class="'+n("text",[s,"wide"])+'">\n            <string data-lang="'+o+'">'+BeFunky.LanguageManager.getString(o)+"</string>\n            "+t+"\n        </"+a+">\n    ",this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){var e=this;this.heading=this.firstElementChild,this.headingString=this.heading.firstElementChild,this._headingText=o,this.buttonData={help:{icon:"help-icon-circle",event:"HELP",elem:null,position:"left"},close:{icon:"global-cancel-icon",event:"CLOSE",elem:null,position:"right"},plus:{icon:"zoom-plus-icon",event:"PLUS",elem:null,position:"left"},arrow:{icon:"global-arrow-up-icon",event:"ARROW",elem:null,position:"right"},select:{icon:"collage-wizard-select-all",tooltip:"select_all",event:"SELECT",elem:null,position:"left"},deselect:{icon:"collage-wizard-deselect-all",tooltip:"deselect_all",event:"DESELECT",elem:null,position:"right"},batch:{icon:"batch-icon-white",tooltip:"batch_tool_add",event:"BATCH",elem:null,position:"left"}},"preset"===s&&(this.buttonData.batch.icon="batch-icon-white-14"),this.leftButton=null,this.rightButton=null,this.prevButtons={left:"",right:""},this.currentIcons={left:"",right:""},this.buttons={left:"",right:""},this.animationFrameRequested=!1,Object.keys(this.buttonData).forEach(function(t){e["_"+t+"Enabled"]=!1}),this.helpEnabled=u,this.closeEnabled=p,this.arrowEnabled=h,this.plusEnabled=f,this.selectEnabled=v,this.deselectEnabled=k,this.batchEnabled=w;var t=this.getAttribute("data-help-popover-id");this.helpPopover=t?document.getElementById(t):null,this.helpPopover&&this.addEventListener("HELP",function(){e.helpPopover.hasClass("active")?e.helpPopover.hide():e.helpPopover.show(!0)})},this.showButton=function(t){var n=e.buttonData[t].position;e.prevButtons[n]=e.buttons[n],e.buttons[n]=t,e.animationFrameRequested||e.updateButtons()},this.hideButton=function(t){var n=e.buttonData[t].position;e.buttons[n]&&(e.prevButtons[n]=e.buttons[n],e.buttons[n]="",e.animationFrameRequested||e.updateButtons())},this.updateButtons=function(){if(!e.buttonsAdded)return e.addButtons(),e.animationFrameRequested=!0,void requestAnimationFrame(e.updateButtons);e.animationFrameRequested=!1,e.heading.toggleClass("panel-header__text--wide",!e.buttons.left||!e.buttons.right),[["left",e.leftButton],["right",e.rightButton]].forEach(function(t){var n=c(t,2),o=n[0],i=n[1],a=e.buttons[o],r=e.prevButtons[o];if(a!==r){var s=e.buttonData[a]||{},l=e.buttonData[r]||{};s.tooltip?i.setAttribute("data-bfntooltip",s.tooltip):l.tooltip&&i.removeAttribute("data-bfntooltip"),s.icon&&e.updateButtonIcon(a,s.icon,o),i.toggleClass("panel-header__button--hidden",!a),i.tabIndex=a?0:-1}}),e.prevButtons=Object.assign({},e.buttons)},this.addButtons=function(){e.buttonsAdded||(e.buttonsAdded=!0,e.leftButton=document.createElement("button").setClass("button button--icon button--transparent "+n("button",["hidden",s,e.buttons.left])),e.rightButton=document.createElement("button").setClass("button button--icon button--transparent "+n("button",["hidden",s,e.buttons.right,"rightmost"])),e.leftButton.tabIndex=-1,e.rightButton.tabIndex=-1,e.appendChild(e.rightButton),e.appendChild(e.leftButton),e.addEventListener("click",function(t){var n=t.target;n===e.leftButton?e.dispatchEvent(new Event(e.buttonData[e.buttons.left].event)):n===e.rightButton&&e.dispatchEvent(new Event(e.buttonData[e.buttons.right].event))}))},this.updateButtonData=function(t,n){var o=n.icon,i=n.tooltip,a=e.buttonData[t];if(!a)throw"Invalid button name";var r=a.position;"string"==typeof i&&(a.tooltip=i,e.buttons[r]===t&&e.updateButtonTooltip(r,i)),"string"==typeof o&&(a.icon=o,e.buttons[r]===t&&e.updateButtonIcon(t,o,r))},this.updateButtonTooltip=function(t,n){e[t+"Button"].setAttribute("data-bfntooltip",n)},this.updateButtonIcon=function(t,n,o){var i=function(e,t,n){return'\n            <svg class="icon icon-size-medium icon--'+e+'" '+(n?"":'style="backface-visibility: hidden;"')+'>\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+t+'"></use>\n            </svg>'}(t,n,"right"===o);i!==e.currentIcons[o]&&(e.currentIcons[o]=i,e[o+"Button"].innerHTML=i)},["help","close","plus","arrow","select","deselect","batch"].forEach(function(t){Object.defineProperty(e,t+"Enabled",{set:function(e){if(e=!!e,this["_"+t+"Enabled"]!==e){if(this["_"+t+"Enabled"]=e,e){var n=this.prevButtons[this.buttonData[t].position];n&&(this["_"+n+"Enabled"]=!1)}e?this.showButton(t):this.hideButton(t)}},get:function(){return this["_"+t+"Enabled"]}})}),Object.defineProperty(this,"headingText",{set:function(e){if("string"!=typeof e)return BeFunky.throwError("Invalid headingText "+BeFunky.getType(e));e=e.trim(),this._headingText!==e&&(this._headingText=e,this.headingString.setLang(this._headingText))},get:function(){return this._headingText}}),this.init()}.bind(e)()};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var _t,kt,bt=(function(e,t){e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":i(e))&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){function o(e){return(o="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)})(e)}var a=n(2),r=n(8),s=n(0),l=function(){function e(t,n){var o=n.location,i=void 0===o?0:o,a=n.distance,s=void 0===a?100:a,l=n.threshold,u=void 0===l?.6:l,c=n.maxPatternLength,d=void 0===c?32:c,p=n.caseSensitive,g=void 0!==p&&p,h=n.tokenSeparator,m=void 0===h?/ +/g:h,f=n.findAllMatches,y=void 0!==f&&f,v=n.minMatchCharLength,_=void 0===v?1:v,k=n.id,b=void 0===k?null:k,w=n.keys,F=void 0===w?[]:w,B=n.shouldSort,E=void 0===B||B,S=n.getFn,I=void 0===S?r:S,C=n.sortFn,L=void 0===C?function(e,t){return e.score-t.score}:C,P=n.tokenize,x=void 0!==P&&P,A=n.matchAllTokens,T=void 0!==A&&A,R=n.includeMatches,M=void 0!==R&&R,D=n.includeScore,U=void 0!==D&&D,O=n.verbose,N=void 0!==O&&O;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:u,maxPatternLength:d,isCaseSensitive:g,tokenSeparator:m,findAllMatches:y,minMatchCharLength:_,id:b,keys:F,includeMatches:M,includeScore:U,shouldSort:E,getFn:I,sortFn:L,verbose:N,tokenize:x,matchAllTokens:T},this.setCollection(t)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),o=n.tokenSearchers,i=n.fullSearcher,a=this._search(o,i),r=a.weights,s=a.results;return this._computeScore(r,s),this.options.shouldSort&&this._sort(s),t.limit&&"number"==typeof t.limit&&(s=s.slice(0,t.limit)),this._format(s)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),o=0,i=n.length;o<i;o+=1)t.push(new a(n[o],this.options));return{tokenSearchers:t,fullSearcher:new a(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,o={},i=[];if("string"==typeof n[0]){for(var a=0,r=n.length;a<r;a+=1)this._analyze({key:"",value:n[a],record:a,index:a},{resultMap:o,results:i,tokenSearchers:e,fullSearcher:t});return{weights:null,results:i}}for(var s={},l=0,u=n.length;l<u;l+=1)for(var c=n[l],d=0,p=this.options.keys.length;d<p;d+=1){var g=this.options.keys[d];if("string"!=typeof g){if(s[g.name]={weight:1-g.weight||1},g.weight<=0||g.weight>1)throw new Error("Key weight has to be > 0 and <= 1");g=g.name}else s[g]={weight:1};this._analyze({key:g,value:this.options.getFn(c,g),record:c,index:l},{resultMap:o,results:i,tokenSearchers:e,fullSearcher:t})}return{weights:s,results:i}}},{key:"_analyze",value:function(e,t){var n=e.key,o=e.arrayIndex,i=void 0===o?-1:o,a=e.value,r=e.record,l=e.index,u=t.tokenSearchers,c=void 0===u?[]:u,d=t.fullSearcher,p=void 0===d?[]:d,g=t.resultMap,h=void 0===g?{}:g,m=t.results,f=void 0===m?[]:m;if(null!=a){var y=!1,v=-1,_=0;if("string"==typeof a){this._log("\nKey: ".concat(""===n?"-":n));var k=p.search(a);if(this._log('Full text: "'.concat(a,'", score: ').concat(k.score)),this.options.tokenize){for(var b=a.split(this.options.tokenSeparator),w=[],F=0;F<c.length;F+=1){var B=c[F];this._log('\nPattern: "'.concat(B.pattern,'"'));for(var E=!1,S=0;S<b.length;S+=1){var I=b[S],C=B.search(I),L={};C.isMatch?(L[I]=C.score,y=!0,E=!0,w.push(C.score)):(L[I]=1,this.options.matchAllTokens||w.push(1)),this._log('Token: "'.concat(I,'", score: ').concat(L[I]))}E&&(_+=1)}v=w[0];for(var P=w.length,x=1;x<P;x+=1)v+=w[x];v/=P,this._log("Token score average:",v)}var A=k.score;v>-1&&(A=(A+v)/2),this._log("Score average:",A);var T=!this.options.tokenize||!this.options.matchAllTokens||_>=c.length;if(this._log("\nCheck Matches: ".concat(T)),(y||k.isMatch)&&T){var R=h[l];R?R.output.push({key:n,arrayIndex:i,value:a,score:A,matchedIndices:k.matchedIndices}):(h[l]={item:r,output:[{key:n,arrayIndex:i,value:a,score:A,matchedIndices:k.matchedIndices}]},f.push(h[l]))}}else if(s(a))for(var M=0,D=a.length;M<D;M+=1)this._analyze({key:n,arrayIndex:M,value:a[M],record:r,index:l},{resultMap:h,results:f,tokenSearchers:c,fullSearcher:p})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var n=0,o=t.length;n<o;n+=1){for(var i=t[n].output,a=i.length,r=1,s=1,l=0;l<a;l+=1){var u=e?e[i[l].key].weight:1,c=(1===u?i[l].score:i[l].score||.001)*u;1!==u?s=Math.min(s,c):(i[l].nScore=c,r*=c)}t[n].score=1===s?r:s,this._log(t[n])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,function(e,t){if("object"===o(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t})),n=null}var i=[];this.options.includeMatches&&i.push(function(e,t){var n=e.output;t.matches=[];for(var o=0,i=n.length;o<i;o+=1){var a=n[o];if(0!==a.matchedIndices.length){var r={indices:a.matchedIndices,value:a.value};a.key&&(r.key=a.key),a.hasOwnProperty("arrayIndex")&&a.arrayIndex>-1&&(r.arrayIndex=a.arrayIndex),t.matches.push(r)}}}),this.options.includeScore&&i.push(function(e,t){t.score=e.score});for(var a=0,r=e.length;a<r;a+=1){var s=e[a];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var l={item:s.item},u=0,c=i.length;u<c;u+=1)i[u](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,n),e}();e.exports=l},function(e,t,n){var o=n(3),i=n(4),a=n(7),r=function(){function e(t,n){var o=n.location,i=void 0===o?0:o,r=n.distance,s=void 0===r?100:r,l=n.threshold,u=void 0===l?.6:l,c=n.maxPatternLength,d=void 0===c?32:c,p=n.isCaseSensitive,g=void 0!==p&&p,h=n.tokenSeparator,m=void 0===h?/ +/g:h,f=n.findAllMatches,y=void 0!==f&&f,v=n.minMatchCharLength,_=void 0===v?1:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:u,maxPatternLength:d,isCaseSensitive:g,tokenSeparator:m,findAllMatches:y,minMatchCharLength:_},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=d&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,n=t.maxPatternLength,a=t.tokenSeparator;if(this.pattern.length>n)return o(e,this.pattern,a);var r=this.options,s=r.location,l=r.distance,u=r.threshold,c=r.findAllMatches,d=r.minMatchCharLength;return i(e,this.pattern,this.patternAlphabet,{location:s,distance:l,threshold:u,findAllMatches:c,minMatchCharLength:d})}}])&&function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,n),e}();e.exports=r},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(o,"|")),a=e.match(i),r=!!a,s=[];if(r)for(var l=0,u=a.length;l<u;l+=1){var c=a[l];s.push([e.indexOf(c),c.length-1])}return{score:r?.5:1,isMatch:r,matchedIndices:s}}},function(e,t,n){var o=n(5),i=n(6);e.exports=function(e,t,n,a){for(var r=a.location,s=void 0===r?0:r,l=a.distance,u=void 0===l?100:l,c=a.threshold,d=void 0===c?.6:c,p=a.findAllMatches,g=void 0!==p&&p,h=a.minMatchCharLength,m=void 0===h?1:h,f=s,y=e.length,v=d,_=e.indexOf(t,f),k=t.length,b=[],w=0;w<y;w+=1)b[w]=0;if(-1!==_){var F=o(t,{errors:0,currentLocation:_,expectedLocation:f,distance:u});if(v=Math.min(F,v),-1!==(_=e.lastIndexOf(t,f+k))){var B=o(t,{errors:0,currentLocation:_,expectedLocation:f,distance:u});v=Math.min(B,v)}}_=-1;for(var E=[],S=1,I=k+y,C=1<<k-1,L=0;L<k;L+=1){for(var P=0,x=I;P<x;)o(t,{errors:L,currentLocation:f+x,expectedLocation:f,distance:u})<=v?P=x:I=x,x=Math.floor((I-P)/2+P);I=x;var A=Math.max(1,f-x+1),T=g?y:Math.min(f+x,y)+k,R=Array(T+2);R[T+1]=(1<<L)-1;for(var M=T;M>=A;M-=1){var D=M-1,U=n[e.charAt(D)];if(U&&(b[D]=1),R[M]=(R[M+1]<<1|1)&U,0!==L&&(R[M]|=(E[M+1]|E[M])<<1|1|E[M+1]),R[M]&C&&(S=o(t,{errors:L,currentLocation:D,expectedLocation:f,distance:u}))<=v){if(v=S,(_=D)<=f)break;A=Math.max(1,2*f-_)}}if(o(t,{errors:L+1,currentLocation:f,expectedLocation:f,distance:u})>v)break;E=R}return{isMatch:_>=0,score:0===S?.001:S,matchedIndices:i(b,m)}}},function(e,t){e.exports=function(e,t){var n=t.errors,o=void 0===n?0:n,i=t.currentLocation,a=void 0===i?0:i,r=t.expectedLocation,s=void 0===r?0:r,l=t.distance,u=void 0===l?100:l,c=o/e.length,d=Math.abs(s-a);return u?c+d/u:d?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],o=-1,i=-1,a=0,r=e.length;a<r;a+=1){var s=e[a];s&&-1===o?o=a:s||-1===o||((i=a-1)-o+1>=t&&n.push([o,i]),o=-1)}return e[a-1]&&a-o>=t&&n.push([o,a-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,o=0;o<n;o+=1)t[e.charAt(o)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t,n){var o=n(0);e.exports=function(e,t){return function e(t,n,i){if(n){var a=n.indexOf("."),r=n,s=null;-1!==a&&(r=n.slice(0,a),s=n.slice(a+1));var l=t[r];if(null!=l)if(s||"string"!=typeof l&&"number"!=typeof l)if(o(l))for(var u=0,c=l.length;u<c;u+=1)e(l[u],s,i);else s&&e(l,s,i);else i.push(l.toString())}else i.push(t);return i}(e,t,[])}}])}(_t={exports:{}},_t.exports),_t.exports),wt=(kt=bt)&&kt.__esModule&&Object.prototype.hasOwnProperty.call(kt,"default")?kt.default:kt;bt.Fuse;BeFunky.autocomplete=function(e,t){var n=t.inputElement,o=t.options,i=t.minValueLength,a=void 0===i?2:i,r=t.allowEmpty,s=void 0!==r&&r,l=t.generateItem,u=t.onSelect,d=void 0===u?function(){}:u;return function(){this.addClass("autocomplete"),n.hasAutocomplete=!0;var e=o.slice().filter(function(e){return"string"==typeof e.label&&e.label.length});function t(e,t,n){if("left"===t||"right"===t)return!0;if("keydown"!==n.type)if(e.hasClass("autocomplete__item")){var o="up"===t?e.previousElementSibling:e.nextElementSibling;if(o)o.focus();else if("up"===t){var i=e.parentElement.previousElementSibling;i&&"INPUT"===i.nodeName&&i.focus()}}else if("down"===t){var a=e.nextElementSibling.children;a.length>=2&&a[1].focus()}}this.init=function(){var i=this;this.updatePosition(),this.currentValue="",this._currentOption=void 0,this.noResultsText="No results",this.ignoreNextTextUpdate=!1,e.forEach(function(e){e.element=i.createItem(e)});var r={shouldSort:!0,includeScore:!0,includeMatches:!0,threshold:.2,location:0,distance:100,maxPatternLength:32,minMatchCharLength:a,keys:["label"]};this.fuse=new wt(o,r);var s=BeFunky.debounce(this.handleTextUpdate.bind(this),25);n.addEventListener("change",s),n.addEventListener("keyup",s),n.addEventListener("focus",this.handleTextUpdate.bind(this));n.addEventListener("blur",function(){return setTimeout(function(){i.contains(document.activeElement)||i.hide()},100)});var l={callback:t,condition:function(e){return e.hasClass("autocomplete__item")||e.hasAutocomplete}};BeFunky.addArrowKeyHandler(l),n.addEventListener("keydown",function(e){"Enter"===e.key&&13===e.keyCode&&i.currentOption&&(e.preventDefault(),i.selectOption(i.currentOption))}),this.addEventListener("click",function(e){var t=e.target;t&&t.hasClass("autocomplete__item")&&i.selectOption(t.option)}),this.addEventListener("focusout",function(){return setTimeout(function(){var e=document.activeElement;e&&e!==n&&!i.contains(e)&&i.hide()},200)})},this.show=function(){this.addClass("autocomplete--active")},this.hide=function(){this.removeClass("autocomplete--active")},this.updateOptions=function(){var e=this,t=this.currentValue.length;if(t<a&&(0!==t||!s))return this.hide();var n=t?this.fuse.search(this.currentValue).filter(function(e){return e.score<.5}):[];if(l&&(!n.length||n[0].score>0)){var o=this.createItemFromUserInput();o&&(-1===o.index?n.push(o):n.splice(o.index,0,o))}var i=document.createDocumentFragment();if(n.length)n.forEach(function(t){var o=t.item,a=t.matches;if(!t.isGenerated){var r=0,s=o.label;a[0]||(console.log("value =",e.currentValue),console.log("sortedMatches =",JSON.stringify(n))),a[0].indices.forEach(function(e){var t=c(e,2),n=t[0],i=t[1];s=s.slice(0,r+n)+"<span>"+o.label.slice(n,i+1)+"</span>"+o.label.slice(i+1),r+=13}),o.element.innerHTML=s}i.appendChild(o.element)}),this.currentOption=n[0].item;else{var r=this.createItem({label:this.noResultsText});r.addClass("autocomplete__item--no-results"),i.appendChild(r),this.currentOption=void 0}for(;this.firstElementChild;)this.removeChild(this.firstElementChild);this.appendChild(i),this.show()},this.createItemFromUserInput=function(){var e=l(this.currentValue)||{},t=e.html,n=e.index;if(t){var o={label:this.currentValue};return o.element=this.createItem(o),o.element.innerHTML=t,{isGenerated:!0,index:n,item:{label:this.currentValue,element:o.element}}}},this.createItem=function(e){var t=this,n=document.createElement("button");return n.className="button button--list autocomplete__item",n.type="button",n.option=Object.assign({},e),n.textContent=e.label,n.addEventListener("focus",function(){t.currentOption=e}),n},this.selectOption=function(e){var t=this,o=e.label;o!==this.noResultsText&&(this.hide(),this.ignoreNextTextUpdate=!0,setTimeout(function(){t.ignoreNextTextUpdate=!1},500),n.value=o,d(e))},this.updatePosition=function(){var e=n.getBoundingClientRect(),t=this.getBoundingClientRect();if(e.width){var o=parseInt(this.style.top)||0,i=parseInt(this.style.left)||0;this.setStyles({top:o+e.top-t.top+e.height+4+"px",left:i+e.left-t.left+"px",width:e.width+"px"})}},this.handleTextUpdate=function(){if(this.ignoreNextTextUpdate)this.ignoreNextTextUpdate=!1;else{var e=n.value.trim();if(e===this.currentValue)return e.length>a?this.show():!e.length&&s?this.show():void 0;this.currentValue=e,this.updateOptions()}},Object.defineProperty(this,"currentOption",{set:function(e){if(this._currentOption!==e)if(this._currentOption&&this._currentOption.element.removeClass("autocomplete__item--selected"),e){if(!e.element||"string"!=typeof e.label)throw"Invalid currentOption";this._currentOption=e,this._currentOption.element.addClass("autocomplete__item--selected")}else this._currentOption=void 0},get:function(){return this._currentOption}}),this.init()}.bind(e)()},BeFunky.isUseHTML5=!0,BeFunky.html5app_created=!1,BeFunky.flashDisabledPanel=null,BeFunky.readyHtml5App=function(){if(!BeFunky.html5app_created&&BeFunky.Params.canUseWebapp){if(BeFunky.showLoadScreen(),BeFunky.appTemplatePosted)return e();BeFunky.waitUntil({condition:function(){return null!==BeFunky.appTemplate&&!1===BeFunky.appTemplatePosted},onSuccess:function(){var t=BeFunky.appTemplate.content;BeFunky.appTemplatePosted=!0,BeFunky.LanguageManager.renderLanguageStrings(t),document.getElementById("bfn-app").appendChild(t),e()},onTimeout:function(){if(console.log("BeFunky.appTemplate",BeFunky.appTemplate),console.log("BeFunky.appTemplatePosted",BeFunky.appTemplatePosted),navigator.connection){console.log("Connection info:",["downlink","effectiveType","rtt"].map(function(e){return"\t"+e+": "+navigator.connection[e]}).join("\t"))}BeFunky.throwError("Unable to inject bfn-app template in #bfn-app DIV."),BeFunky.hideLoadScreen()},interval:100,maxAttempts:300})}function e(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n&&(window.appBundleLoaded||t("bundle",function(){return window.scriptHasLoaded("app")}),window.PIXI||t("scripts",function(){return window.scriptHasLoaded("scripts")})),BeFunky.waitUntil({condition:function(){return window.PIXI&&window.BFN&&window.BFN.readyApp&&BeFunky.svgSpriteLoaded},onSuccess:function(){n||(BeFunky.trackUserTiming("App Init","app_bundle","network")(Math.round(window.appBundleLoadTime)),BeFunky.trackUserTiming("App Init","scripts_js","network")(Math.round(window.scriptsLoadTime))),BFN.readyApp(function(){BeFunky.html5app_created=!0,window.flashCreationComplateHandler()},function(){try{void 0!==BeFunky.Params.graphics_tag_version&&(BFN.assetsDataVersions.goodies_tags=BeFunky.Params.graphics_tag_version),void 0!==BeFunky.Params.designer_template_tag_version&&(BFN.assetsDataVersions.designer_templates_tags=BeFunky.Params.designer_template_tag_version)}catch(e){}})},onTimeout:function(){if(console.log("typeof PIXI = ",i(window.PIXI)),console.log("typeof BFN = ",i(window.BFN)),window.BFN&&console.log("typeof BFN.readyApp = ",i(window.BFN.readyApp)),console.log("BeFunky.svgSpriteLoaded = ",BeFunky.svgSpriteLoaded),console.log("window.appBundleLoaded = ",window.appBundleLoaded),navigator.connection){console.log("Connection info:",["downlink","effectiveType","rtt"].map(function(e){return"\t"+e+": "+navigator.connection[e]}).join("\t"))}if(!n)return BeFunky.throwError("Unable to initialize WebGL app. Attempting to load scripts with XHR..."),e(!0);BeFunky.throwError("Unable to initialize WebGL app."),BeFunky.hideLoadScreen(),BeFunky.acknowledge(["error_please_refresh",{contact_support:function(){return'<a href="https://support.befunky.com/hc/en-us/requests/new">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}}],{onAcknowledge:function(){return window.location.reload()}})},interval:10,maxAttempts:3e3})}function t(e,t){var n=document.querySelector('script[src*="/'+e+'."]');if(!n){var o=[].concat(p(document.querySelectorAll("script"))).map(function(e){return e.src}).filter(Boolean);return console.log("Scripts found:",JSON.stringify(o)),BeFunky.throwError('No script matching script[src*="/'+e+'."]')}var i=n.src;BeFunky.loadScriptWithXHR(i).then(function(){t(),BeFunky.throwError("Successfully loaded "+e+" with XHR",i)}).catch(function(t){BeFunky.throwError("Unable to load "+e+" with XHR",t,i)})}},BeFunky.appTemplate=null,BeFunky.appTemplatePosted=!1,BeFunky.prepareHtml5App=function(){if(BeFunky.isUseHTML5&&BeFunky.Params.canUseWebapp){var e=BeFunky.trackUserTiming("App Init","svg_and_html","network");Promise.all([BeFunky.loadSVGSprite(),BeFunky.loadAppHTML()]).then(function(){e()},function(e){BeFunky.throwError("App could not start up b/c SVG or HTML failed to load",e)})}};var Ft=void 0;BeFunky.loadAppHTML=function(){return Ft||(Ft=new Promise(function(e,t){var n=BeFunky.Params.globalAssetsPath+"html/bfn-app-min"+BeFunky.Params.BFN_APP_HTML_VERSION+".txt";console.log("Starting request for app HTML",n),BeFunky.request(n,{responseType:"text"},function(o){var i=o.error,a=o.response;if(i)return BeFunky.logError("Unable to download app HTML txt file",n,i),Ft=void 0,t(i);console.log("Got valid HTML for app. Response length = ",a&&a.length),BeFunky.appTemplate=document.createElement("template"),BeFunky.appTemplate.innerHTML=a,e()})}))},BeFunky.svgSpriteLoaded=!1;var Bt=void 0;BeFunky.loadSVGSprite=function(){return Bt||(Bt=new Promise(function(e,t){var n=BeFunky.Params.globalAssetsPath+"icons/sprite"+BeFunky.Params.svgSpriteVersion+".svg";console.log("Starting request for app SVG",n),BeFunky.request(n,{responseType:"text"},function(n){var o=n.error,i=n.response;if(o)return BeFunky.logError("Unable to download SVG sprite",o),Bt=void 0,t(o);var a=i.match(/<svg ([\s\S]*?)<\/svg>/g);if(!a||!a[0])return BeFunky.logError("Invalid SVG sprite response:",i),Bt=void 0,t("invalid_response");console.log("Got valid SVG for app. Waiting for DOM ready to inject it."),BeFunky.onDocumentReady(function(){document.getElementById("svgContainer").innerHTML=a[0],BeFunky.svgSpriteLoaded=!0,e()})})}))},BeFunky.loadSVGSprite(),window.caledFunctionName=null,window.calledParams=null,window.isFlashOpenned=!1,BeFunky.siteScrollY=0,window.openFlash=function(){if(BeFunky.Params.canUseWebapp){1===BeFunky.sessionRoutes.length&&BeFunky.isCreateRoute(BeFunky.sessionRoutes[0])?BeFunky.siteScrollY=0:BeFunky.siteScrollY=window.pageYOffset||0,window.isFlashOpenned=!1!==BeFunky.Params.isFlashPlayerCorrect||!0===BeFunky.isUseHTML5;var e=document.getElementById("bfn-app"),t=document.getElementById("appl-for-flash");if(BeFunky.isUseHTML5&&e&&"block"===e.style.display)BeFunky.logError("openFlash called unnecessarily b/c WebGL app is already open");else{if(BeFunky.moveModalRoot(e),BeFunky.moveLoadScreen(e),document.getElementById("main").setStyles({top:"0px",left:"",width:BeFunky.isUseHTML5?"100%":setInitFlashWidth()+"px",height:BeFunky.isUseHTML5?"100%":setInitFlashHeight()+"px"}),(document.getElementById("site_root")||document.getElementById("wrapper")).setStyles({display:"none"}),document.body.addClass("prevent-body-scroll"),BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.app,["modal"]),BeFunky.isUseHTML5)return e.setStyles({display:"block"}),t.setStyles({display:"none"}),void BeFunky.readyHtml5App();t.setStyles({top:0,left:0,display:"block"}),e.setStyles({display:"none"});var n=document.getElementById(BeFunky.Params.swfId);try{n.setAttribute("width",setInitFlashWidth()),n.setAttribute("height",setInitFlashHeight())}catch(e){}BeFunky.isPlus()||1!==BeFunky.Params.isShowAds||calculateAdWidth(),window.scrollTo(0,0),BeFunky.isPlus()||1!==BeFunky.Params.isShowAds||flasRightBarAdDisplay(),setTimeout(function(){try{window.dispatchEvent(new Event("resize"))}catch(e){}},30);var o=void 0,i=n,a=setInterval(function(){i||(i=document.getElementById(BeFunky.Params.swfId)),window.isFlashCreationComplated?(clearInterval(a),o&&o()):o||i&&"function"===i.PercentLoaded||(o=BeFunky.promptUserToEnableFlash())},111)}}else BeFunky.logError("App not opened b/c device is mobile")},BeFunky.cleanupEnterAppImmediately=function(){var e=document.getElementById("site_root");e?e.removeClass("site-root--enter-app-immediately"):BeFunky.throwError("Unable to find #site_root")},window.urlUpload=function(e,t,n){BeFunky.befunkyPopupContainerClose(),window.currentDeepLinkParameters.img=e,window.isFlashCreationComplated&&window.applyDeepLinkParameters()},window.setDesignerTemplate=function(e){BeFunky.isUseHTML5?BFN.BfnService.updateDefaultDesignerTemplate(e):document.getElementById(BeFunky.Params.swfId).updateDefaultDesignerTemplate(e)},window.setPhotoEditorImage=function(e,t){BeFunky.isUseHTML5?BFN.BfnService.ToJsUrlUploader(e,null,t,t?"befunky":"sample"):document.getElementById(BeFunky.Params.swfId).ToJsUrlUploader(e,null,!1)},window.goToenableFlashPlugin=function(e){(e.includes("adobe.com")||e.includes("befunky.com"))&&(window.location.href=e,window.setCookie("cufpeclck","1",365),window.bf_eventTrack("EXTERNAL","FLASH_DETECT","CLICK_ENABLE"))},window.setApplicationMode=function(e){e&&"string"==typeof e||(e="photoeditor"),BeFunky.isUseHTML5?BFN.AppModel.applicationModeChange(e):document.getElementById(BeFunky.Params.swfId).ApplicationModeChange(e)},window.currentDeepLinkParameters={type:"photoeditor"},window.openUploadPanel=function(e){var t=window.deepLinkRouteData[e]||e||{},n=t.type,o=void 0===n?"photoeditor":n,i=t.img,a=t.template,r=t.ignoreExistingProject,s=void 0!==r&&r,l=t.availability;if(!BeFunky.Params.canUseWebapp)return BeFunky.logError("Deep link to app not opened b/c device is mobile"),BeFunky.cleanupEnterAppImmediately(),BeFunky.handleMobileUserAttemptToOpenApp(l),void BeFunky.leaveCreateRoute();if(console.log("Handling "+(BeFunky.isUseHTML5?"WebGL":"Flash")+" deep link. Type = "+o+". Waiting on WebGl? "+(BeFunky.webGLDetectionComplete?"no":"yes")),BeFunky.webGLDetectionComplete){if(BeFunky.Params.isShowAds<1&&window.flashFreeTop>0&&(window.removeAds(),window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1),window.currentDeepLinkParameters={type:o,template:a,img:i,ignoreExistingProject:s},BeFunky.isUseHTML5)return BeFunky.cleanupEnterAppImmediately(),window.isFlashCreationComplated&&window.applyDeepLinkParameters(),void openFlash();var u=null,c=null;try{var d=get_browser();u=d.name,c=Number(d.version)}catch(e){}null==u&&(u=1==/Chrome/i.test(navigator.userAgent)?"Chrome":null);var p=1==/Edge\/\d./i.test(navigator.userAgent)?"Edge":null;null!=p&&(u=p),window._onLoad(function(){if(BeFunky.cleanupEnterAppImmediately(),!0===BeFunky.Params.isFlashPlayerCorrect){if(window.isFlashCreationComplated&&window.applyDeepLinkParameters(),openFlash(),null!=u&&null!=c&&0==isNaN(c)&&("CHROME"==u.toUpperCase()&&c>55||"EDGE"==u.toUpperCase()&&c>=15))"1"==getCookie("cufpeclck")&&(setCookie("cufpeclck","2",365),bf_eventTrack("EXTERNAL","FLASH_DETECT","FLASH_SHOW"));return!0}if(0==BeFunky.Params.isFlashPlayerCorrect)return BeFunky.flashDisabledPanel&&BeFunky.flashDisabledPanel.setStyles({display:"none"}),null!=u&&null!=c&&0==isNaN(c)&&("CHROME"==u.toUpperCase()&&c>55||"EDGE"==u.toUpperCase()&&c>=15)?BeFunky.promptUserToEnableFlash():BeFunky.promptUserToUpdateFlash(),!1})}else{var g=Date.now(),h=!1;BeFunky.waitUntil({condition:function(){return!h&&Date.now()-g>1e3&&(BeFunky.logError("Waiting on __bfnDefferReady()... WebGL detection must complete before opening app."),h=!0),BeFunky.webGLDetectionComplete},onSuccess:function(){window.openUploadPanel(e)},onTimeout:function(){BeFunky.logError("Unable to open app b/c __bfnDefferReady() was not called after 10 seconds"),BeFunky.cleanupEnterAppImmediately(),BeFunky.leaveCreateRoute()},interval:100,maxAttempts:100})}},BeFunky.leaveCreateRoute=function(){setTimeout(function(){BeFunky.isCreateRoute()&&(BeFunky.sessionRoutes.length>1?window.history.back():BeFunky.canonicalRoute?BeFunky.pushRoute(BeFunky.canonicalRoute):BeFunky.throwError("Unable to leave create route"))},0)},BeFunky.handleMobileUserAttemptToOpenApp=function(e){var t="web_mobile_apps"===e,n="web_visionn_app"===e&&BeFunky.isIOS;if(t||n){var o=document.createElement("div");o.appendChild(document.createElement("p").setLang("try_mobile_app")),o.appendChild(document.createElement("p").setLang("edits_on_the_go"));var i=BeFunky.isIOS?"open_app_store":"open_play_store";return BeFunky.confirm(o,{confirmText:i,onConfirm:function(){window.open(s(),"_blank")}})}var a=document.createElement("div");a.appendChild(document.createElement("p").setLang("accessible_from_desktop")),a.appendChild(document.createElement("p").setLang("great_mobile_app"));var r=BeFunky.isIOS?"open_app_store":"open_play_store";return BeFunky.confirm(a,{confirmText:r,onConfirm:function(){window.open(s(),"_blank")}});function s(){return n?"https://itunes.apple.com/app/apple-store/id1142803226?mt=8":BeFunky.isIOS?"https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8":"https://play.google.com/store/apps/details?id=air.com.befunky."+(/mobile/i.test(navigator.userAgent)?"BeFunkyPhotoEditor":"BeFunkyPad")}},BeFunky.trackDeepLink=function(e,t){if("string"!=typeof e)return BeFunky.throwError("Invalid action: "+BeFunky.getType(e),e);if(BeFunky.Params.canUseWebapp||(e=e+"_"+(BeFunky.isIOS?"IOS":"ANDROID")),!t){var n=[].concat(p(BeFunky.sessionRoutes)).reverse().find(function(e){return!BeFunky.isCreateRoute(e)});if(!n)return console.log("Session routes:",JSON.stringify(BeFunky.sessionRoutes)),void(BeFunky.isUseHTML5?BeFunky.throwError("Unable to find non-create route to track Deep Link button click"):BeFunky.logError("Deep Link button clicked after user failed to enter Flash app via deep link"));t="/"===n?"HOME":n.split("?")[0].split("#")[0].replace(/(^\/)|(\/$)/g,"").replace(/\//g,"_").toUpperCase()}window.bf_eventTrack("EXTERNAL",e,t)},window.hideEditor=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(console.log("Hiding "+(BeFunky.isUseHTML5?"WebGL":"Flash")+" app"),BeFunky.isUseHTML5?document.getElementById("appl-for-flash").setStyles({display:"none"}):document.getElementById("appl-for-flash").setStyles({top:"-5000px",left:"-5000px"}),document.getElementById("bfn-app").setStyles({display:"none"}),BeFunky.moveModalRoot(document.body),BeFunky.moveLoadScreen(document.body),document.getElementById("main").setStyles({top:"-5000px",left:"-5000px"}),(document.getElementById("site_root")||document.getElementById("wrapper")).setStyles({display:""}),flasRightBarAdDisplay(!0),BeFunky.isPlus()||calculateAdWidth(),!0!==BeFunky.befunkyPopupDivOpened&&document.body.removeClass("prevent-body-scroll"),window.isFlashOpenned=!1,BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.site,["modal"]),(BeFunky.isUseHTML5||!e)&&BeFunky.isCreateRoute()){var t=[].concat(p(BeFunky.sessionRoutes)).reverse()[1];"string"==typeof t?BeFunky.pushRoute(t):"string"==typeof BeFunky.canonicalRoute?BeFunky.pushRoute(BeFunky.canonicalRoute):BeFunky.logError("Unable to swap out create route for new one"),BeFunky.isUseHTML5||window.hideModalBackgroundImage()}return window.scrollTo?window.scrollTo(0,BeFunky.siteScrollY):document.documentElement.scrollTop=BeFunky.siteScrollY,BeFunky.measureSiteNavDropdowns&&BeFunky.measureSiteNavDropdowns(),!1},window.isFlashCreationComplated=!1,window.flashCreationComplateHandler=function(){if(0==BeFunky.isUseHTML5){if(BeFunky.flashDisabledPanel&&BeFunky.flashDisabledPanel.setStyles({display:"none"}),BeFunky.Params.openurl&&urlUpload(BeFunky.Params.openurl),window.isFlashCreationComplated=!0,window.applyDeepLinkParameters(),1==BeFunky.ISNOT_FLASH_LOGGEDIN&&BeFunky.User.FlashVarsObject){try{document.getElementById(BeFunky.Params.swfId).userValueObj(BeFunky.User.FlashVarsObject)}catch(e){}BeFunky.ISNOT_FLASH_LOGGEDIN=!1}}else BeFunky.Params.openurl&&urlUpload(BeFunky.Params.openurl),window.isFlashCreationComplated=!0,window.applyDeepLinkParameters()},window.openEditor=function(e){return window.openUploadPanel(e)},window.applyDeepLinkParameters=function(){var e=window.currentDeepLinkParameters,t=e.type,n=e.template,o=e.img,i=e.ignoreExistingProject;console.log("Entering app w/ deep link parameters:",window.currentDeepLinkParameters),window.setApplicationMode(t),"designer"===t&&n&&window.setDesignerTemplate(n),o&&window.setPhotoEditorImage(o,i)},BeFunky.promptUserToUpdateFlash=function(){var e=document.createElement("p").setLang("update_flash_prompt"),t=document.createElement("p").setLang("enable_flash_link",{tutorial:function(){return'<a href="https://support.befunky.com/hc/en-us/articles/218015043-How-to-enable-Flash-Player" target="_blank" rel="noopener">'+BeFunky.LanguageManager.getString("tutorial")+"</a>"}}),n=document.createElement("div");n.appendChild(e),n.appendChild(t),BeFunky.acknowledge(n,{buttonText:"update_flash_button",onAcknowledge:function(){window.open("https://get.adobe.com/flashplayer/","_blank")}})},BeFunky.promptUserToEnableFlash=function(){var e="";e=BeFunky.isChrome?"Chrome":BeFunky.isFirefox?"Firefox":BeFunky.isSafari?"Safari":BeFunky.isEdge?"Microsoft Edge":BeFunky.LanguageManager.getString("your_browser");var t=document.createElement("p").setLang("enable_flash_prompt",{browser:e,enable_flash_button:function(){return BeFunky.LanguageManager.getString("enable_flash_button")}}),n=document.createElement("p").setLang("enable_flash_link",{tutorial:function(){return'<a href="https://support.befunky.com/hc/en-us/articles/218015043-How-to-enable-Flash-Player" target="_blank" rel="noopener">'+BeFunky.LanguageManager.getString("tutorial")+"</a>"}}),o=document.createElement("div");if(o.appendChild(t),o.appendChild(n),window.bf_eventTrack("EXTERNAL","FLASH_DETECT","SHOW_ENABLE"),!BeFunky.isFirefox)return BeFunky.acknowledge(o,{heading:["enable_flash_heading",{browser:e}],buttonText:"enable_flash_button",onAcknowledge:function(){if(!window.isFlashCreationComplated){window.goToenableFlashPlugin("https://get.adobe.com/flashplayer/");var t=document.createElement("div"),o=document.createElement("div").setStyles({position:"absolute",left:"-6rem",top:"-4rem",color:"white",fontSize:"100px",transform:"rotate(-45deg)"});o.textContent="↑",((i=navigator.userAgent.match(/Chrome\/([0-9]+)\./))?parseInt(i[1]):0)>=76?o.setStyles({display:"none"}):(BeFunky.isEdge||"ar"===window.browserlng)&&o.setStyles({left:"",right:"-6rem",transform:"rotate(45deg)"}),t.appendChild(o),t.appendChild(n),BeFunky.acknowledge(t,{heading:["enable_flash_heading",{browser:e}],onAcknowledge:function(){}})}var i}});if(!BeFunky.flashDisabledPanel){BeFunky.flashDisabledPanel=document.createElement("div"),BeFunky.flashDisabledPanel.setStyles({position:"absolute",top:"50%",left:"50%",height:"270px",maxWidth:"450px",marginTop:"-150px",marginLeft:"-225px",padding:"20px 30px",zIndex:"1",pointerEvents:"none",background:"#fff"}),BeFunky.flashDisabledPanel.innerHTML='\n                <h4 style="margin-bottom:18px;">Enable Flash for Firefox</h4>\n                <p>Firefox now requires you to enable Flash to use BeFunky. Don\'t worry, it\'s easy to do. Click the <strong>Enable Flash</strong> button below, then click <strong>Allow</strong> when Firefox\'s prompt appears.</p>\n                <button class="button button--blue" style="padding: 0 1rem;">Enable Flash</button>            \n            ';var i=document.getElementById("main");i.insertBefore(BeFunky.flashDisabledPanel,i.firstElementChild)}BeFunky.flashDisabledPanel.setStyles({display:"block"})},document.addEventListener("visibilitychange",function(){var e=new Date,t=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();console.log("Tab "+document.visibilityState+" at "+t)});var Et=void 0,St=void 0,It=void 0,Ct=void 0,Lt=void 0;window.getWindowWidth=function(){return window.innerWidth},window.getWindowHeight=function(){return window.innerHeight},window.setInitFlashHeight=function(){var e=getWindowHeight();return window.flashFreeTop>0&&(e-=window.flashFreeTop),e},window.setInitFlashWidth=function(){var e=getWindowWidth();if(It=It||document.getElementById("main"),window.isflashFreeRight){e>=980?170!=window.flashFreeRight&&(window.flashFreeRight=170,"-5000px"!=It.style.top&&addRightAds(!0)):e<980&&0!=window.flashFreeRight&&(window.flashFreeRight=0,removeAds(!0));try{var t=setInitFlashHeight()/2-300;t<5&&(t=5),document.getElementById("0x00001002").style.paddingTop=t+"px"}catch(e){}e-=window.flashFreeRight}return e},window.reResizeFlashHeight=function(){if(!BeFunky.isUseHTML5&&(BeFunky.isPlus()&&(window.removeAds(),window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1),"-5000px"!=(It=It||document.getElementById("main")).style.top&&"-5000"!=It.style.top&&-5e3!=It.style.top)){if(BeFunky.isPlus()||calculateAdWidth(),It.setStyles({top:"",left:"",width:setInitFlashWidth()+"px",height:setInitFlashHeight()+"px"}),!1===BeFunky.isUseHTML5)try{(Lt=Lt||document.getElementById(BeFunky.Params.swfId)).setAttribute("width",setInitFlashWidth()),Lt.setAttribute("height",setInitFlashHeight())}catch(e){}(Ct=Ct||document.getElementById("site_root")||document.getElementById("wrapper")).setStyles({display:"none"});try{window.dispatchEvent(new Event("resize"))}catch(e){}}},window.calculateAdWidth=function(){var e=getWindowWidth(),t=e;Et=Et||document.getElementById("socialSharingDiv"),St=St||document.getElementById("relamIc"),Et&&"none"!==Et.style.display&&(t=e-240),St&&St.setStyles({width:t+"px",margin:"0px 0 0 0"})},window.windowOpenerInterval=null,window.createJavascriptElements=function(e,t){var n,o,i,a,r,s;null!=e&&(n=e,o=null,i=null,a=null,r=t,(s=document.createElement("script")).type="text/javascript",s.async=null==t,s.src=n,o&&(s.id=o),i&&s.setAttribute(i,a),null!=r&&(s.onreadystatechange=r,s.onload=r),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(s))},window.toFlex=function(e){if(null!=windowOpenerInterval)try{clearInterval(windowOpenerInterval)}catch(e){}switch(windowOpenerInterval=null,snLoggedinType){case"save&share":BeFunky.throwError("toFlex save&share requested",e);break;case"login":BeFunky.throwError("toFlex login requested",e);break;case"upload":BeFunky.throwError("toFlex upload requested",e)}snLoggedinType=""},window.CheckVersion=function(){if(!BeFunky.isUseHTML5){var e="undefined";try{e=swfobject.getFlashPlayerVersion().major,"undefined"!=typeof swfobject&&null!=e&&e>=parseInt(BeFunky.Params.swfMinVersion.split(".")[0])!=!0&&(BeFunky.Params.isFlashPlayerCorrect=!1)}catch(e){BeFunky.Params.isFlashPlayerCorrect=!0}}},window.isEmailAddress=function(e){return/^[\w-+]+(\.[\w-+]+)*@([\w-]+\.)+[a-zA-Z]{2,10}$/.test(e)},window.StringBuffer=function(){this.buffer=[]},window.StringBuffer.prototype.append=function(e){return this.buffer.push(e),this},window.StringBuffer.prototype.toString=function(){return this.buffer.join("")},window.azrNumberFormatterRanges=[{divider:1e18,suffix:"P"},{divider:1e15,suffix:"E"},{divider:1e12,suffix:"T"},{divider:1e9,suffix:"G"},{divider:1e6,suffix:"M"},{divider:1e3,suffix:"K"}],window.azrFormatNumber=function(e){if(e<1e4)return e.toString();var t=10;(e>=1e5&&e<1e6||e>=1e8&&e<1e9)&&(t=0);for(var n=0;n<azrNumberFormatterRanges.length;n++)if(e>=azrNumberFormatterRanges[n].divider)return(Math.round(e/azrNumberFormatterRanges[n].divider*t)/t).toString()+azrNumberFormatterRanges[n].suffix;return e.toString()},window.azrUnformatNumber=function(e){e=e.toString();for(var t=0;t<azrNumberFormatterRanges.length;t++)if(e.substr(e.length-1)===azrNumberFormatterRanges[t].suffix)return parseInt(parseFloat(e.substr(0,e.length-1))*azrNumberFormatterRanges[t].divider);return parseInt(e)};try{window.base64_encode=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=new StringBuffer,o=new Utf8EncodeEnumerator(e);o.moveNext();){var i=o.current;o.moveNext();var a=o.current;o.moveNext();var r=o.current,s=i>>2,l=(3&i)<<4|a>>4,u=(15&a)<<2|r>>6,c=63&r;isNaN(a)?u=c=64:isNaN(r)&&(c=64),n.append(t.charAt(s)+t.charAt(l)+t.charAt(u)+t.charAt(c))}return n.toString()}}catch(e){}try{window.base64_decode=function(e){for(var t=new StringBuffer,n=new Base64DecodeEnumerator(e);n.moveNext();){var o=n.current;if(128>o)t.append(String.fromCharCode(o));else if(o>191&&224>o){n.moveNext();var i=n.current;t.append(String.fromCharCode((31&o)<<6|63&i))}else{n.moveNext();i=n.current;n.moveNext();var a=n.current;t.append(String.fromCharCode((15&o)<<12|(63&i)<<6|63&a))}}return t.toString()}}catch(e){}window.Utf8EncodeEnumerator=function(e){this._input=e,this._index=-1,this._buffer=[]},window.Utf8EncodeEnumerator.prototype={current:Number.NaN,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var e=this._input.charCodeAt(++this._index);return 13==e&&10==this._input.charCodeAt(this._index+1)&&(e=10,this._index+=2),e<128?this.current=e:e>127&&e<2048?(this.current=e>>6|192,this._buffer.push(63&e|128)):(this.current=e>>12|224,this._buffer.push(e>>6&63|128),this._buffer.push(63&e|128)),!0}},window.Base64DecodeEnumerator=function(e){this._input=e,this._index=-1,this._buffer=[]},window.Base64DecodeEnumerator.prototype={current:64,codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var e=this.codex.indexOf(this._input.charAt(++this._index)),t=this.codex.indexOf(this._input.charAt(++this._index)),n=this.codex.indexOf(this._input.charAt(++this._index)),o=this.codex.indexOf(this._input.charAt(++this._index)),i=e<<2|t>>4,a=(15&t)<<4|n>>2,r=(3&n)<<6|o;return this.current=i,64!=n&&this._buffer.push(a),64!=o&&this._buffer.push(r),!0}};try{window.MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,o,i,a,r;return i=2147483648&e,a=2147483648&t,r=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(o=1073741824&t)?2147483648^r^i^a:n|o?1073741824&r?3221225472^r^i^a:1073741824^r^i^a:r^i^a}function o(e,o,i,a,r,s,l){return e=n(e,n(n(o&i|~o&a,r),l)),n(t(e,s),o)}function i(e,o,i,a,r,s,l){return e=n(e,n(n(o&a|i&~a,r),l)),n(t(e,s),o)}function a(e,o,i,a,r,s,l){return e=n(e,n(n(o^i^a,r),l)),n(t(e,s),o)}function r(e,o,i,a,r,s,l){return e=n(e,n(n(i^(o|~a),r),l)),n(t(e,s),o)}function s(e){var t,n="",o="";for(t=0;t<=3;t++)n+=(o="0"+(e>>>8*t&255).toString(16)).substr(o.length-2,2);return n}var l,u,c,d,p,g,h,m,f,y=Array();for(y=function(e){for(var t,n=e.length,o=n+8,i=16*((o-o%64)/64+1),a=Array(i-1),r=0,s=0;s<n;)r=s%4*8,a[t=(s-s%4)/4]=a[t]|e.charCodeAt(s)<<r,s++;return r=s%4*8,a[t=(s-s%4)/4]=a[t]|128<<r,a[i-2]=n<<3,a[i-1]=n>>>29,a}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t}(e)),g=1732584193,h=4023233417,m=2562383102,f=271733878,l=0;l<y.length;l+=16)u=g,c=h,d=m,p=f,g=o(g,h,m,f,y[l+0],7,3614090360),f=o(f,g,h,m,y[l+1],12,3905402710),m=o(m,f,g,h,y[l+2],17,606105819),h=o(h,m,f,g,y[l+3],22,3250441966),g=o(g,h,m,f,y[l+4],7,4118548399),f=o(f,g,h,m,y[l+5],12,1200080426),m=o(m,f,g,h,y[l+6],17,2821735955),h=o(h,m,f,g,y[l+7],22,4249261313),g=o(g,h,m,f,y[l+8],7,1770035416),f=o(f,g,h,m,y[l+9],12,2336552879),m=o(m,f,g,h,y[l+10],17,4294925233),h=o(h,m,f,g,y[l+11],22,2304563134),g=o(g,h,m,f,y[l+12],7,1804603682),f=o(f,g,h,m,y[l+13],12,4254626195),m=o(m,f,g,h,y[l+14],17,2792965006),g=i(g,h=o(h,m,f,g,y[l+15],22,1236535329),m,f,y[l+1],5,4129170786),f=i(f,g,h,m,y[l+6],9,3225465664),m=i(m,f,g,h,y[l+11],14,643717713),h=i(h,m,f,g,y[l+0],20,3921069994),g=i(g,h,m,f,y[l+5],5,3593408605),f=i(f,g,h,m,y[l+10],9,38016083),m=i(m,f,g,h,y[l+15],14,3634488961),h=i(h,m,f,g,y[l+4],20,3889429448),g=i(g,h,m,f,y[l+9],5,568446438),f=i(f,g,h,m,y[l+14],9,3275163606),m=i(m,f,g,h,y[l+3],14,4107603335),h=i(h,m,f,g,y[l+8],20,1163531501),g=i(g,h,m,f,y[l+13],5,2850285829),f=i(f,g,h,m,y[l+2],9,4243563512),m=i(m,f,g,h,y[l+7],14,1735328473),g=a(g,h=i(h,m,f,g,y[l+12],20,2368359562),m,f,y[l+5],4,4294588738),f=a(f,g,h,m,y[l+8],11,2272392833),m=a(m,f,g,h,y[l+11],16,1839030562),h=a(h,m,f,g,y[l+14],23,4259657740),g=a(g,h,m,f,y[l+1],4,2763975236),f=a(f,g,h,m,y[l+4],11,1272893353),m=a(m,f,g,h,y[l+7],16,4139469664),h=a(h,m,f,g,y[l+10],23,3200236656),g=a(g,h,m,f,y[l+13],4,681279174),f=a(f,g,h,m,y[l+0],11,3936430074),m=a(m,f,g,h,y[l+3],16,3572445317),h=a(h,m,f,g,y[l+6],23,76029189),g=a(g,h,m,f,y[l+9],4,3654602809),f=a(f,g,h,m,y[l+12],11,3873151461),m=a(m,f,g,h,y[l+15],16,530742520),g=r(g,h=a(h,m,f,g,y[l+2],23,3299628645),m,f,y[l+0],6,4096336452),f=r(f,g,h,m,y[l+7],10,1126891415),m=r(m,f,g,h,y[l+14],15,2878612391),h=r(h,m,f,g,y[l+5],21,4237533241),g=r(g,h,m,f,y[l+12],6,1700485571),f=r(f,g,h,m,y[l+3],10,2399980690),m=r(m,f,g,h,y[l+10],15,4293915773),h=r(h,m,f,g,y[l+1],21,2240044497),g=r(g,h,m,f,y[l+8],6,1873313359),f=r(f,g,h,m,y[l+15],10,4264355552),m=r(m,f,g,h,y[l+6],15,2734768916),h=r(h,m,f,g,y[l+13],21,1309151649),g=r(g,h,m,f,y[l+4],6,4149444226),f=r(f,g,h,m,y[l+11],10,3174756917),m=r(m,f,g,h,y[l+2],15,718787259),h=r(h,m,f,g,y[l+9],21,3951481745),g=n(g,u),h=n(h,c),m=n(m,d),f=n(f,p);return(s(g)+s(h)+s(m)+s(f)).toLowerCase()}}catch(e){}try{window.jsonParse=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function o(e,t,o){return t?n[t]:String.fromCharCode(parseInt(o,16))}var i=new String("");return Object,Array,function(n){var a,r,s=n.match(e),l=s[0];"{"===l?a={}:"["===l&&(a=[]);for(var u=[a],c=1,d=s.length;c<d;++c){var p;switch((l=s[c]).charCodeAt(0)){default:(p=u[0])[r||p.length]=+l,r=void 0;break;case 34:if(-1!==(l=l.substring(1,l.length-1)).indexOf("\\")&&(l=l.replace(t,o)),p=u[0],!r){if(!(p instanceof Array)){r=l||i;break}r=p.length}p[r]=l,r=void 0;break;case 91:p=u[0],u.unshift(p[r||p.length]=[]),r=void 0;break;case 93:u.shift();break;case 102:(p=u[0])[r||p.length]=!1,r=void 0;break;case 110:(p=u[0])[r||p.length]=null,r=void 0;break;case 116:(p=u[0])[r||p.length]=!0,r=void 0;break;case 123:p=u[0],u.unshift(p[r||p.length]={}),r=void 0;break;case 125:u.shift()}}return u.length,a}}()}catch(e){}window.parseXml=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")},window.azrc={isFunction:function(e){return"[object Function]"===toString.call(e)},isArray:function(e){return"[object Array]"===toString.call(e)},isPlainObject:function(e){if(!e||"[object Object]"!==toString.call(e)||e.nodeType||e.setInterval)return!1;if(e.constructor&&!hasOwnProperty.call(e,"constructor")&&!hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t=void 0;for(t in e);return void 0===t||hasOwnProperty.call(e,t)},extend:function(){var e=void 0,t=void 0,n=void 0,o=void 0,a=void 0,r=void 0,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"===(void 0===s?"undefined":i(s))||window.azrc.isFunction(s)||(s={}),u===l&&(s=this,--l);l<u;l++)if(null!=(e=arguments[l]))for(t in e)n=s[t],s!==(o=e[t])&&(c&&o&&(window.azrc.isPlainObject(o)||(a=window.azrc.isArray(o)))?(a?(a=!1,r=n&&window.azrc.isArray(n)?n:[]):r=n&&window.azrc.isPlainObject(n)?n:{},s[t]=window.azrc.extend(c,r,o)):void 0!==o&&(s[t]=o));return s}},BeFunky.ConvertToBool=function(e){return""!=e&&("1"==e||"true"==e||1==e||"yes"==e)},BeFunky.shareLink=function(e,t,n,o,i){var a="PINTEREST"===e.toUpperCase()?"http://pinterest.com/pin/create/button/?url="+t+"&description="+o+"&media="+n:"TWITTER"===e.toLocaleUpperCase()?BeFunky.Params.siteUrl+"tweetSend.php?url="+t+"&imgtitle="+o:"https://www.facebook.com/dialog/share?app_id=120991377944644&display=popup&href="+t;if(i)try{window.openCustomPopup(a)}catch(e){}else BeFunky.confirm("Click OK to Open Share Popup",{onConfirm:function(){try{window.openCustomPopup(a)}catch(e){}}})},window.optimizedResize=function(){var e=[],t=!1;function n(){t||(t=!0,window.requestAnimationFrame?window.requestAnimationFrame(o):setTimeout(o,66))}function o(){e.forEach(function(e){e()}),t=!1}return{add:function(t){e.length||window.addEventListener("resize",n),function(t){t&&e.push(t)}(t)}}}(),window.__documentReady=function(){var e=document.getElementById("file");null!==e&&e.addEventListener("change",function(){var t=e;if(t.files[0].size>2e6)alert("File size cannot larger than 2 mb.");else{var n=t.value.match(/\.(.+)$/)[1];switch(n=n.toLowerCase()){case"jpg":case"jpeg":case"png":document.getElementById("upload-profile-pic").submit();break;default:alert("File type ("+n+") not allowed. Please select allowed types (jpg or png).")}}},!1),window.optimizedResize.add(function(){if(!1===BeFunky.isUseHTML5){var e=document.getElementById("main");e&&e.setStyles({width:setInitFlashWidth()+"px",height:setInitFlashHeight()+"px"});try{var t=document.getElementById(BeFunky.Params.swfId);t.setAttribute("width",setInitFlashWidth()),t.setAttribute("height",setInitFlashHeight())}catch(e){}window.calculateAdWidth()}!0===BeFunky.isUseHTML5&&"undefined"!=typeof BFN&&void 0!==BFN.StageModel&&void 0!==BFN.StageModel.updateStageDimensions&&void 0!==BFN._appRect&&void 0!==BFN.BfnService&&(BFN._appRect=null,BFN.BfnService.dispatchEvent(BFN.BfnServiceEvents.CUSTOM_RESIZE_EVENT))})},BeFunky.befunkyPopupDivOpened=!1;var Pt=[];function xt(){BeFunky.LoginPanelObj.isLoggedInNextFunction&&BeFunky.LoginPanelObj.isLoggedInNextFunction===openFlash?openFlash():BeFunky.LoginPanelObj.closeNextFunction&&BeFunky.LoginPanelObj.closeNextFunction===openFlash?openFlash():BeFunky.LoginPanelObj.closeNextFunction&&"function"==typeof BeFunky.LoginPanelObj.closeNextFunction&&BeFunky.LoginPanelObj.closeNextFunction(),BeFunky.getModal()||hideModalBackgroundImage(),BeFunky.disposeServise()}BeFunky.befunkyPopupContainerOpen=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=e.replace("#",""),i=document.getElementById(o);if(t||(t={}),Pt.includes(o)||Pt.push(o),n){var a=BeFunky.getModal(),r=a?a.modalElement.id:void 0;if(Pt.includes(r)){BeFunky.preventModalDispose=!0,BeFunky.closeModal(r),BeFunky.preventModalDispose=!1;var s=document.getElementById("modal_root");s.addClass("modal-root--disable-transitions"),requestAnimationFrame(function(){s.removeClass("modal-root--disable-transitions")})}}BeFunky.befunkyPopupDivOpened=!0;var l=t.addCaptcha&&i.querySelector(".captcha"),u=t.addDigiCert&&i.querySelector(".digicert");BeFunky.openModal(i,{onOpen:function(){!function(){if(l){var e=i.querySelector("[type=submit]");e.disabled=!0,BeFunky.renderOrResetCaptcha(l,function(){e.disabled=!1})}}(),u&&(setupDcId(),u.innerHTML='<div id="'+__dcid[0][0]+'" data-language="en"></div>',initdigicert()),function(e){if(!BeFunky.isChromium)return;var t=[].concat(p(e.querySelectorAll(".material-field__input"))),n=document.hasFocus()?requestIdleCallback:function(e){return setTimeout(e,200)},o=20,i=o;n(function a(){i--;if(0===i)return;var r=BeFunky.getModal();if(r&&r.modalID!==e.id)return;var s=t.filter(function(e){return e.matches(":-webkit-autofill")});s.length?function(e){console.log("Fixing "+e.length+" auto-filled input(s) on attempt "+(o-i)+" of "+o),e.forEach(function(e){e.addClass("material-field__input--autofilled"),e.addEventListener("change",function t(){e.removeEventListener("change",t),e.removeClass("material-field__input--autofilled")})})}(s):n(a)})}(i)},onClose:function(){l&&l.parentElement.replaceChild(document.createElement("div").addClass("captcha"),l),u&&(u.innerHTML=""),function(e){var t=e.querySelector(".form-errors");t&&(t.innerHTML="");e.querySelectorAll(".material-field__input--invalid").removeClass("material-field__input--invalid")}(i),BeFunky.preventModalDispose?BeFunky.befunkyPopupDivOpened=!1:xt(),"function"==typeof i.onModalClose&&i.onModalClose()},addSiteClass:!0,addCloseButton:!0,size:"large",isCritical:!!t.isCritical,destroyOnClose:!!t.destroyOnClose})},BeFunky.befunkyPopupContainerClose=function(){if(BeFunky.befunkyPopupDivOpened){BeFunky.registerComeFromUpgrade=!1;var e=BeFunky.getModal(),t=e?e.modalElement.id:void 0;t&&BeFunky.closeModal(t);var n=document.getElementById("modal_root");n.addClass("modal-root--disable-transitions"),requestAnimationFrame(function(){n.removeClass("modal-root--disable-transitions"),xt()})}return!1},BeFunky.disposeServise=function(){BeFunky.befunkyPopupDivOpened=!1,null!==document.getElementById("hiddenFancyContainer")&&(document.getElementById("hiddenFancyContainer").innerHTML=""),BeFunky.LoginPanelObj.panelType="SIGNIN",BeFunky.LoginPanelObj.isLoggedInNextFunction=!1,BeFunky.LoginPanelObj.closeNextFunction=!1,BeFunky.registerComeFromUpgrade=!1},BeFunky.captchaWidget=null,BeFunky.renderOrResetCaptcha=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)return BeFunky.throwError("Unable to find captcha container"),t();!function(e){if(n())return e();var t="//www.google.com/recaptcha/api.js?"+["hl="+BeFunky.LanguageManager.language[window.isFlashOpenned?"app":"site"],"render=explicit"].join("&");function n(){return window.grecaptcha&&"function"==typeof window.grecaptcha.render}window.createJavascriptElements(t),BeFunky.waitUntil({condition:n,interval:300,maxAttempts:1e3,onSuccess:e,onTimeout:function(){BeFunky.throwError("Unable to load Google ReCAPTCHA",{grecaptcha:window.grecaptcha})}})}(function(){if(e.firstElementChild)return window.grecaptcha.reset(),t();var n=BeFunky.Params.IS_LC?"6LePbqoUAAAAAITuugtKJnS15GkfdP5MZGInsrk8":"6LcXOpkUAAAAAOKNQzyDv-gS8Nu6cTgwW6m3sXQu";return BeFunky.captchaWidget=window.grecaptcha.render(e,{sitekey:n,hl:BeFunky.LanguageManager.language[window.isFlashOpenned?"app":"site"],size:"invisible",callback:function(e){""!==e&&(BeFunky.invisibleCaptchaHandler(e),console.log("User successfully completed captcha"))}}),t()})},BeFunky.getCaptchaResponse=function(){try{return window.grecaptcha.getResponse(BeFunky.captchaWidget)}catch(e){}return""},BeFunky.invisibleCaptchaHandler=function(){"function"==typeof BeFunky.executeCaptchaCallback&&(BeFunky.executeCaptchaCallback(),BeFunky.executeCaptchaCallback=null)},BeFunky.executeCaptchaCallback=null,BeFunky.executeCaptcha=function(e){if(BeFunky.executeCaptchaCallback=e,window.grecaptcha.execute(BeFunky.captchaWidget),window.innerHeight<650){var t=void 0;BeFunky.waitUntil({condition:function(){return!!(t=t||[].concat(p(document.querySelectorAll('iframe[title^="recaptcha"]'))).find(function(e){try{return"hidden"!==e.parentElement.parentElement.style.visibility}catch(e){}return!1}))},onTimeout:function(){},onSuccess:function(){var e=t.parentElement.getBoundingClientRect().top;t.parentElement.setStyles({maxHeight:"calc(100vh - "+e+"px)",overflowY:"auto"})},interval:300,maxAttempts:15})}},window.flashFreeTop=100,window.isflashFreeRight=!0,window.flashFreeRight=170,window.adRefreshCounter=0,window.googletag=window.googletag||{},googletag.cmd=googletag.cmd||[],window.ad_slot1=null,window.ad_slot2=null,window.ad_slot3=null,window.is_ads_added=!1,window.is_ads_initted=!1,window.slot_rendered_count=0,window.isadblocked=!1,window.checkAdblockIntervarCount=0,window.initAds=function(){document.getElementById("0x00001001").innerHTML='\n        <div id="div-gpt-ad-1466445154244-0" style="height: 90px; z-index:1010; display: block;"  class="pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links adsbox doubleclick ad-placement carbon-ads"></div>\n        <div id="bfn-plus-dsp-bottom" style="height: 90px; z-index:1011; display:none;"><a href="'+BeFunky.Params.siteUrl+"features/befunky-plus/\" onclick=\"try{if(document.getElementById(BeFunky.Params.swfId) != null && typeof document.getElementById(BeFunky.Params.swfId).upgradePanelListener != 'undefined'){document.getElementById(BeFunky.Params.swfId).upgradePanelListener('BOTTOM_BNR');} else {BeFunky.openUpgradePanel('BOTTOM_BNR');}} catch(err){} return false;\"><img data-src=\""+BeFunky.Params.globalImagesPath+'befunky-plus-dsp-bottom-final-v1.jpg" border="0" class="notlazy" style="display: block !important;"/></a></div>\n    ',document.getElementById("rightReklamIc").innerHTML='\n        <div id="div-gpt-ad-1466462088410-0" style="width: 160px; height: 600px; z-index:1010; display: block;" class="pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links adsbox doubleclick ad-placement carbon-ads"></div>\n        <div id="bfn-plus-dsp-right" style="width: 160px; height: 600px; z-index:1011; display:none;"><a href="'+BeFunky.Params.siteUrl+"features/befunky-plus/\" onclick=\"try{if(document.getElementById(BeFunky.Params.swfId) != null && typeof document.getElementById(BeFunky.Params.swfId).upgradePanelListener != 'undefined'){document.getElementById(BeFunky.Params.swfId).upgradePanelListener('RIGHT_BNR');} else {BeFunky.openUpgradePanel('RIGHT_BNR');}} catch(err){} return false;\"><img data-src=\""+BeFunky.Params.globalImagesPath+'befunky-plus-dsp-right-final-v1.jpg" border="0" class="notlazy" style="display: block !important;"/></a></div>    \n    ',"none"===document.querySelector(".doubleclick").style.display?(slot_rendered_count=0,checkAdblockIntervarCount=5,checkAdBlocker(!1,!0)):(!function(){var e=document.createElement("script");e.async=!0,e.type="text/javascript";var t="https:"==document.location.protocol;e.src=(t?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}(),googletag.cmd.push(function(){googletag.pubads().enableSingleRequest(),googletag.enableServices(),is_ads_initted=!0,googletag.pubads().addEventListener("slotRenderEnded",function(e){slot_rendered_count+=1})}))},window.addAds=function(){0!=is_ads_initted?(null!=ad_slot1&&0!=is_ads_initted&&googletag.destroySlots([ad_slot1]),ad_slot1=null,is_ads_added=!1,googletag.cmd.push(function(){ad_slot1=googletag.defineSlot("/291414075/BeFunky_AllPages_Above_The_Fold_970_90",[728,90],"div-gpt-ad-1466445154244-0").addService(googletag.pubads())}),setTimeout(function(){null!=ad_slot1&&0!=is_ads_initted&&0==is_ads_added&&(googletag.cmd.push(function(){googletag.display("div-gpt-ad-1466445154244-0")}),is_ads_added=!0,addRightAds(isFlashCreationComplated))},333)):0==isadblocked?setTimeout("addAds()",100):setTimeout("checkAdBlocker(true)",555)},window.addRightAds=function(e){if(window.flashFreeRight>0&&1==window.isflashFreeRight&&BeFunky.Params.isShowAds>0&&0==("1"==BeFunky.User.FlashVarsObject.pl||BeFunky.User.FlashVarsObject.pl>0)){try{document.getElementById("0x00001002").style.cssText+=";display: block !important;"}catch(e){}1==is_ads_added&&0!=is_ads_initted?(null!=ad_slot2&&googletag.destroySlots([ad_slot2]),ad_slot2=null,ad_slot3=null,googletag.cmd.push(function(){ad_slot2=googletag.defineSlot("/291414075/wide_skyscrapper",[160,600],"div-gpt-ad-1466462088410-0").addService(googletag.pubads())}),setTimeout(function(){try{var e=setInitFlashHeight()/2-300;if(e<5&&(e=5),document.getElementById("0x00001002").setStyles({"padding-top":e+"px"}),170==window.flashFreeRight&&null!=ad_slot2)try{googletag.cmd.push(function(){googletag.display("div-gpt-ad-1466462088410-0")})}catch(e){}if(0==slot_rendered_count)setTimeout("checkAdBlocker()",1e3);else try{document.getElementById("bfn-plus-dsp-bottom").style.cssText+=";display: none !important;",document.getElementById("bfn-plus-dsp-right").style.cssText+=";display: none !important;"}catch(e){}}catch(e){}},555)):0==slot_rendered_count&&setTimeout("checkAdBlocker()",1e3)}},window.checkAdBlocker=function(e,t){try{document.getElementById("bfn-plus-dsp-bottom").style.cssText+=";display: none !important;",document.getElementById("bfn-plus-dsp-right").style.cssText+=";display: none !important;"}catch(e){}if(0==slot_rendered_count)if(checkAdblockIntervarCount>4){if(isadblocked=!0,e||window.bf_eventTrack("EXTERNAL","AD_BLOCK","OPENED"),0==(t|=!1)&&BeFunky.Params.isShowAds>0&&0==("1"==BeFunky.User.FlashVarsObject.pl||BeFunky.User.FlashVarsObject.pl>0)){try{document.getElementById("bfn-plus-dsp-bottom").style.cssText+=";display: block !important;",document.querySelector("#bfn-plus-dsp-bottom img").dataset.src!=document.querySelector("#bfn-plus-dsp-bottom img").src&&(document.querySelector("#bfn-plus-dsp-bottom img").src=document.querySelector("#bfn-plus-dsp-bottom img").dataset.src)}catch(e){}if(window.flashFreeRight>0&&1==window.isflashFreeRight){document.getElementById("0x00001002").style.cssText+=";display: block !important;";var n=setInitFlashHeight()/2-300;n<5&&(n=5),document.getElementById("0x00001002").setStyles({"padding-top":n+"px"});try{document.getElementById("bfn-plus-dsp-right").style.cssText+=";display: block !important;",document.querySelector("#bfn-plus-dsp-right img").dataset.src!=document.querySelector("#bfn-plus-dsp-right img").src&&(document.querySelector("#bfn-plus-dsp-right img").src=document.querySelector("#bfn-plus-dsp-right img").dataset.src)}catch(e){}}}}else checkAdblockIntervarCount+=1,setTimeout("checkAdBlocker()",1e3)},window.removeAds=function(e){if(1!=e){try{document.getElementById("reklamDiv").style.cssText+=";display: none !important;",document.getElementById("0x00001002").style.cssText+=";display: none !important;"}catch(e){}document.getElementById("reklamDiv").innerHTML="",document.getElementById("0x00001002").innerHTML=""}flasRightBarAdDisplay(!0,e)},window.refreshAds=function(e){setTimeout(function(){try{1==is_ads_added&&null!=ad_slot1&&0!=is_ads_initted&&BeFunky.Params.isShowAds>0&&0==("1"==BeFunky.User.FlashVarsObject.pl||BeFunky.User.FlashVarsObject.pl>0)&&"none"!=document.getElementById("reklamDiv").style.display&&(googletag.pubads().refresh([ad_slot1]),null!=ad_slot2&&170==window.flashFreeRight&&"none"!=document.getElementById("reklamDiv").style.display?googletag.pubads().refresh([ad_slot2]):null!=ad_slot3&&130==flashFreeRight&&googletag.pubads().refresh([ad_slot3]))}catch(e){}},2500)},window.flasRightBarAdDisplay=function(e,t){var n=!1;if(null!=e&&1==e&&(n=!0),1==n)try{if(1!=t){document.getElementById("reklamDiv").removeClass("top-reklam-with-app").addClass("top-reklam-normal"),document.getElementById("relamIc").removeClass("top-reklam-with-app").addClass("top-reklam-normal");try{document.getElementById("reklamDiv").style.cssText+=";display: none !important;"}catch(e){}null!=ad_slot1&&0!=is_ads_initted&&(googletag.destroySlots([ad_slot1]),ad_slot1=null)}try{document.getElementById("0x00001002").style.cssText+=";display: none !important;"}catch(e){}null!=ad_slot2&&0!=is_ads_initted&&(googletag.destroySlots([ad_slot2]),ad_slot2=null)}catch(e){}else{try{document.getElementById("reklamDiv").removeClass("top-reklam-normal").addClass("top-reklam-with-app"),document.getElementById("relamIc").removeClass("top-reklam-normal").addClass("top-reklam-with-app");try{document.getElementById("reklamDiv").style.cssText+=";display: block !important;"}catch(e){}if(document.getElementById("0x00001002").innerHTML.length>0&&document.getElementById("div-gpt-ad-1466462088410-0").innerHTML.length>0&&window.flashFreeRight>0)try{document.getElementById("0x00001002").style.cssText+=";display: block !important;"}catch(e){}}catch(e){}try{BeFunky.Params.isShowAds>0&&addAds()}catch(e){}}},BeFunky.disableAdsForPlusUsers=function(){BeFunky.isPlus()&&(window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1),BeFunky.Params.isShowAds=BeFunky.isPlus()?0:1,!0===window.webgl_is_supported&&"flash"!==window.useAppType&&(document.querySelectorAll(".doubleclick").setStyles({display:"none"}),BeFunky.Params.isShowAds=0,window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1,window.removeAds())},window.__dcid=null,window.setupDcId=function(){null===__dcid&&(__dcid=[],BeFunky.Params.siteUrl.includes("www.befunky.com")?__dcid.push(["DigiCertClickID_AJLt6s8v","3","s","black","AJLt6s8v"]):__dcid.push(["DigiCertClickID_NazvGaQE","10","s","black","NazvGaQE"]))},window.initdigicert=function(){var e="//seal.digicert.com/seals/cascade/seal.min.js";try{var t=document.querySelector('script[src="'+e+'"]');t.parentNode.removeChild(t)}catch(e){}!function(){var t=document.createElement("script");t.async=!0,t.src=e;var n=document.getElementsByTagName("script"),o=n[n.length-1];o.parentNode.insertBefore(t,o.nextSibling)}()},BeFunky.closeAccount=function(e){var t={closeKey:e};BeFunky.requestAPI("auth/close-account",t,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(BeFunky.updateAccountCloseStatus,2555)}).catch(function(e){BeFunky.throwError("Unable to close account",JSON.stringify({error:e})),Rt()})};var At=!1,Tt=0;function Rt(){var e=document.createElement("div"),t=document.createElement("p").setLang("error_close_account"),n=document.createElement("p").setLang("error_please_refresh",{contact_support:function(){return'<a href="https://support.befunky.com/hc/en-us/requests/new">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}});e.appendChild(t),e.appendChild(n),BeFunky.acknowledge(e)}BeFunky.updateAccountCloseStatus=function(){At||(At=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(function(e){At=!1;var t=parseInt(e.data.stepPercentageComplete)||0;if(t?Tt=t:Tt++,BeFunky.showLoadScreen({message:"closing_account",progress:Tt}),1===parseInt(e.data.isFinished))return BeFunky.hideLoadScreen(),void BeFunky.acknowledge("account_deleted",{onAcknowledge:function(){window.location.href=BeFunky.Params.siteUrl+"sign-out/"}});setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(function(e){At=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:e})),Rt()}))},window.get_browser=function(){var e=navigator.userAgent,t=void 0,n=e.match(/(opera|chrome|safari|firefox|msie|edge|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return{name:"IE",version:(t=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""};if("Chrome"===n[1]){if(null!=(t=e.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:t[1]};if(null!=(t=e.match(/\Edge\/(\d+)/)))return{name:"Edge",version:t[1]}}return n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&n.splice(1,1,t[1]),{name:n[0],version:n[1]}},window.getBrowserData=function(e){var t={},n=t.uaString=e.userAgent,o=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];o[1]&&(o[1]=o[1].toLowerCase());var i="chrome"===o[1],a="chrome"===o[1];if(i&&(i=n.match(/\bOPR\/([\d\.]+)/)),a&&(a=n.match(/\Edge\/([\d\.]+)/)),/trident/i.test(o[1])){var r=/\brv[ :]+([\d\.]+)/g.exec(n)||[];t.name="msie",t.version=r[1]}else if(i)t.name="opera",t.version=i[1];else if(a)t.name="edge",t.version=a[1];else if("safari"===o[1]){var s=n.match(/version\/([\d\.]+)/i);t.name="safari",t.version=s[1]}else t.name=o[1],t.version=o[2];var l=[];if(t.version){for(var u=t.version.match(/(\d+)/g)||[],c=0;c<u.length;c++)l.push(u[c]);l.length>0&&(t.majorVersion=l[0])}return t.name=t.name||"(unknown browser name)",t.version={full:t.version||null,parts:l,major:l.length>0?l[0]:""},t},window.getSystemInformation=function(e){try{var t=null,n=null;try{var o=get_browser();t=o.name,n=Number(o.version)}catch(e){}try{var i=getBrowserData(window.navigator||navigator);null!=i.version.full&&(n=i.version.full)}catch(e){}var a=navigator.userAgent,r="",s="",l="";window.screen&&screen.width&&screen.height&&(l+=screen.width+" x "+screen.height);var u=[{s:"ChromeOS",r:/(CrOS)/},{s:"ChromeOS",r:/\bCrOS\b/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];if(""!=a)try{for(var c in u){var d=u[c];if(d.r.test(a)){r=d.s;break}}switch(/Windows/.test(r)&&(s=/Windows (.*)/.exec(r)[1],r="Windows"),r){case"Mac OS X":s=/Mac OS X (10[\.\_\d]+)/.exec(a)[1];break;case"Android":s=/Android ([\.\_\d]+)/.exec(a)[1];break;case"iOS":s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer))[1]+"."+s[2]+"."+(0|s[3])}}catch(e){}try{null!=r&&r.length<1&&(r=a)}catch(e){}var p=void 0!==window.webglTextureSize&&null!==window.webglTextureSize?window.webglTextureSize:-1,g=void 0!==window.webglCombinedTextureUnits&&null!==window.webglCombinedTextureUnits?window.webglCombinedTextureUnits:-1,h=void 0!==window.webglUnmaskedRenderer&&null!==window.webglUnmaskedRenderer?window.webglUnmaskedRenderer:-1;window.systemInfo={browser:null!=t?t:"",browserVersion:null!=n?n:"",os:""!=r&&null!=r?r:"",osVersion:""!=s&&null!=s?s:"",wbglts:p,wbglcts:g,wbglumr:h};var m="--OS: "+window.systemInfo.os+" "+window.systemInfo.osVersion+", --BROWSER: "+window.systemInfo.browser+" "+window.systemInfo.browserVersion+", --WBGLTS: "+window.systemInfo.wbglts+", --WBGLCTS: "+window.systemInfo.wbglcts+", --WBGLUMR: "+window.systemInfo.wbglumr+", --SCREEN: "+l+", --APP_TYPE: "+(1==window.webgl_is_supported?"HTML5":"FLASH");return e?m:window.systemInfo}catch(e){}return e?"":{error:!0}},BeFunky.webGLDetectionComplete=!1,window.webgl_is_supported=!1,window.graphic_black_list=["Mobile Intel(R) 4 Series Express Chipset","Intel(R) G41 Express Chipset","Intel(R) Q45/Q43 Express Chipset","Intel(R) G45/G43 Express Chipset","Intel(R) 965 Express Chipset","PowerVR Rogue GX6250","NVIDIA Quadro FX 540","NVIDIA Quadro FX 1400","NVIDIA Quadro FX 3450","NVIDIA GeForce G102M","NVIDIA GeForce 6100","NVIDIA GeForce 6150SE","NVIDIA GeForce 6150","NVIDIA GeForce 6600","NVIDIA GeForce 7000","NVIDIA GeForce 7025 / NVIDIA nForce 630a","NVIDIA GeForce 7050","NVIDIA GeForce 7100","NVIDIA GeForce 7150M","NVIDIA GeForce 7300","NVIDIA GeForce Go 7600","NVIDIA GeForce 7900","NVIDIA GeForce 8200","NVIDIA GeForce 8400","NVIDIA GeForce 9300","NVIDIA GeForce 9400","ATI Radeon HD 2400","ATI Radeon 3000 Graphics","ATI Radeon 3100 Graphics","ATI Radeon HD 3200","ATI Mobility Radeon HD 4530","AMD Radeon HD 6300M"],window.isHighSierraWithSafari11=!1,window.useAppType=window.getCookie("apptype"),window.webGLSupportControl=function(){BeFunky.webGLDetectionComplete=!0,"html5"===window.useAppType&&(window.graphic_black_list=[]),BeFunky.Params.canUseWebapp&&window.setWebGLIsSupported(),window.isWindowsOld||window.webglTextureSize<=4096||!window.isRetina()?window.bfn_resolution=1:window.bfn_resolution=2;var e=getCookie("gl_sprt"),t=BeFunky.getLocal("__IndexedDB_version");if("1"!==e&&!t||window.webgl_is_supported?setCookie("gl_sprt",window.webgl_is_supported?"1":"0",365):(window.webgl_is_supported=!0,window.BfnmaxImageSize||(BeFunky.logError("Enabling WebGL even though detection failed","1"===e,!!t),window.BfnmaxImageSize=4088)),BeFunky.macOSVersion>=13&&BeFunky.isSafari){var n=0;try{n=Number(window.get_browser().version)}catch(e){}window.isHighSierraWithSafari11=n>10}if(window.webgl_is_supported&&BeFunky.isInternetExplorer){try{console.log("Browser:",JSON.stringify(get_browser()))}catch(e){}BeFunky.throwError("WebGL app enabled in IE")}},window.setWebGLIsSupported=function(){window.bfn_resolution=1,window.bfn_antialias=!1,window.isWindowsOld=!1;var e=null;try{e=navigator.userAgent}catch(e){}var t=null;try{navigator&&void 0!==navigator.deviceMemory&&(t=navigator.deviceMemory)}catch(e){}try{if(null!=t&&t<=2&&/Windows/.test(e)&&!1==!window.location.href.includes("www.befunky.com"))return void(window.webgl_is_supported=!1)}catch(e){}try{if(/(Windows NT 5.1|Windows NT 5.2|Windows NT 6.0|Windows XP)/.test(e))return void(window.webgl_is_supported=!1)}catch(e){}try{if(/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/.test(e)){var n=/10[\.\_\d]+/.exec(e)[0];/[\_]/.test(n)&&(n=n.split("_").join("."));var o=n.split(".");if(o[1]&&parseInt(o[1])<10)return void(window.webgl_is_supported=!1)}}catch(e){}try{/(Windows 7|Windows NT 6.1)/.test(e)&&(window.isWindowsOld=!0)}catch(e){}window.webgl_is_supported=!0;var i=null;if(0==function(){var e=null;try{var t=get_browser();i=t.name,e=Number(t.version)}catch(e){}return null==e||0!=isNaN(e)||null==i||!("CHROME"==i.toUpperCase()&&e<55||"FIREFOX"==i.toUpperCase()&&e<48||"MSIE"==i.toUpperCase()&&e<=11||"IE"==i.toUpperCase()&&e<=11||"EDGE"==i.toUpperCase()&&e<=14||"SAFARI"==i.toUpperCase()&&e<10||BeFunky.isMac&&BeFunky.macOSVersion<11&&"SAFARI"==i.toUpperCase()&&e<=10||"OPERA"==i.toUpperCase()&&e<40)}())window.webgl_is_supported=!1;else{var a=null,r=null;try{r=document.createElement("canvas");var s={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0};a=r.getContext("webgl",s)||r.getContext("experimental-webgl",s)}catch(e){}if(a&&null!=a&&a instanceof WebGLRenderingContext){var l=a.getExtension("OES_standard_derivatives");window.webglTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);var u=window.webglTextureSize>=4096;try{null!=t&&t<=2&&!1==!window.location.href.includes("www.befunky.com")&&4096==window.webglTextureSize&&(l=null)}catch(e){}if(null!=l&&1==u&&"undefined"!=typeof graphic_black_list&&u&&void 0!==i)try{var c=a.getExtension("WEBGL_debug_renderer_info");if(null!=c){window.webglUnmaskedRenderer=a.getParameter(c.UNMASKED_RENDERER_WEBGL);for(var d=0;d<graphic_black_list.length;d++)if(webglUnmaskedRenderer.includes(graphic_black_list[d])){l=null;break}null!=l&&(setTimeout(function(){window.bf_eventTrack("EXTERNAL","WEBGL_GRAPHIC",window.webglUnmaskedRenderer)},3100),navigator&&void 0!==navigator.deviceMemory&&setTimeout(function(){window.bf_eventTrack("EXTERNAL","DEVICE_MEMORY",navigator.deviceMemory)},3110))}}catch(e){}if(null!=l&&u){window.webgl_is_supported=!0,window.FixedPixiPaddingSize=8;window.BfnmaxImageSize=4096-window.FixedPixiPaddingSize,window.webglCombinedTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);var p=window.webglTextureSize>window.BfnmaxImageSize&&window.webglCombinedTextureUnits>79?8192:Math.min(4096,window.webglTextureSize)||4096;window.BfnmaxImageSize=Math.min(window.BfnmaxImageSize,p-window.FixedPixiPaddingSize),console.log("Max Image Size Set:",window.BfnmaxImageSize,"Max Image Size that BeFunky can support:",p)}else window.webgl_is_supported=!1}else window.webgl_is_supported=!1;r=null,a=null}},window.googleAuth2=null;var Mt=!1;function Dt(e){if("undefined"!=typeof Dropbox)return window.dropboxApiLoaded=!0,void(null!==e&&e());var t,n,o,i,a;0==dropboxApiRequested&&(window.dropboxApiRequested=!0,t=document,n="script",o="dropboxjs",i=void 0,a=t.getElementsByTagName(n)[0],t.getElementById(o)||((i=t.createElement(n)).id=o,i.setAttribute("data-app-key","xcse408r9ipxqtk"),i.src="https://www.dropbox.com/static/api/2/dropins.js",a.parentNode.insertBefore(i,a))),setTimeout(function(){Dt(e)},555)}BeFunky.loginWithGoogle=function(){"localhost"===window.location.hostname?document.domain="localhost":document.domain="befunky.com",BeFunky.showLoadScreen(),window.openCustomPopup(BeFunky.Params.siteUrl+"GoogleLogin.php?__optkn="+getCsToken(),BeFunky.attemptGoogleLogin)},BeFunky.attemptGoogleLogin=function(e){if(e&&"cancel"!==e){var t=e.id,n=e.name,o=e.email,i=e.profile_image;Mt=!0,BeFunky.handleSocialLogin("google",{id:t,name:n,email:o,profile_image:i}).catch(function(){}).then(function(){Mt=!1,BeFunky.hideLoadScreen()})}else Mt||BeFunky.hideLoadScreen()},window.DRV_CLIENT_ID="303057181160-pvs0ajfctrvv15i4rmirjsve2plp8m92.apps.googleusercontent.com",window.DRV_SCOPES="https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file",window.DRV_ACCESS=null,window.DRV_ACCESS_TIME=null,window.DRV_FLASH_CALLBACK=null,window.DRV_CLIENT_VERSION="v3",window.googleDrivePickerOpenerButton=document.createElement("button"),window.ready(function(){var e=document.querySelector(".googleDriveLoginBtn");if(e&&e.addEventListener("click",function(){driveInmediateDisplay()}),window.googleDrivePickerOpenerButton.id="___googleDrivePickerOpenerButton",window.googleDrivePickerOpenerButton.addEventListener("click",function(){if(null!==window.driveApiLoadedCallback){try{window.driveApiLoadedCallback()}catch(e){}window.driveApiLoadedCallback=null}}),"undefined"!=typeof $googleDriveState&&null!=$googleDriveState)try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}),window.onDrvApiLoad=function(){var e=function(){gapi.client.init({apiKey:"AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw"}).then(function(){dv_handleAuthResult()})};gapi.load("auth2",{callback:function(){gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!0},function(t){t&&!t.error&&(DRV_ACCESS=t.access_token,gapi.load("client",e))})}})},window.googleDriveCallbackCheck=function(){var e=!1;try{window.addEventListener("focus",function(t){e=!0},!1)}catch(e){}var t=setInterval(function(){null!==DRV_ACCESS?window.clearInterval(t):!1!==e&&(window.clearInterval(t),null===DRV_ACCESS&&(null!==DRV_FLASH_CALLBACK?dv_handleAuthResult(null):notApiLoadedGoToApp()))},1e3)},window.driveInmediateDisplay=function(e){if(0!=("undefined"!=typeof gapi&&void 0!==gapi.client&&void 0!==gapi.client.load)){if(DRV_FLASH_CALLBACK=null!==e?e:null,null!=$googleDriveState)try{document.getElementById("befunky-state").style.display="block",document.getElementById("dynamic-content-state").style.display="none"}catch(e){}if(null===DRV_ACCESS)gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},dv_handleAuthResult),null!==DRV_FLASH_CALLBACK&&googleDriveCallbackCheck();else if(null!=DRV_FLASH_CALLBACK&&null!==DRV_ACCESS)if("undefined"!=typeof gapi&&void 0!==gapi.client&&void 0!==gapi.client.load)gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}else{window.driveApiLoadedCallback=function(){window.driveInmediateDisplay(e)};try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}},window.dv_handleAuthResult=function(e){var t=null;if(e||null===DRV_ACCESS)try{t=e.access_token?e.access_token:null}catch(e){}else t=DRV_ACCESS;if(null!==t){if(DRV_ACCESS=t,null!=$googleDriveState)try{document.getElementById("befunky-state").style.display="block"}catch(e){}if("undefined"!=typeof gapi&&void 0!==gapi.client&&void 0!==gapi.client.load)gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}else{if(null!=$googleDriveState)try{document.getElementById("befunky-state").style.display="none",document.getElementById("dynamic-content-state").style.display="block",document.querySelector("#dynamic-content-state #loader").style.display="none",document.querySelector("#dynamic-content-state .message-box").style.display="block"}catch(e){}sendToFlashFromDrvParams()}null!==window.driveApiLoadedCallback&&window.googleDrivePickerOpenerButton.click()},window.driveClientLoaded=function(){DRV_FLASH_CALLBACK||null==$googleDriveState||(bf_eventTrack("EXTERNAL","GOOGLE_DRIVE","OPEN"),checkDriveFile($googleDriveState)),sendToFlashFromDrvParams()},window.sendToFlashFromDrvParams=function(){if(null!==DRV_FLASH_CALLBACK){var e="https://www.googleapis.com/upload/drive/v3/files";if(null!=DRV_ACCESS)if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).callbackFromJs(e,DRV_ACCESS)}catch(e){}else try{BFN.BfnService.callbackFromJs(e,DRV_ACCESS)}catch(e){}else if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).callbackFromJs()}catch(e){}else try{BFN.BfnService.callbackFromJs()}catch(e){}DRV_FLASH_CALLBACK=null}},window.checkDriveFile=function(e){try{BeFunky.showLoadScreen();var t="v3"===window.DRV_CLIENT_VERSION?"id,webContentLink,mimeType":"id,downloadUrl,mimeType";gapi.client.drive.files.get({fileId:e,fields:t}).execute(function(e){downloadDriveFile(e)})}catch(e){BeFunky.hideLoadScreen()}},window.downloadDriveFile=function(e){try{if(null===e)return void BeFunky.hideLoadScreen();var t=void 0!==e.downloadUrl?e.downloadUrl:void 0!==e.webContentLink&&e.webContentLink;if(t){"v3"===window.DRV_CLIENT_VERSION&&(t="https://www.googleapis.com/drive/v3/files/"+e.id+"?alt=media");var n=gapi.auth.getToken().access_token,o=e.mimeType;if(null!=n){var i=function(){try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}try{setApplicationMode("photoeditor")}catch(e){}openFlash();try{document.getElementById("dynamic-content-state").style.display="none"}catch(e){}},a=null;if("undefined"!=typeof XMLHttpRequest)"withCredentials"in(a=new XMLHttpRequest)?a.open("GET",t,!0):"undefined"!=typeof XDomainRequest&&(a=new XDomainRequest).open("GET",t);else{try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(null==a)try{a=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}if(null==a)try{a=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}if(null==a)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}a.open("GET",t)}try{a.responseType="arraybuffer"}catch(e){}a.setRequestHeader("Authorization","Bearer "+n),a.onload=function(){var e=new FileReader;e.onload=function(t){i();try{var n=t.target.result;if(n=(n=(n=n.replace("image/jpeg;","")).replace("image/png;","")).replace("data:base64,",""),0==BeFunky.isUseHTML5){try{document.getElementById(BeFunky.Params.swfId).ToJsBase64Uploader(n)}catch(e){}n=null,BeFunky.hideLoadScreen()}else setTimeout(function(){try{BFN.BfnService.ToJsBase64Uploader(n,void 0,"drive"),n=null}catch(e){}BeFunky.hideLoadScreen()},2e3)}catch(e){BeFunky.hideLoadScreen()}e=null};try{e.readAsDataURL(new Blob([a.response],{type:o}))}catch(e){try{var r="https://upload.befunky.com/restupload/driveImageRequest.bfn?dwnurl="+encodeURIComponent(t)+"&actoken="+n+"&mtype="+o+"&CSRFtoken="+getCsToken();if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).ToJsUrlUploader(r,null,!1)}catch(e){}else setTimeout(function(){try{BFN.BfnService.ToJsUrlUploader(r,null,!0,"drive")}catch(e){}},2e3)}catch(e){}}},a.onerror=function(){BeFunky.hideLoadScreen(),i();var e="https://upload.befunky.com/restupload/driveImageRequest.bfn?dwnurl="+encodeURIComponent(t)+"&actoken="+n+"&mtype="+o+"&CSRFtoken="+getCsToken();if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).ToJsUrlUploader(e,null,!1)}catch(e){}else try{BFN.BfnService.ToJsUrlUploader(e,null,!0,"drive")}catch(e){}},a.send()}}}catch(e){BeFunky.hideLoadScreen()}},window.insertDriveFile=function(e,t){var n=function(n){if(n[google.picker.Response.ACTION]==google.picker.Action.PICKED){try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}openFlash();var o=n[google.picker.Response.DOCUMENTS][0].id;if(null!=o){var i="-------314159265358979323846",a="\r\n--"+i+"\r\n",r={title:t,name:t,mimeType:"image/jpeg",parents:[{id:o}]},s=a+"Content-Type: application/json\r\n\r\n"+JSON.stringify(r)+a+"Content-Type: image/jpeg\r\nContent-Transfer-Encoding: base64\r\n\r\n"+e+"\r\n---------314159265358979323846--";gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+i+'"'},body:s}).execute(function(e){if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).callbackDriveInsertFile()}catch(e){}else try{BFN.BfnService.callbackDriveInsertFile()}catch(e){}})}}else if(n[google.picker.Response.ACTION]==google.picker.Action.CANCEL)if(notApiLoadedGoToApp(),0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).callbackDriveInsertFile("error")}catch(e){}else try{BFN.BfnService.callbackDriveInsertFile("cancel")}catch(e){}},o=function(){if(!1!==drv_pickerApiLoaded&&null!==DRV_ACCESS){var e=(new google.picker.DocsView).setIncludeFolders(!0).setMimeTypes("application/vnd.google-apps.folder").setSelectFolderEnabled(!0);(new google.picker.PickerBuilder).setAppId("303057181160").setOAuthToken(DRV_ACCESS).setTitle("Select a Folder").addView(e).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(window.location.protocol+"//"+window.location.host).setCallback(n).build().setVisible(!0)}else notApiLoadedGoToApp()};if(!1!==drv_pickerApiLoaded&&null!==DRV_ACCESS){var i=null;try{i=(new Date).getTime()}catch(e){}(null!=i&&null!=DRV_ACCESS_TIME&&i-DRV_ACCESS_TIME>=9e4||null==DRV_ACCESS_TIME||null==i)&&(DRV_ACCESS=null,drvImmediatTryed=!1)}!1!==drv_pickerApiLoaded&&null!==DRV_ACCESS?o():!1===drv_pickerApiLoaded&&null!==DRV_ACCESS?gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}}):0==drvImmediatTryed&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},function(e){if(e&&!e.error){DRV_ACCESS=e.access_token;try{DRV_ACCESS_TIME=(new Date).getTime()}catch(e){}gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}})}}),googleDriveCallbackCheck())},window.drv_pickerApiLoaded=!1,window.drvImmediatTryed=!1,window.driveApiLoadedCallback=null,window.drv_OpenPicker=function(){if("undefined"!=typeof gapi&&void 0!==gapi.client&&void 0!==gapi.client.load)!1!==drv_pickerApiLoaded&&null!==DRV_ACCESS?drv_createPicker():!1===drv_pickerApiLoaded&&null!==DRV_ACCESS?gapi.load("picker",{callback:onDrvPickerApiLoad}):0==drvImmediatTryed&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},handleDrvApiAuthResultImmediate),googleDriveCallbackCheck());else{window.driveApiLoadedCallback=window.drv_OpenPicker;try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}},window.handleDrvApiAuthResultImmediate=function(e){e&&!e.error&&(DRV_ACCESS=e.access_token,gapi.load("picker",{callback:onDrvPickerApiLoad}))},window.onDrvPickerApiLoad=function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=drv_createPicker,window.googleDrivePickerOpenerButton.click()},window.drv_createPicker=function(){if(drv_pickerApiLoaded&&DRV_ACCESS){var e=new google.picker.View(google.picker.ViewId.DOCS);e.setMimeTypes("image/png,image/jpeg,image/jpg"),(new google.picker.PickerBuilder).setAppId("303057181160").setOAuthToken(DRV_ACCESS).addView(e).addView(new google.picker.DocsUploadView).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(window.location.protocol+"//"+window.location.host).setCallback(drv_pickerCallback).build().setVisible(!0)}else notApiLoadedGoToApp()},window.notApiLoadedGoToApp=function(){drvImmediatTryed=!1;try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}openFlash()},window.gaDriveScrollHandler=function(e){window.scrollTo(0,0)},window.drv_pickerCallback=function(e){if(e.action==google.picker.Action.PICKED){var t=e.docs[0].id;if(window.removeEventListener("scroll",window.gaDriveScrollHandler),null!==t){if(openFlash(),"undefined"!=typeof gapi&&void 0!==gapi.client&&void 0!==gapi.client.load)gapi.client.load("drive",window.DRV_CLIENT_VERSION,function(){checkDriveFile(t)});else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}return}}else if(e.action.toLowerCase()!==google.picker.Action.LOADED){window.removeEventListener("scroll",window.gaDriveScrollHandler);try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}openFlash()}else window.addEventListener("scroll",window.gaDriveScrollHandler)},window.loadExternalImage=function(e,t){var n=new Image;n.setAttribute("crossOrigin","Anonymous"),n.onload=function(){var e=document.createElement("CANVAS"),o=e.getContext("2d");e.height=this.height,e.width=this.width,o.drawImage(this,0,0);var i=e.toDataURL("image/png");if(i=(i=(i=i.replace("image/jpeg;","")).replace("image/png;","")).replace("data:base64,",""),e=null,o=null,n=null,0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).ToJsBase64Uploader(i)}catch(e){}else try{BFN.BfnService.ToJsBase64Uploader(i,t,"dropbox")}catch(e){}},n.src=e},window.dropboxApiLoaded=!1,window.dropboxApiRequested=!1,window.dBoxOpenPicker=function(){var e=document.getElementById("dropbox-btn");if(null!=e&&(e.removeEventListener("click",window.dBoxOpenPicker),e.removeEventListener("click",window.dBoxSaveFileHandler)),0==window.dropboxApiLoaded){var t=document.getElementById("dropbox-btn");return null==t&&((t=document.createElement("button")).setAttribute("style","display:none"),t.id="dropbox-btn",document.body.appendChild(t)),t.addEventListener("click",window.dBoxOpenPicker),void Dt(function(){t.click()})}document.body.addClass("prevent-body-scroll");var n={success:function(e){try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}try{setApplicationMode("photoeditor")}catch(e){}openFlash();try{loadExternalImage(e[0].link,e[0].name)}catch(e){}},cancel:function(){try{"none"!=document.getElementById("modalBackgroundImg").style.display&&hideModalBackgroundImage()}catch(e){}openFlash()},linkType:"direct",multiselect:!1,extensions:[".jpg",".jpeg",".png",".bmp",".gif"]};Dropbox.choose(n)},window.dBoxSaveFileHandler=function(){var e=document.getElementById("dropbox-btn");null!=e&&(e.removeEventListener("click",window.dBoxOpenPicker),e.removeEventListener("click",window.dBoxSaveFileHandler)),window.dBoxSaveFile(window.dBoxSaveFileObj.url,window.dBoxSaveFileObj.filename)},window.dBoxSaveFileObj={url:"",filename:""},window.dBoxSaveFile=function(e,t){window.dBoxSaveFileObj={url:e,filename:t};var n=document.getElementById("dropbox-btn");if(null!=n&&(n.removeEventListener("click",window.dBoxOpenPicker),n.removeEventListener("click",window.dBoxSaveFileHandler)),0==window.dropboxApiLoaded)return null==n&&((n=document.createElement("button")).setAttribute("style","display:none"),n.id="dropbox-btn",document.body.appendChild(n)),n.addEventListener("click",window.dBoxSaveFileHandler),void Dt(function(){n.click()});document.body.addClass("prevent-body-scroll");var o=!1,i=!1,a=null;if(Dropbox.isBrowserSupported()){var r={success:function(){if(o=!0,0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).handlerDrobboxInsert("success")}catch(e){}else try{BFN.BfnService.handlerDropBoxInsert("success")}catch(e){}},progress:function(e){0==i&&(i=!0,a=setTimeout(function(){if(null!=a&&(clearTimeout(a),a=null),0==o)if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).handlerDrobboxInsert("cancel")}catch(e){}else try{BFN.BfnService.handlerDropBoxInsert("cancel")}catch(e){}},2e4))},cancel:function(){if(o=!0,null!=a&&(clearTimeout(a),a=null),0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).handlerDrobboxInsert("cancel")}catch(e){}else try{BFN.BfnService.handlerDropBoxInsert("cancel")}catch(e){}},error:function(e){if(o=!0,null!=a&&(clearTimeout(a),a=null),0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).handlerDrobboxInsert("error")}catch(e){}else try{BFN.BfnService.handlerDropBoxInsert("error")}catch(e){}}};Dropbox.save(e,t,r)}else if(0==BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).handlerDrobboxInsert("error")}catch(e){}else try{BFN.BfnService.handlerDropBoxInsert("error")}catch(e){}},BeFunky.handleSocialLogin=function(e,t){return new Promise(function(n,o){if(!["google","facebook"].includes(e))return o("Invalid social provider: "+e);var i=t.id,a=t.email,r=t.name,s=t.gender,l=t.user_birthday,u={user_id:i,sntype:"google"===e?"GOOGLE":"FACEBOOK",email:a,CSRFtoken:getCsToken(),screenname:r,gender:s||"",user_birthday:l||""};BeFunky.requestAPI("auth/sn-login",u).then(function(t){var o=["true",!0].includes(t.data.newUser)?"_NEW":"";return window.bf_eventTrack("EXTERNAL","SIGNIN_SOCIAL",e.toUpperCase()+o),BeFunky.onLoginSuccess(t.data),n(t.data)}).catch(function(i){if("already_logged_in"===i)return BeFunky.handleAlreadyLoggedInError(a).then(function(e){BeFunky.onLoginSuccess(e),n(e)}).catch(function(a){if("different_user_logged_out"!==a)throw i;BeFunky.logError("Attempting sign in again now that existing user has been signed out"),BeFunky.handleSocialLogin(e,t).then(n,o)});throw i}).catch(function(e){return BeFunky.logError("Social login failed:",e),o(e)})})},window.openCustomPopupInstance=null,window.openCustomPopup=function(e,t){var n=600;e.includes("weheartit.com")&&(n=800);var o=screen.width/2-375,i=screen.height/2-n/2;try{openCustomPopupInstance=window.open(e,"APP","top="+i+",left="+o+",width=750,height="+n+",resizable=1",!0);try{openCustomPopupInstance.focus()}catch(e){}}catch(e){t?t("cancel"):toFlex({cancel:1})}windowOpenerInterval=setInterval(function(){if(null==openCustomPopupInstance||openCustomPopupInstance.closed){try{clearInterval(windowOpenerInterval)}catch(e){}windowOpenerInterval=null,setTimeout(function(){t?t("cancel"):toFlex({cancel:1})},555)}},500)},window.snLoggedinType="",window.snWinType="",window.snType="FACEBOOK";var Ut=BeFunky.once(function(){var e=document.createElement("div");e.id="flash_image_library",BeFunky.imageLibraryModal(e,{imageSelectionHandler:function(t){return urlUpload(t.imageURL),BeFunky.closeModal(e.id),!1},isSelected:function(){return!1},initialMode:"UPLOAD_MENU",onClose:openFlash}),e.addClass("bfn"),document.body.appendChild(e),BeFunky.flashImageLibrary=e});BeFunky.openPreviousUploadsPanel=function(){Ut(),BeFunky.flashImageLibrary.open("BeFunky")},BeFunky.openFacebookPanel=function(){Ut(),BeFunky.flashImageLibrary.open("Facebook")},BeFunky.Flash={},BeFunky.Flash.getPreviousUploads=function(e,t){function n(e){try{document.getElementById(BeFunky.Params.swfId).flash_getPreviousUploadsHandler(e)}catch(e){console.log("Flash calling error getPreviousUploads: ",e)}}BeFunky.requestAPI("photo/previous-uploads",{start:e,end:t}).then(function(e){if(void 0===e.data||null==e.data)throw"invalid_response";n(JSON.stringify(e))}).catch(function(e){n("error")})},BeFunky.Flash.getLayersImages=function(e,t){function n(e){try{document.getElementById(BeFunky.Params.swfId).flash_getLayersHandler(e)}catch(e){console.log("Flash calling error: ",e)}}BeFunky.requestAPI("photo/layers/get",{start:e,end:t}).then(function(e){if(void 0===e.data||null==e.data)throw"invalid_response";n(JSON.stringify(e))}).catch(function(e){n("error")})},BeFunky.Flash.deleteLayerImage=function(e){function t(e){try{document.getElementById(BeFunky.Params.swfId).flash_deleteLayersHandler(e)}catch(e){console.log("Flash calling error: ",e)}}BeFunky.requestAPI("photo/layers/delete",{layer:e}).then(function(e){if("success"!==e.data)throw"invalid_response";t("success")}).catch(function(e){t("error")})},BeFunky.Flash.getProjects=function(e,t){function n(e){try{document.getElementById(BeFunky.Params.swfId).flash_getProjectsHandler(e)}catch(e){console.log("Flash calling error: ",e)}}BeFunky.requestAPI("photo/projects/get",{start:e,end:t}).then(function(e){if(void 0===e.data||null==e.data)throw"invalid_response";n(JSON.stringify(e))}).catch(function(e){n("error")})},BeFunky.Flash.deleteProject=function(e){function t(e){try{document.getElementById(BeFunky.Params.swfId).flash_deleteProjectHandler(e)}catch(e){console.log("Flash calling error: ",e)}}BeFunky.requestAPI("photo/projects/delete",{template:e}).then(function(e){if("success"!==e.data)throw"invalid_response";t("success")}).catch(function(e){t("error")})},BeFunky.openEtsyPanel=function(){},window.openerDivAc=function(e){return hideEditor(e)},BeFunky.contestDismissed=function(){return"1"},window.bfnJUploadFromComputer=function(e){var t=document.createElement("input");t.type="file",t.id="bfn_fk_image_computer_input",t.setStyles({display:"none"}),t.setAttribute("accept","bfd"==e?".bfd":"image/*"),document.body.appendChild(t);var n=document.createElement("button");n.id="bfn_fk_image_computer_input_btn",n.setStyles({display:"none"}),document.body.appendChild(n);var o=function(e){t.click()};t.addEventListener("click",function t(n){var i=function(){var n=null;try{n=document.getElementById("bfn_fk_image_computer_input").files[0]}catch(e){}if(null!=n){var i=new FileReader;i.onload=function(t){var o=null;try{if(o=t.target.result,"bfd"==e){o=o.replace("data:;base64,","");try{o=decodeURIComponent(escape(window.atob(o)))}catch(e){}}else o=(o=(o=(o=o.replace("image/jpeg;","")).replace("image/png;","")).replace("data:base64,","")).replace("data:;base64,","");var a=null;try{a=(a=n.name).substring(0,a.lastIndexOf("."))}catch(e){}try{null!=a?document.getElementById(BeFunky.Params.swfId).bfnJUploadFromComputerCallback(o,e,a):document.getElementById(BeFunky.Params.swfId).bfnJUploadFromComputerCallback(o,e)}catch(e){}}catch(e){try{document.getElementById(BeFunky.Params.swfId).bfnJUploadFromComputerCallback(null,"cancel")}catch(e){}}o=null,i=null},i.readAsDataURL(n)}else try{document.getElementById(BeFunky.Params.swfId).bfnJUploadFromComputerCallback(null,"cancel")}catch(e){}document.body.onfocus=null,document.getElementById("bfn_fk_image_computer_input").value="",document.getElementById("bfn_fk_image_computer_input").removeEventListener("click",t),document.getElementById("bfn_fk_image_computer_input_btn").removeEventListener("click",o),document.getElementById("bfn_fk_image_computer_input").parentNode.removeChild(document.getElementById("bfn_fk_image_computer_input")),document.getElementById("bfn_fk_image_computer_input_btn").parentNode.removeChild(document.getElementById("bfn_fk_image_computer_input_btn"))};document.body.onfocus=function(){setTimeout(i,100)}},!1),n.addEventListener("click",o,!1),n.click()};var Ot=void 0;window.getModalBackgroundImage=function(){return Ot||(Ot=document.getElementById("modalBackgroundImg")),Ot},window.showBase64Image=function(e){var t=getModalBackgroundImage();t.setStyles({marginTop:0,width:"100%",height:"100%",display:"block"}),t.src="data:image/jpeg;base64,"+e};var Nt=void 0;window.hideModalBackgroundImage=function(){var e=getModalBackgroundImage();if(e&&"block"===e.style.display){if(e.setStyles({display:"none"}).src="",!Nt)try{Nt=document.getElementById(BeFunky.Params.swfId)}catch(e){}Nt&&(Nt.width=setInitFlashWidth(),Nt.height=setInitFlashHeight())}},window.flFunctionCall=function(e){switch(BeFunky.LoginPanelObj.closeNextFunction=openFlash,e){case"SIGN_IN":BeFunky.openLoginPanel("SIGNIN",openFlash);break;case"REGISTER":BeFunky.openLoginPanel("REGISTER",openFlash)}};var Ht={37:"left",39:"right",38:"up",40:"down"},jt=[];function qt(e){if(!BeFunky.isLoadScreenActive()){var t=Ht[e.keyCode];if(t){var n=document.activeElement;if(n){var o=jt.find(function(e){return(0,e.condition)(n)});o&&(o.callback(n,t,e)||(e.stopImmediatePropagation(),e.preventDefault()))}}}}BeFunky.addArrowKeyHandler=function(e){"function"==typeof e.callback&&"function"==typeof e.condition?jt.includes(e)||jt.push(e):BeFunky.throwError("invalid arrow key handler",e)},document.addEventListener("keydown",qt),document.addEventListener("keyup",qt);var Vt=function(){function e(){a(this,e),this.imagesPerPage=50,this.resetImageData()}return r(e,[{key:"resetImageData",value:function(){this.imageData={totalImages:null,fetchedImages:[],startPhotos:0,startLayers:0}}},{key:"getPhotosAndLayers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments[1];if(!BeFunky.isLoggedIn())return n({error:"not_logged_in"});var o=this.imageData.totalImages,i=this.imageData.fetchedImages,a=t*this.imagesPerPage>i.length&&o>i.length;if(null==o||a)return this.getImagesFromAPI({startPhotos:this.imageData.startPhotos,startLayers:this.imageData.startLayers},function(o){var a=o.error,r=o.data,s=o.totalImages,l=o.startPhotos,u=o.startLayers;if(a)return n({error:a});e.imageData={totalImages:s,fetchedImages:i.concat(r),startPhotos:l,startLayers:u},e.getPhotosAndLayers(t,n)});var r=(t-1)*this.imagesPerPage,s=r+this.imagesPerPage;return n({data:i.slice(r,s),totalPages:Math.ceil(o/this.imagesPerPage)})}},{key:"getImagesFromAPI",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.startPhotos,n=void 0===t?0:t,o=e.startLayers,i=void 0===o?0:o,a=arguments[1],r={start_images:n,start_layers:i,end:100};BeFunky.requestAPI("photo/library-images",r).then(function(e){var t=e.data,n=e.total,o=e.start_images,i=e.start_layers;if(!Array.isArray(t)||"number"!=typeof n||"number"!=typeof o||"number"!=typeof i)throw"invalid_response";if(0===t.length)throw"no_results";var r=t.map(function(e){var t="befunky_layers"===e.type,n=t?"befunky_layer":"befunky_photo",o=t&&e.url.endsWith(".png");return{id:n+"_"+e.id,date:e.dateCreated,imageURL:e.url,isTransparent:o,thumbURL:e.thumb_url,thumbWidth:200,thumbHeight:200}});return a({data:r,totalImages:n,startPhotos:o,startLayers:i})}).catch(function(e){return a({error:e})})}}]),e}();BeFunky.ImagesService=new Vt;var Gt=function(){function e(){a(this,e),this.facebookAppID="120991377944644",this.scopes="email,public_profile,user_photos",this.fields="id,name,email,gender,birthday",this.hasInitialized=!1,this.onInitCallbacks=[],this.hasBeenAuthorized=!1}return r(e,[{key:"loadSDK",value:function(){var e=this;if(this.hasInitialized)return Promise.resolve();var t=new Promise(function(t){e.onInitCallbacks.push(t)});return document.getElementById("facebook-jssdk")||BeFunky.onDocumentReady(function(){var t,n,o,i,a,r=document.createElement("div");r.id="fb-root",document.body.appendChild(r),window.fbAsyncInit=function(){FB.init({appId:e.facebookAppID,cookie:!0,version:"v3.2"}),e.hasInitialized=!0,e.onInitCallbacks.forEach(function(e){return e()})},t=document,n="script",o="facebook-jssdk",i=void 0,a=t.getElementsByTagName(n)[0],t.getElementById(o)||((i=t.createElement(n)).id=o,i.src="https://connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(i,a))}),t}},{key:"getAccessToken",value:function(e){var t=this,n=this.scopes;if(e&&!n.split(",").includes(e))throw new Error("Unsupported scope: "+e);return this.loadSDK().then(function(){return new Promise(function(e,t){if("https:"!==location.protocol)return BeFunky.logError("FB.getLoginStatus not called b/c this is a non-SSL page"),t("unknown");FB.getLoginStatus(function(t){var n=t.status,i=t.authResponse;if("connected"===n)return e({accessToken:i.accessToken});e(o())},!0)})}).then(function(n){return t.hasBeenAuthorized=!0,e&&!Array.isArray(n.grantedScopes)?new Promise(function(e,t){FB.api("/me/permissions",function(n){if(Array.isArray(n.data)){var o=n.data.filter(function(e){var t=e.status;return"granted"===t}).map(function(e){var t=e.permission;return t}).join(",");return console.log("Granted scopes:",o),e(o)}BeFunky.throwError("Unable to get granted scopes from FB API",n),t("invalid_response")})}).then(function(e){return{accessToken:n.accessToken,grantedScopes:e}}):n}).then(function(t){return e&&!i(t.grantedScopes)?new Promise(function(t,n){var a="facebook_access_"+e;BeFunky.LanguageManager.isTranslated(a)||(a="Please allow BeFunky to access your Facebook "+e.replace(/_/g," ")+"."),BeFunky.confirm(a,{onConfirm:function(){o(!0).then(function(o){if(i(o.grantedScopes))return t(o);n(e+"_scope_declined")}).catch(n)},onCancel:function(){n(e+"_scope_declined")},confirmText:"continue"})}):t});function o(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={scope:n,return_scopes:!0};e&&(t.auth_type="rerequest");var o=!1,i=function(){o=!0};return new Promise(function(e,n){window.addEventListener("blur",i),r();var a=setTimeout(function(){o||BeFunky.acknowledge(["browser_block_social_login",{provider:"Facebook"}],{onAcknowledge:r,buttonText:"try_again"})},200);function r(){FB.login(function(t){var o=t.status,r=t.authResponse;if(window.removeEventListener("blur",i),clearTimeout(a),"connected"===o){var s=r.accessToken,l=r.grantedScopes;return e({accessToken:s,grantedScopes:l})}return n(o)},t)}})}function i(t){return t.split(",").includes(e)}}},{key:"getAccessTokenForFlash",value:function(e){this.getAccessToken(e).then(function(e){var t=e.accessToken;document.getElementById(BeFunky.Params.swfId).getAccessTokenForFlash(t)},function(e){BeFunky.logError("Unable to get Facebook access token for Flash",e),document.getElementById(BeFunky.Params.swfId).getAccessTokenForFlash(null)})}},{key:"getUserData",value:function(){var e=this;return this.getAccessToken("email").then(function(){return new Promise(function(t,n){FB.api("/me",{fields:e.fields},function(e){if(e.error)return n(e.error);t(e)})})})}},{key:"loginWithFacebook",value:function(){return this.getUserData().then(function(e){return e.email&&e.email.length?BeFunky.handleSocialLogin("facebook",e):(BeFunky.confirm("facebook_email_login_failed",{onConfirm:function(){BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.isLoggedInNextFunction)},onCancel:function(){window.open("https://www.facebook.com/","_blank")},confirmText:"register_with_email",cancelText:"go_to_facebook"}),Promise.reject("missing_email"))})}},{key:"getPhotoAlbums",value:function(){return this.getAccessToken("user_photos").then(function(e){var t=e.accessToken;return new Promise(function(e,n){var o="https://graph.facebook.com/v3.2/me?"+["fields=albums.fields(name,photos.fields(picture,images).limit(1000))","access_token="+t].join("&");BeFunky.request(o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}},function(t){var o=t.response,i=t.error;if(i)return n(i);if(!o||!o.albums||!Array.isArray(o.albums.data))return n("invalid_response");var a=o.albums.data.filter(function(e){var t=e.photos;return t&&t.data&&t.data.length});if(!a.length)return n("no_results");var r=a.map(function(e){var t=e.id,n=e.name,o=e.photos,i={id:t,name:n};return i.images=o.data.filter(function(e){return e&&e.images&&e.images.length>1}).map(function(e){var t=e.images.slice().sort(function(e,t){return e.width>t.width?1:-1}),n=t[t.length-1],o=t.find(function(e){return e.height>=200})||n;return{id:"facebook_"+e.id,imageURL:n.source,imageWidth:n.width,imageHeight:n.height,thumbURL:o.source,thumbWidth:o.width,thumbHeight:o.height}}),i});return e(r)})})},function(e){return BeFunky.logError("Unable to get Facebook access token:",e),Promise.reject("invalid_access_token")})}}]),e}();BeFunky.FacebookAuth=new Gt;var Wt=function(){function e(){a(this,e),this.init()}return r(e,[{key:"init",value:function(){this.initDefaultValues()}},{key:"initDefaultValues",value:function(){}},{key:"isValid",value:function(e,t){var n={autosave:function(e){return["yes","no","ask"].includes(e)},language:function(e){return BeFunky.LanguageManager.appLanguages.includes(e)},artsy_fav:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})},effects_fav:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})},texture_fav:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})},batch_processing_fav:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})},watermarks:function(e){return Array.isArray(e)&&e.every(function(e){return e&&"object"===(void 0===e?"undefined":i(e))})},use_case:function(e){return"string"==typeof e},snapping:function(e){return["yes","no"].includes(e)},display_distances:function(e){return["yes","no"].includes(e)}};return n[e]&&n[e](t)}},{key:"validateSettings",value:function(e,t){var n=this,o={};return e&&"object"===(void 0===e?"undefined":i(e))?(Object.entries(e).forEach(function(i){var a=c(i,2),r=a[0],s=a[1];n.isValid(r,s)?o[r]=e[r]:BeFunky.throwError(t+". id = "+r+", value = "+s+" ("+BeFunky.getType(s)+")")}),o):(BeFunky.throwError(t+". settings type = "+BeFunky.getType(e)),o)}},{key:"getUserSettings",value:function(e){var t=this;BeFunky.requestAPI("auth/get-user-options").then(function(n){var o=t.validateSettings(n.data,"Invalid settings fetched from API");if("flash"!==e)e({settings:o});else try{var i=JSON.stringify(n);document.getElementById(BeFunky.Params.swfId).flash_getUserSettingsHandler(i)}catch(e){console.log("Flash calling error get-user-options: ",e)}}).catch(function(t){if("flash"!==e)e({error:t});else try{document.getElementById(BeFunky.Params.swfId).flash_getUserSettingsHandler("error")}catch(e){console.log("Flash calling error get-user-options: ",e)}})}},{key:"updateUserSettings",value:function(e,t){var n=this.validateSettings(e,"Invalid settings specified");if(!Object.keys(n).length)return t({error:"No valid settings provided"});var o=JSON.stringify({data:n}),i=btoa(encodeURIComponent(o));BeFunky.requestAPI("auth/update-user-options",{data:i}).then(function(e){if("success"!==e.data)throw"invalid_response";if("flash"!==t){if(!BFN.BfnService.userLoggedIn)try{Object.keys(n).includes("use_case")&&void 0!==n.use_case&&n.use_case.length>0&&void 0!==window.bfn_mp&&0!==window.bfn_mp.identifier&&"undefined"!=typeof mixpanel&&mixpanel.people.set({"Use Case":n.use_case})}catch(e){}t({success:!0})}else try{document.getElementById(BeFunky.Params.swfId).flash_updateUserSettingsHandler("success")}catch(e){console.log("Flash calling error get-user-options: ",e)}}).catch(function(e){if("flash"!==t)t({error:e});else try{document.getElementById(BeFunky.Params.swfId).flash_updateUserSettingsHandler("error")}catch(e){console.log("Flash calling error get-user-options: ",e)}})}}]),e}();BeFunky.SettingsService=new Wt;var zt=d(["\n            <p>","</p>        \n        "],["\n            <p>","</p>        \n        "]),Xt=d(['<a href="https://blog.befunky.com/welcome-befunky-plus/" target="_blank" rel="noopener" class="button button--blue-gradient button--xx-large dialog__button">\n                ',"\n            </a>"],['<a href="https://blog.befunky.com/welcome-befunky-plus/" target="_blank" rel="noopener" class="button button--blue-gradient button--xx-large dialog__button">\n                ',"\n            </a>"]);BeFunky.openThankYouPanel=function(e){var t=BeFunky.lit,n=t.elem,o=t.lang,i=["thank_you_body",{collection_of_tutorials:function(){return'<a href="https://blog.befunky.com/tutorials/" target="_blank" rel="noopener">'+BeFunky.LanguageManager.getString("collection_of_tutorials","modal")+"</a>"}}];BeFunky.showDialog({heading:"thank_you_heading",body:n(zt,o(i,"modal")),buttons:[n(Xt,o("learn_more","modal"))],imageUrl:BeFunky.Params.globalImagesPath+"site/thank-you-modal-header.jpg",addCloseButton:!0,onClose:e})};var Jt=d(["\n        <div>\n            <p>","</p>\n            <ul>\n                ","\n            </ul>\n            <p>","</p>\n        </div>\n    "],["\n        <div>\n            <p>","</p>\n            <ul>\n                ","\n            </ul>\n            <p>","</p>\n        </div>\n    "]),Yt=d(["<li>","</li>"],["<li>","</li>"]);BeFunky.openWelcomePanel=function(){var e,t=BeFunky.lit,n=t.html,o=t.elem,i=t.string,a=(e={default:["pricing_modal_background_heading","pricing_modal_cutout_heading","pricing_modal_batch_heading","welcome_features_cartoons"],collage:["welcome_collage_1","welcome_collage_2","welcome_features_graphics"],designer:["welcome_designer_1","welcome_designer_2","welcome_features_graphics"]},window.BFN&&BFN.AppModel&&BFN.AppModel.viewingCollage?e.collage:window.BFN&&BFN.AppModel&&BFN.AppModel.viewingDesigner?e.designer:e.default),r=o(Jt,i("welcome_features","modal"),a.map(function(e){return n(Yt,i(e,"modal"))}),i("welcome_upgrade","modal"));BeFunky.showDialog({heading:"welcome_heading",body:r,buttons:[{text:"learn_more",type:["blue-gradient","xx-large"],onClick:function(){return BeFunky.openUpgradePanel(void 0,!0)}}],imageUrl:BeFunky.Params.globalImagesPath+"site/welcome-modal-header.jpg",addCloseButton:!0})},BeFunky.imageLibraryModal=function(e,t){var n=t.imageSelectionHandler,o=t.isSelected,i=t.transformImageObject,a=t.extendItem,r=t.onClose,s=t.initialMode;return function(){var e=this;this.init=function(){this.initDefaultValues(),this.initTabbedLayout(),this.initImageGalleries()},this.initDefaultValues=function(){this.sections=["BeFunky","Facebook"],this._activeSection="BeFunky",this.modalMaxWidth=1280,this.galleryMaxWidth=992,this.setClass("modal image-library image-library--mode-"+s.toLowerCase().replace(/_/g,"-")),this.innerHTML='\n            <div class="panel-header"></div>\n            <div class="modal__body image-library__body">\n                <div class="image-library__left-panel">\n                    <button class="button button--list button--large button--arrow image-library__tab image-library__tab--selected image-library__tab--befunky">\n                        <string>BeFunky</string>\n                        <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-down-icon"></use></svg>\n                    </button>\n                    <button class="button button--list button--large button--arrow image-library__tab image-library__tab--facebook">\n                        <string>Facebook</string>\n                        <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-arrow-down-icon"></use></svg>\n                    </button>\n                    <div class="image-library__facebook-albums"></div>\n                </div>\n                <div class="image-library__right-panel">\n                    <div class="image-gallery image-library__gallery image-library__gallery--befunky"></div>\n                    <div class="image-gallery image-library__gallery image-library__gallery--facebook" style="display: none"></div>\n                </div>\n            </div>\n        ';var e=this.querySelector(".panel-header");BeFunky.panelHeader(e,{name:"image_library",tag:"h2",modifier:"modal",closeEnabled:!0})},this.initTabbedLayout=function(){var e=this;this.befunkyTab=this.querySelector(".image-library__tab--befunky"),this.facebookTab=this.querySelector(".image-library__tab--facebook"),this.befunkyTab.addEventListener("click",function(){e.activeSection="BeFunky"}),this.facebookTab.addEventListener("click",function(){e.activeSection="Facebook"})},this.initImageGalleries=function(){this.befunkyGallery=this.querySelector(".image-library__gallery--befunky"),this.facebookGallery=this.querySelector(".image-library__gallery--facebook"),this.befunkyGallery.defaultImagesPerRow=5,this.facebookGallery.defaultImagesPerRow=5,BeFunky.imageGallery(this.befunkyGallery,{imagesPerRow:this.befunkyGallery.defaultImagesPerRow,imageSelectionHandler:n,isSelected:o,extendItem:a}),BeFunky.imageGallery(this.facebookGallery,{imagesPerRow:this.facebookGallery.defaultImagesPerRow,imageSelectionHandler:n,isSelected:o,extendItem:a}),this.befunkyGallery.emptyState={text:"login_load_images",icon:"images-icon",buttonText:"login",buttonAction:this.handleBeFunkyLoginClick},this.facebookGallery.emptyState={text:"connect_facebook_load_albums",icon:"images-icon",buttonText:"connect_facebook",buttonAction:this.handleFacebookAuthClick},this.befunkyGalleryDimensions=null,this.facebookGalleryDimensions=null,this.facebookAlbumList=this.querySelector(".image-library__facebook-albums"),this.facebookAlbum=null,this.facebookImagesPerPage=50},this.open=function(e){var t=this;BeFunky.openModal(this,{onOpen:function(){e&&e!==t.activeSection?t.activeSection=e:t.handleOpenOrTabChange()},onClose:function(){"function"==typeof r&&r()},onWindowResize:this.updateModalSize.bind(this),size:"extra-large"})},this.close=function(){BeFunky.closeModal(this)},this.selectGalleryItem=function(e){var t=document.getElementById("image_gallery_item--"+e);t&&(t.selected=!0)},this.deselectGalleryItem=function(e){var t=document.getElementById("image_gallery_item--"+e);t&&(t.selected=!1)},this.loadBefunkyImages=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.befunkyGallery.isLoading=!0,BeFunky.ImagesService.getPhotosAndLayers(t,function(n){var o=n.data,i=n.totalPages,a=n.error;if(e.befunkyGallery.isLoading=!1,a)1===t&&"no_results"===a?(e.befunkyGallery.message="",e.befunkyGallery.emptyState={text:"no_befunky_photos",icon:"images-icon"}):(BeFunky.logError("Unable to fetch BeFunky images",a),e.befunkyGallery.message={isError:!0,text:BeFunky.failureReason(a),buttonText:"try_again",buttonAction:function(){return e.loadBefunkyImages(t)}});else if(e.befunkyGallery.message="",e.befunkyGallery.images=1===t?[].concat(p(o)):[].concat(p(e.befunkyGallery.images),p(o)),!(t>=i)){var r=function(){return e.loadBefunkyImages(t+1)};if(e.befunkyGallery.images.length<100)return e.listenForBeFunkyScroll(r);e.befunkyGallery.message={buttonText:"load_more",buttonAction:r}}})},this.loadFacebookAlbums=function(){var e=this;this.facebookGallery.images=[],this.facebookGallery.isLoading=!0,BeFunky.FacebookAuth.getPhotoAlbums().then(function(t){e.facebookGallery.isLoading=!1,"function"==typeof i&&t.forEach(function(e){t.images=e.images.map(i)}),e.facebookAlbumList.innerHTML="";var n=document.createDocumentFragment();t.forEach(function(t){var o=document.createElement("button");o.className="button button--list button--ellipsis image-library__facebook-album",o.id="facebook_album_"+t.id,o.albumID=t.id,o.textContent=t.name,o.addEventListener("click",function(){e.facebookGallery.isLoading||e.facebookAlbum===t||(e.facebookAlbum.scrollTop=e.facebookGallery.scrollTop,e.facebookAlbum.alreadyLoaded=!0,e.facebookAlbum=t,e.displayFacebookAlbum())}),n.appendChild(o)}),e.facebookAlbumList.appendChild(n),e.facebookAlbum&&t.find(function(t){return t.id===e.facebookAlbum.id})||(e.facebookAlbum=t[0]),e.displayFacebookAlbum()},function(t){e.facebookGallery.isLoading=!1,BeFunky.logError("Unable to fetch Facebook albums",t),e.facebookGallery.message={isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:function(){return e.loadFacebookAlbums()}}})},this.displayFacebookAlbum=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=e.facebookAlbum;if(n){var o="image-library__facebook-album--selected";e.facebookAlbumList.querySelectorAll("."+o).removeClass(o);var i=document.getElementById("facebook_album_"+n.id);i&&i.addClass(o);var a=e.facebookImagesPerPage,r=Math.ceil(n.images.length/a);if(!(t<0||t>r)){var s=t*a;e.facebookGallery.message="",e.facebookGallery.staggerLoading=!n.alreadyLoaded,e.facebookGallery.images=n.images.slice(0,s),e.facebookGallery.scrollTop=n.scrollTop||0;var l=t+1;return l<=r?e.listenForFacebookScroll(function(){return n!==e.facebookAlbum},function(){e.displayFacebookAlbum(l)}):void 0}}},this.listenForBeFunkyScroll=function(t){var n=BeFunky.throttle(function(){e.befunkyGalleryDimensions||(e.befunkyGalleryDimensions={scrollHeight:e.befunkyGallery.scrollHeight,offsetHeight:e.befunkyGallery.offsetHeight});var o=e.befunkyGalleryDimensions;o.scrollHeight-o.offsetHeight-e.befunkyGallery.scrollTop<=600&&(e.befunkyGallery.removeEventListener("scroll",n),t())},50);e.befunkyGalleryDimensions=null,requestAnimationFrame(function(){n(),e.befunkyGallery.addEventListener("scroll",n)})},this.listenForFacebookScroll=function(t,n){var o=BeFunky.throttle(function(){if(t())e.facebookGallery.removeEventListener("scroll",o);else{e.facebookGalleryDimensions||(e.facebookGalleryDimensions={scrollHeight:e.facebookGallery.scrollHeight,offsetHeight:e.facebookGallery.offsetHeight});var i=e.facebookGalleryDimensions;i.scrollHeight-i.offsetHeight-e.facebookGallery.scrollTop<=600&&(e.facebookGallery.removeEventListener("scroll",o),n())}},50);e.facebookGalleryDimensions=null,requestAnimationFrame(function(){t()||(o(),e.facebookGallery.addEventListener("scroll",o))})},this.handleOpenOrTabChange=function(){({BeFunky:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){BeFunky.isLoggedIn()&&(e.befunkyGallery.images.length?null===BeFunky.ImagesService.imageData.totalImages&&e.loadBefunkyImages():e.befunkyGallery.isLoading||e.loadBefunkyImages())}),Facebook:function(){BeFunky.FacebookAuth.hasBeenAuthorized&&(e.facebookGallery.images.length||e.facebookGallery.isLoading||e.loadFacebookAlbums())}})[e.activeSection]()},this.handleBeFunkyLoginClick=function(){BeFunky.isLoggedIn()?e.loadBefunkyImages():BeFunky.openLoginPanel("SIGNIN",function(){return e.handleBeFunkyLoginClick()})},this.handleFacebookAuthClick=function(){e.loadFacebookAlbums()},this.updateModalSize=function(t){var n=t.availableWidth,o=e.galleryMaxWidth+(n-e.modalMaxWidth);[e.befunkyGallery,e.facebookGallery].forEach(function(t){o<e.galleryMaxWidth?t.imagesPerRow=Math.max(2,t.defaultImagesPerRow*o/e.galleryMaxWidth):t.imagesPerRow=t.defaultImagesPerRow}),e.befunkyGalleryDimensions=null,e.facebookGalleryDimensions=null},Object.defineProperty(this,"activeSection",{set:function(e){var t=this;if(e!==this._activeSections)if(this.sections.includes(e)){this._activeSection=e;var n={BeFunky:[this.befunkyTab,this.befunkyGallery],Facebook:[this.facebookTab,this.facebookGallery,this.facebookAlbumList]};Object.entries(n).forEach(function(e){var n=c(e,2),o=n[0],i=n[1],a=o===t._activeSection;i.forEach(function(e,t){if(0===t)return e.toggleClass("image-library__tab--selected",a);e.setStyles({display:a?"":"none"})})}),this.handleOpenOrTabChange()}else BeFunky.logError("Invalid Image Libraray section specified",e)},get:function(){return this._activeSection}}),this.init()}.bind(e)()};var $t={displayError:function(e,t){var n=Kt(e);if(!n.firstElementChild){var o=document.createElement("div").addClass("form-errors__container");n.appendChild(o);var i=document.createElement("button").setClass("button button--circle button--outline button--white button--icon button--tiny form-errors__close-button");i.innerHTML=BeFunky.getSvgHtml("global-cancel-icon",{classes:"icon icon-size-tiny"}),i.addEventListener("click",function(){n.innerHTML=""}),n.appendChild(i)}var a=document.createElement("div");Array.isArray(t)?a.setLang.apply(a,p(t)):a.setLang(t),n.firstElementChild.appendChild(a)},clearError:function(e){Kt(e).innerHTML=""}};function Kt(e){return e instanceof HTMLElement?e.querySelector(".form-errors"):document.querySelector(e+" .form-errors")}BeFunky.LoginPanelObj={panelType:"SIGNIN",isLoggedInNextFunction:!1,closeNextFunction:!1};var Qt=BeFunky.getLocal("skip_captcha_token"),Zt=!Qt;function en(){var e={"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":getCsToken()};return Qt&&(e["X-BeFunky-Skip-Captcha"]=Qt),e}Zt||console.log("Captcha disabled for testing"),BeFunky.registerComeFromUpgrade=!1,BeFunky.openLoginPanel=function(e,t,n){switch(BeFunky.LoginPanelObj.panelType=e,BeFunky.LoginPanelObj.isLoggedInNextFunction=t,e){case"SIGNIN":BeFunky.befunkyPopupContainerOpen("#sign_in_modal",{addCaptcha:Zt}),BeFunky.FacebookAuth.loadSDK();break;case"REGISTER":BeFunky.befunkyPopupContainerOpen("#register_modal",{addCaptcha:Zt}),BeFunky.FacebookAuth.loadSDK();break;case"FORGETPASS":BeFunky.befunkyPopupContainerOpen("#reset_password_modal",{addCaptcha:Zt})}},BeFunky.signinSubmit=function(){var e=document.querySelector("#sign_in_form"),t=function(t){return e.querySelector('[name="'+t+'"]')},n=!1;$t.clearError("#sign_in_form"),e.querySelectorAll(".material-field__input").removeClass("material-field__input--invalid");var o=t(BeFunky.Params.frmNames.e),i=o.value.trim(),a=t(BeFunky.Params.frmNames.p);!1===window.isEmailAddress(i)&&(o.addClass("material-field__input--invalid"),n=!0),a.value.length<=2&&(a.addClass("material-field__input--invalid"),n=!0);var r="";if(Zt&&""===(r=BeFunky.getCaptchaResponse())&&(BeFunky.executeCaptcha(BeFunky.signinSubmit),n=!0),!n){var s={userEmail:i,userPass:window.MD5(a.value),captcha_response:r};BeFunky.requestAPI("auth/login",s,{showLoadScreen:!0,headers:en()}).then(function(e){BeFunky.onLoginSuccess(e.data)}).catch(function(e){if("already_logged_in"===e)return BeFunky.handleAlreadyLoggedInError(i).then(BeFunky.onLoginSuccess);throw e}).catch(function(t){if("different_user_logged_out"===t)return BeFunky.logError("Attempting sign in again now that existing user has been signed out"),BeFunky.signinSubmit();BeFunky.logError("Unable to sign in user:",t),Zt&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));var n={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",different_user_logged_in:["error_please_refresh",{contact_support:'<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}],invalid_email:"error_email_password"};$t.displayError(e,n[t]||"error_invalid_response")})}},BeFunky.registerSubmit=function(){var e=document.querySelector("#register_form"),t=function(t){return e.querySelector('[name="'+t+'"]')},n=!1;$t.clearError("#register_form"),e.querySelectorAll(".material-field__input").removeClass("material-field__input--invalid");var o=t(BeFunky.Params.frmNames.e),i=t(BeFunky.Params.frmNames.eag),a=t(BeFunky.Params.frmNames.p);!1===window.isEmailAddress(o.value)&&(o.addClass("material-field__input--invalid"),n=!0),i.value!==o.value&&(i.addClass("material-field__input--invalid"),n=!0),a.value.length<6&&(a.addClass("material-field__input--invalid"),n=!0);var r="";if(Zt&&""===(r=BeFunky.getCaptchaResponse())&&(BeFunky.executeCaptcha(BeFunky.registerSubmit),n=!0),!n){var s={_email_:o.value,_email_again:i.value,_pass_:a.value,captcha_response:r,em_effects:0,em_articles:1};BeFunky.requestAPI("auth/register",s,{showLoadScreen:!0,headers:en()}).then(function(e){BeFunky.onLoginSuccess(e.data)}).catch(function(t){BeFunky.logError("Unable to register user:",t),"already_logged_in"===t&&BeFunky.throwError(t,"Unable to register user"),Zt&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));var n={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:'<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}],invalid_email:"error_email_already_in_use"};$t.displayError(e,n[t]||"error_invalid_response")})}},BeFunky.forgetPassSubmit=function(){var e=document.querySelector("#reset_password_form"),t=!1;$t.clearError("#reset_password_modal"),e.querySelectorAll(".material-field__input").removeClass("material-field__input--invalid");var n,o=(n=BeFunky.Params.frmNames.fpe,e.querySelector('[name="'+n+'"]')),i=o.value.trim();!1===window.isEmailAddress(i)&&(o.addClass("material-field__input--invalid"),t=!0);var a="";if(Zt&&""===(a=BeFunky.getCaptchaResponse())&&(BeFunky.executeCaptcha(BeFunky.forgetPassSubmit),t=!0),!t){var r={_email_:i,captcha_response:a};BeFunky.requestAPI("auth/forget-pass",r,{showLoadScreen:!0,headers:en()}).then(function(e){if("success"!==e.data)throw"invalid_response";BeFunky.befunkyPopupContainerClose(),BeFunky.acknowledge(["reset_password_email_sent",{email:i}])}).catch(function(t){BeFunky.logError("Unable to reset password:",t),"already_logged_in"==t&&BeFunky.throwError(t,"Unable to reset password"),Zt&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));var n={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:'<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}],operation_failed:"error_email_not_registered"};$t.displayError(e,n[t]||"error_invalid_response")})}},BeFunky.ISNOT_FLASH_LOGGEDIN=!1,window.onUserStatusChange(function(e){if(e.btknid){var t=e.user_name,n=e.email,o=e.pl,i=e.btknid,a=e.language,r=e.register_date,s=e.register_from,l=e.login_date,u=e.login_count,c=e.newUser,d=e.isMailVerified,p=e.plan_type,g=e.subscr_date,h=e.subscr_count,m=e.subscr_amount,f=e.subscr_first_date,y=e.subscr_ltv,v=e.subscr_usr,_=e.subscr_tusr,k=e.can_change_user_name,b=e.is_subscribe_newsletter;BeFunky.Params.btknid=i,BeFunky.User.email=n,BeFunky.User.username=t,BeFunky.User.language=a,BeFunky.User.register_date=r,BeFunky.User.register_from=s,BeFunky.User.login_date=l,BeFunky.User.login_count=parseInt(u),BeFunky.User.isNewUser=BeFunky.ConvertToBool(c),BeFunky.User.can_change_user_name=BeFunky.ConvertToBool(k),BeFunky.User.is_subscribe_newsletter=BeFunky.ConvertToBool(b),BeFunky.User.isMailVerified="1"===d,BeFunky.Params.isMailVerified="1"===d,BeFunky.User.FlashVarsObject.user_name=t,BeFunky.User.FlashVarsObject.email=n,BeFunky.User.FlashVarsObject.pl=o,BeFunky.User.FlashVarsObject.plan_type=p,BeFunky.User.FlashVarsObject.subscr_date=g,BeFunky.User.FlashVarsObject.subscr_count=h,BeFunky.User.FlashVarsObject.subscr_amount=m,BeFunky.User.FlashVarsObject.subscr_first_date=f,BeFunky.User.FlashVarsObject.subscr_ltv=y,BeFunky.User.FlashVarsObject.subscr_usr=v,BeFunky.User.FlashVarsObject.subscr_tusr=_,BeFunky.Params.swfFlashVars.user_name=t,BeFunky.Params.swfFlashVars.email=n,BeFunky.Params.swfFlashVars.pl=o,BeFunky.Params.swfFlashVars.ppicsrc=BeFunky.Params.globalImagesPath+"app/default-avatar.jpg",BeFunky.User.FlashVarsObject.ppicsrc=BeFunky.Params.globalImagesPath+"app/default-avatar.jpg"}}),BeFunky.onLoginSuccess=function(e){if(window.updateUserStatus(e),!1===BeFunky.isUseHTML5)try{document.getElementById(BeFunky.Params.swfId).userValueObj(BeFunky.User.FlashVarsObject)}catch(e){BeFunky.ISNOT_FLASH_LOGGEDIN=!0}else try{BFN.BfnService.getUserData()}catch(e){}if(BeFunky.isPlus()){void 0!==BeFunky.Params.pymntscspg&&null!=BeFunky.Params.pymntscspg&&(BeFunky.Params.pymntscspg=BeFunky.Params.pymntscspg.replace("?openThanks=1",""),window.location.href=BeFunky.Params.pymntscspg);try{window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1,window.reResizeFlashHeight()}catch(e){}}var t=BeFunky.LoginPanelObj.isLoggedInNextFunction;if("function"==typeof t){t(),BeFunky.LoginPanelObj.isLoggedInNextFunction=!1;var n=BeFunky.getModal();n&&["sign_in_modal","register_modal"].includes(n.modalID)&&BeFunky.closeModal(n.modalID)}else BeFunky.User.isNewUser?(BeFunky.befunkyPopupContainerClose(),BeFunky.openWelcomePanel()):BeFunky.befunkyPopupContainerClose()},BeFunky.onDocumentReady(function(){try{!function(){function e(){BeFunky.loginWithGoogle()}function t(){BeFunky.showLoadScreen(),BeFunky.FacebookAuth.loginWithFacebook().catch(function(e){BeFunky.logError("Facebook login failed",e)}).then(function(){BeFunky.hideLoadScreen()})}document.getElementById("sign_in_modal_google").addEventListener("click",e),document.getElementById("sign_in_modal_facebook").addEventListener("click",t),document.getElementById("sign_in_form").addEventListener("submit",function(e){e.preventDefault(),BeFunky.signinSubmit()}),document.getElementById("sign_in_modal_create_account").addEventListener("click",function(e){e.preventDefault(),BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.isLoggedInNextFunction)}),document.getElementById("sign_in_modal_forgot_password").addEventListener("click",function(e){e.preventDefault(),BeFunky.openLoginPanel("FORGETPASS",BeFunky.LoginPanelObj.isLoggedInNextFunction)}),document.getElementById("register_modal_google").addEventListener("click",e),document.getElementById("register_modal_facebook").addEventListener("click",t),document.getElementById("register_form").addEventListener("submit",function(e){e.preventDefault(),BeFunky.registerSubmit()}),document.getElementById("register_modal_has_account").addEventListener("click",function(e){e.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.isLoggedInNextFunction)}),document.getElementById("reset_password_form").addEventListener("submit",function(e){e.preventDefault(),BeFunky.forgetPassSubmit()}),document.getElementById("reset_password_modal_sign_in").addEventListener("click",function(e){e.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.isLoggedInNextFunction)})}()}catch(e){window.location.href.includes("/index-ui.html")||BeFunky.throwError(e,"Unable to initialize sign-in, register & reset-password modals")}}),BeFunky.handleAlreadyLoggedInError=function(e){return BeFunky.logError('Handling "already_logged_in" API error'),BeFunky.setLocal("already_logged_in_error_time",Date.now()),BeFunky.requestAPI("auth/status",{},{showLoadScreen:!0}).catch(function(e){throw BeFunky.throwError("/status/ failed after already_logged_in sign-in error",e),e}).then(function(t){if(!t.data.email)throw BeFunky.logError("User data missing email: ",JSON.stringify(t.data)),"invalid_response";return e===t.data.email?t.data:(BeFunky.logError('Logging out existing user "'+t.data.email+'" so that new user "'+e+'" can sign in'),BeFunky.signOut(!1).then(function(){return Promise.reject("different_user_logged_out")},function(){return Promise.reject("different_user_logged_in")}))})},void 0===window.enableTeasers&&(window.enableTeasers=!0);var tn={_default:{featureName:"this_feature",images:["global.jpg"]},artsy:{featureName:"Artsy",text:"teaser_artsy",images:["artsy-before.jpg","artsy-after.jpg"]},background:{featureName:"background",text:"teaser_background",images:["background-before.jpg","background-after.jpg"]},batch_processing:{featureName:"batch_processing",text:"teaser_batch_processing",images:["batch-processing.jpg"]},clarity:{featureName:"clarity",text:"teaser_clarity",images:["clarity-before.jpg","clarity-after.jpg"]},clone:{featureName:"clone",text:"teaser_clone",images:["clone-before.jpg","clone-after.jpg"]},collage_wizard:{featureName:"collage_wizard",text:"teaser_collage_wizard",images:["collage-wizard.jpg"]},cutout:{featureName:"cutout",text:"teaser_cutout",images:["cutout-before.jpg","cutout-after.jpg"]},designer_templates:{skipTeaser:!0},enhance_dlx:{featureName:"Enhance DLX",text:"teaser_enhance_dlx",images:["enhance-DLX-before.jpg","enhance-DLX-after.jpg"]},fill_light:{featureName:"fill_light",text:"teaser_fill_light",images:["fill-light-before.jpg","fill-light-after.jpg"]},funky_focus:{featureName:"funky_focus",text:"teaser_funky_focus",images:["funky-focus-before.jpg","funky-focus-after.jpg"]},glow:{featureName:"glow",text:"teaser_glow",images:["glow-before.jpg","glow-after.jpg"]},lens_flares:{featureName:"lens_flare",text:"teaser_lens_flares",images:["lens-flare-before.jpg","lens-flare-after.jpg"]},photo_effects:{featureName:"photo_effects",text:"teaser_photo_effects",images:["photo-effects.jpg"]},replace_color:{featureName:"replace_color",text:"teaser_replace_color",images:["replace-color-before.jpg","replace-color-after.jpg"]},reshape:{featureName:"reshape",text:"teaser_reshape",images:["reshape-before.jpg","reshape-after.jpg"]},save_editor:{headingText:"teaser_save_editor_heading",text:"teaser_save_editor",images:["global.jpg"]},save_collage:{headingText:"teaser_save_collage_heading",text:"teaser_save_collage",images:["collage-wizard.jpg"]},save_designer:{headingText:"pricing_modal_templates_heading",text:"teaser_save_designer",images:["designer-templates.jpg"]},top_nav_bar:{skipTeaser:!0},touchup:{featureName:"touch_up_tools_titlecase",text:"teaser_touchup",images:["touch-up-before.jpg","touch-up-after.jpg"]},vibrance:{featureName:"vibrance",text:"teaser_vibrance",images:["vibrance-before.jpg","vibrance-after.jpg"]},vignette:{featureName:"vignette",text:"teaser_vignette",images:["vignette-before.jpg","vignette-after.jpg"]}},nn=void 0,on=BeFunky.once(function(){document.getElementById("teaser_modal_upgrade").addEventListener("click",function(){BeFunky.openUpgradePanel(nn,!0)}),document.getElementById("teaser_modal_sign_in").addEventListener("click",function(e){e.preventDefault(),BeFunky.openLoginPanel("SIGNIN",function(){BeFunky.openPaymentPanel()})})});function an(e,t,n){var o=t.querySelector(".modal-card__image");if(!n){var i=document.createElement("div").setStyles({"background-image":"url("+e+")"}).setClass("modal-card__fade-in-image");return o.appendChild(i),i}o.setStyles({"background-image":"url("+e+")"}),o.innerHTML=""}function rn(e){return new Promise(function(t,n){var o=new Image;o.onload=t,o.onerror=n,o.src=e})}BeFunky.openTeaserModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"_default";tn.hasOwnProperty(e)||(BeFunky.logError('Invalid teaser type "'+e+'" specified'),e="_default"),nn="batch_processing"===e?"batch":function(){try{return BFN.AppModel.sectionID}catch(e){BeFunky.logError("Unable to get current app section",e)}return""}(),window.enableTeasers&&!tn[e].skipTeaser?(on(),function(e){var t=document.getElementById("teaser_modal");BeFunky.isLoggedIn()&&t.querySelector(".modal-card__sign-in").setStyles({display:"none"});var n=tn[e],o=n.headingText,i=n.featureName,a=n.images,r=n.text;a=a.map(function(e){return BeFunky.Params.globalImagesPath+"teasers/"+e}),function(e,t,n){var o=n.querySelector("h2");e?o.setLang(e):t?o.setLang("teaser_modal_heading",{this_feature:function(){return BeFunky.LanguageManager.getString(t)}}):BeFunky.throwError("No heading specified for teaser")}(o,i,t),s=r,document.getElementById("teaser_modal_body").setLang(s||"teaser_default"),an(a[0],t,!0);var s;var l=!1;if(document.getElementById("teaser_modal").onModalClose=function(){l=!0},!a[1])return;function u(e){!function t(){requestAnimationFrame(function(){l||(e.toggleClass("modal-card__fade-in-image--visible"),setTimeout(t,4e3))})}()}rn(a[0]).then(function(){if(!l){var e=Date.now();rn(a[1]).then(function(){if(!l){var n=an(a[1],t,!1),o=Date.now(),i=2e3-(o-e);i>0?setTimeout(function(){u(n)},i):u(n)}})}}).catch(function(e){BeFunky.logError("Unable to load teaser image(s)",e)})}(e),BeFunky.befunkyPopupContainerOpen("#teaser_modal",{})):BeFunky.openUpgradePanel(nn,!0)},BeFunky.openUpgradePanel=function(e,t){if(t||(BeFunky.LoginPanelObj.closeNextFunction=openFlash),!BeFunky.isPlus()){un();var n={batch:"pricing_modal_card_batch_processing",collage:"pricing_modal_card_collage_wizard",designer:"pricing_modal_card_designer"},o=n[e]?document.getElementById(n[e]):null;o&&o.addClass("pricing-modal__card--first"),document.getElementById("pricing_modal").toggleClass("pricing-modal--flash",!BeFunky.isUseHTML5),BeFunky.befunkyPopupContainerOpen("#pricing_modal",{})}},BeFunky.openUpgradeToYearlyPanel=function(){BeFunky.isPlus()&&BeFunky.promptUserToUpgradeToYearly(window.openFlash)},BeFunky.promptUserToUpgradeToYearly=function(e){BeFunky.confirm("upgrade_yearly_modal_body",{heading:"upgrade_yearly_modal_heading",confirmText:"upgrade_yearly_modal_confirm",cancelText:"upgrade_yearly_modal_cancel",imageUrl:BeFunky.Params.globalImagesPath+"site/switch-yearly.jpg",onConfirm:function(){BeFunky.upgradeToYearlyPayNow()},onCancel:e})},BeFunky.upgradeToYearlyClose=function(){return BeFunky.befunkyPopupContainerClose(),window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","NOT_NOW"),!1},BeFunky.upgradeToYearlyPayNow=function(){window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","PAY_NOW"),BeFunky.requestAPI("transaction/upgrade-to-yearly",{},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_SUCCESS"),window.location.reload()}).catch(function(e){window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_FAILURE"),BeFunky.logError("Unable to process payment upgrade to Yearly",e)})},BeFunky.selectedPackageName=null,BeFunky.openPaymentPanel=function(e,t){if(["charge","update","update_from_payflow"].includes(t)||(t="charge"),["monthly","yearly"].includes(e)||(e="yearly"),BeFunky.isPlus()&&"charge"===t){var n=BeFunky.getModal(),o=n?n.modalElement.id:void 0;["sign_in_modal","register_modal"].includes(o)&&BeFunky.closeModal(o)}else{if(BeFunky.selectedPackageName=e,!BeFunky.isLoggedIn())return BeFunky.registerComeFromUpgrade=!0,BeFunky.openLoginPanel("REGISTER",function(){BeFunky.openPaymentPanel(BeFunky.selectedPackageName,t)}),!1;if("object"===i(window.stripe)){ln(),BeFunky.befunkyPopupContainerOpen("#payment_modal",{addDigiCert:!0});var a,r=document.querySelector("#payment_modal"),s=BeFunky.User.email||BeFunky.User.FlashVarsObject.email;if(s){var l=(a=BeFunky.Params.frmNames.cce,r.querySelector('[name="'+a+'"]'));l&&(l.value=s)}r.selectedPlan=BeFunky.selectedPackageName,r.selectedMode=t}else BeFunky.throwError("Unable to initialize payment modal b/c window.stripe is unavailable")}};var sn=!1,ln=BeFunky.once(function(){var e=document.getElementById("payment_modal"),t=function(t){return e.querySelector('[name="'+t+'"]')},n=e.querySelector("h2"),o=e.querySelector('[type="submit"]'),a=document.getElementById("payment_modal_summary"),r=t("period"),s=t("mode"),l={yearly:{radioButton:document.getElementById("payment_modal_plan_yearly"),amount:void 0!==BeFunky.Params.priceannual?BeFunky.Params.priceannual:59.88,summaryText:"billing_summary_annual"},monthly:{radioButton:document.getElementById("payment_modal_plan_monthly"),amount:void 0!==BeFunky.Params.pricemonthly?BeFunky.Params.pricemonthly:6.99,summaryText:"billing_summary_monthly"}},u=l.yearly.radioButton.checked?"yearly":"monthly";Object.defineProperty(e,"selectedPlan",{set:function(e){if(!l.hasOwnProperty(e))throw new Error("Invalid payment plan: "+e+" "+BeFunky.getType(e));l[u=e].radioButton.checked=!0,r.value=e,n.setLang("payment_modal_heading"),o.setLang("submit_payment"),a.setLang(l[u].summaryText,{amount:"<strong>$"+l[u].amount+"</strong>",subscription_policy:function(){return'<a href="'+BeFunky.Params.siteUrl+'terms/?cmfrm=1#renewals" target="_blank">'+BeFunky.LanguageManager.getString("subscription_policy")+"</a>"}})},get:function(){return u}}),Object.entries(l).forEach(function(t){var n=c(t,2),o=n[0];n[1].radioButton.addEventListener("change",function(){e.selectedPlan=o})});var d=["charge","update","update_from_payflow"],p="charge";Object.defineProperty(e,"selectedMode",{set:function(t){if(!d.includes(t))throw new Error("Invalid payment mode: "+t+" "+BeFunky.getType(t));p=t,s.value=p;var i=p.startsWith("update");e.toggleClass("payment-modal--update-mode",i),i&&(n.setLang("payment_modal_heading_update"),o.setLang("update"))},get:function(){return p}});var g=t("cc-holdername"),h=document.getElementById("payment_modal_card_number"),m=document.getElementById("payment_modal_card_expiry"),f=document.getElementById("payment_modal_card_cvc"),y=document.getElementById("payment_modal_card_type"),v=BeFunky.LanguageManager.language[window.isFlashOpenned?"app":"site"],_=["zh","da","nl","en","fi","fr","de","it","ja","no","es","sv"].includes(v)?v:"auto",k=window.stripe.elements({locale:_,fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Poppins"}]}),b={base:{color:"#1e2024",fontWeight:400,fontFamily:"Poppins, system-ui, sans-serif",fontSize:"16px",fontSmoothing:"antialiased",lineHeight:"24px"},invalid:{color:"#1e2024"}},w={focus:"focused",empty:"empty",invalid:"invalid"},F=k.create("cardNumber",{style:b,classes:w,placeholder:""});F.mount(h);var B=k.create("cardExpiry",{style:b,classes:w,placeholder:""});B.mount(m);var E=k.create("cardCvc",{style:b,classes:w,placeholder:""});E.mount(f),F.on("change",function(e){var t=e.brand;t&&(y.innerHTML="unknown"===t?"":BeFunky.getSvgHtml("cc-"+t))});var S,I,C,L=function(e,t){switch(e){case"name":g.addClass("material-field__input--invalid").nextElementSibling.textContent=t;break;case"number":h.addClass("invalid").nextElementSibling.textContent=t;break;case"expiry":m.addClass("invalid").nextElementSibling.textContent=t;break;case"cvc":f.addClass("invalid").nextElementSibling.textContent=t;break;case"form":$t.displayError("#payment_modal",t);break;default:BeFunky.throwError("Invalid field name: "+e)}};S=g,I=function(){cn(g)?g.removeClass("material-field__input--invalid"):L("name","Please enter a name")},C=BeFunky.debounce(I,100),S.addEventListener("change",C),S.addEventListener("keyup",C),S.addEventListener("blur",C),F.on("change",function(e){var t=e.error;t&&L("number",t.message)}),B.on("change",function(e){var t=e.error;t&&L("expiry",t.message)}),E.on("change",function(e){var t=e.error;t&&L("cvc",t.message)});var P=function(){g.value="",F.clear(),B.clear(),E.clear()};e.onModalClose=P,document.getElementById("payment_modal_form").addEventListener("submit",function(e){e.preventDefault(),$t.clearError("#payment_modal"),cn(g)&&function(e){var t=e.cardHolderName,n=e.stripeElement,o=e.email,a=e.mode,r=e.period,s=e.displayError,l=e.clearInputs;function u(e,t,n){switch(BeFunky.hideLoadScreen(),sn=!1,BeFunky.logError("A payment error occurred",JSON.stringify({code:e,message:t})),e){case"card_declined":case"invalid_number":case"incorrect_number":case"incomplete_number":case"expired_card":s("number",t);break;case"incomplete_expiry":case"invalid_expiry_month":case"invalid_expiry_year":case"invalid_expiry_year_past":s("expiry",t);break;case"incomplete_cvc":case"invalid_cvc":case"incorrect_cvc":s("cvc",t);break;case"processing_error":s("form","error_processing_payment");break;default:"string"==typeof t?s("form",t):(s("form","error_invalid_response"),n&&BeFunky.logError("Unable to get error info from response: "+JSON.stringify(n)),BeFunky.throwError("Unknown payment error shown to user",e,t,n))}}sn?BeFunky.logError("Already processing payment"):(BeFunky.showLoadScreen({isCancellable:!1}),sn=!0,window.stripe.createToken(n,{name:t}).then(function(e){var n=e.error,s=e.token;if(n)u(n.code,n.message);else if(s&&s.id){var c="0";try{c="undefined"!=typeof growsumo&&growsumo.data.partner_key&&growsumo.data.partner_key.length>0?growsumo.data.partner_key:"0"}catch(e){}if("0"!==c)try{growsumo.data.email=o,growsumo.data.customer_key=o,growsumo.createSignup()}catch(e){}var d=function(e){if(sn=!1,e&&e.error)return"string"==typeof e.error?(BeFunky.throwError("BeFunky API request failed",e.error),u(e.error,BeFunky.failureReason(e.error))):"user_is_plus"===e.error.code?(BeFunky.throwError("Already-plus user filled out payment form"),u(e.error.code,"You are already a BeFunky Plus user")):u(e.error.code,e.error.message,e);try{bf_eventTrack("CONVERSION",r.toUpperCase(),"CREDITCARD"),BeFunky.User.FlashVarsObject.subscr_date&&"charge"===a&&bf_eventTrack("RESUBSCRIBE",r.toUpperCase(),"CREDITCARD")}catch(e){BeFunky.logError("Unable to track payment conversion",e)}var t={pl:"1",subscr_usr:1};if(e&&e.data&&e.data.plan_type?t.plan_type=e.data.plan_type:r?t.plan_type="yearly"===r?1:0:BeFunky.throwError("Unable to get plan_type"),e&&e.data&&e.data.subscr_amount?t.subscr_amount=e.data.subscr_amount:r?t.subscr_amount="yearly"===r?BeFunky.Params.priceannual:BeFunky.Params.pricemonthly:BeFunky.throwError("Unable to get subscr_amount"),e&&e.data&&e.data.subscr_date?t.subscr_date=e.data.subscr_date:window.bfn_mp?t.subscr_date=window.bfn_mp.getISODate():BeFunky.throwError("Unable to get subscr_date"),window.updateUserStatus(Object.assign({},window.latestUserData,t)),"update"!==a&&(!1===(window.isMixPanelInit&&"function"==typeof mixpanel.identify)&&(console.log("Mixpanel load: "+window.isMixPanelInit),console.log("Mixpanel identify: "+i(mixpanel.identify)),console.log("Mixpanel upl: "+BeFunky.User.FlashVarsObject.pl),console.log("Mixpanel subscr: "+BeFunky.User.FlashVarsObject.subscr_usr),console.log("Mixpanel plantype: "+BeFunky.User.FlashVarsObject.plan_type),BeFunky.throwError("Mixpanel could not track purchase")),void 0!==window.bfn_mp&&void 0!==window.mixpanel)){var n=!1;if(void 0!==navigator.doNotTrack&&!0===BeFunky.ConvertToBool(navigator.doNotTrack)?n=!0:void 0!==navigator.msDoNotTrack&&!0===BeFunky.ConvertToBool(navigator.msDoNotTrack)?n=!0:void 0!==window.doNotTrack&&!0===BeFunky.ConvertToBool(window.doNotTrack)&&(n=!0),!0===n){console.log("Mixpanel do not track enabled");try{window.bfn_mp.trackingEnabled=!1;var o=window.bfn_mp.track("subscription_started");o||(console.log("bfn_mp.identifier = ",window.bfn_mp.identifier),console.log("Mixpanel upl: "+BeFunky.User.FlashVarsObject.pl),console.log("Mixpanel subscr: "+BeFunky.User.FlashVarsObject.subscr_usr),console.log("Mixpanel plantype: "+BeFunky.User.FlashVarsObject.plan_type));var s={data:{people:null!==o[0]?o[0]:"",super:null!==o[1]?o[1]:"",property:null!==o[2]?o[2]:""}};s=void 0!==window.base64_encode?window.base64_encode(JSON.stringify(s)):btoa(JSON.stringify(s)),BeFunky.requestAPI("auth/has-opted-out-tracking",{event:"subscription_started",data:s})}catch(e){BeFunky.throwError("Mixpanel has_opted_out_tracking block error: ",e)}}else try{window.bfn_mp.track("subscription_started")}catch(e){}}if(BeFunky.isUseHTML5)try{BFN.BfnService.getUserData()}catch(e){}else try{document.getElementById(BeFunky.Params.swfId).userValueObj(BeFunky.User.FlashVarsObject)}catch(e){}try{window.flashFreeTop=0,window.flashFreeRight=0,window.isflashFreeRight=!1,window.reResizeFlashHeight()}catch(e){}if(BeFunky.hideLoadScreen(),"charge"===a){BeFunky.preventModalDispose=!0,BeFunky.closeModal("payment_modal"),BeFunky.preventModalDispose=!1;try{BeFunky.openThankYouPanel(BeFunky.LoginPanelObj.closeNextFunction)}catch(e){var c=BeFunky.isInternetExplorer?BeFunky.logError:BeFunky.throwError;c("Unable to open thank-you panel",e),"function"==typeof BeFunky.LoginPanelObj.closeNextFunction&&BeFunky.LoginPanelObj.closeNextFunction()}}else BeFunky.closeModal("payment_modal");l(),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()};if(BeFunky.Params.IS_LC)return d({error:"local_dev"});var p=void 0;if("charge"===a||"update"===a)p={stripeEmail:o,stripeToken:s.id,holdername:t,isGrowsumo:c,handlerType:"subscription_purchase",period:"yearly"===r?BeFunky.Params.strp_pck_yearly_nm:BeFunky.Params.strp_pck_monthly_nm};else{if("update_from_payflow"!==a)return BeFunky.throwError("Invalid payment mode: "+a);p={stripeEmail:o,stripeToken:s.id,nextBillingDate:"monthly"===r?BeFunky.Params.nextBillingDateMonthly:BeFunky.Params.nextBillingDateAnnual,period:r}}var g="update_from_payflow"===a?"update-payflow-customer":"update"===a?"update-customer":"create-customer";BeFunky.requestAPI("transaction/"+g,p).then(function(e){d(e)},function(e){d({error:e})})}else u(void 0,"Missing Stripe token")}).catch(function(e){BeFunky.logError("An unexpected payment-related error occurred",e),BeFunky.throwError(e),u(void 0,"Unknown error")}))}({cardHolderName:g.value,stripeElement:F,email:t(BeFunky.Params.frmNames.cce).value,mode:s.value,period:r.value,displayError:L,clearInputs:P})})}),un=BeFunky.once(function(){var e=document.getElementById("pricing_modal");document.getElementById("pricing_modal_upgrade").addEventListener("click",function(){var e=document.getElementById("pricing_modal_plan_yearly").checked?"yearly":"monthly";BeFunky.openPaymentPanel(e)});["batch_processing_video","collage_wizard_video","lens_flare_video"].forEach(function(e){document.getElementById(e).addEventListener("click",function(t){t.preventDefault(),BeFunky.openVimeoModal(e)})});[{id:"pricing_modal_cutout_body",links:{cutout_tool:"https://blog.befunky.com/cutout-tool-2/",clone_tool:"https://blog.befunky.com/clone/"}},{id:"pricing_modal_effects_body",links:{photo_effects:"https://blog.befunky.com/photo-effects/"}},{id:"pricing_modal_artsy_body",links:{artsy_effects:"https://blog.befunky.com/artsy-effects/"}},{id:"pricing_modal_batch_body",links:{batch_processing:"https://blog.befunky.com/batch-processing-photos/"}},{id:"pricing_modal_enhance_body",links:{fill_light:"https://blog.befunky.com/fill-light/",vibrance:"https://blog.befunky.com/vibrance-tool/",clarity:"https://blog.befunky.com/clarity-tool/","Enhance DLX":"https://blog.befunky.com/photo-enhancer/"}},{id:"pricing_modal_templates_body",links:{templates_link:"https://blog.befunky.com/graphic-design-templates/"}},{id:"pricing_modal_background_body",links:{background:"https://blog.befunky.com/transparent-background/",cutout:"https://blog.befunky.com/cutout-tool-2/",replace_color:"https://blog.befunky.com/replace-color-tool/"}},{id:"pricing_modal_touchup_body",links:{touch_up_tools:"https://blog.befunky.com/retouch-photos/"}},{id:"pricing_modal_flares_body",links:{lens_flares:"https://blog.befunky.com/lens-flare-effects/",glow:"https://blog.befunky.com/glow-tool/"}},{id:"pricing_modal_focus_body",links:{vignette:"https://blog.befunky.com/vignette/",funky_focus:"https://blog.befunky.com/funky-focus/"}},{id:"pricing_modal_reshape_body",links:{reshape_tool:"https://blog.befunky.com/reshape-tool/"}}].forEach(function(t){var n=t.id,o=t.links,i={};Object.entries(o).forEach(function(e){var t=c(e,2),n=t[0],o=t[1];i[n]=function(){return'<a href="'+o+'" target="_blank">'+BeFunky.LanguageManager.getString(n)+"</a>"}});var a=e.querySelector('[data-lang="'+n+'"]');if(!a)return BeFunky.logError("Unable to find pricing modal element with translation ID =",n);BeFunky.LanguageManager.registerElement(a,i)}),e.onModalClose=function(){var t=e.querySelector(".pricing-modal__card--first");t&&t.removeClass("pricing-modal__card--first")}});function cn(e){var t=e.value.replace(/[\d@~`#$%^&*()\\\/<>!¡™£¢∞§¶•ªº≠+=:;…¨"{}[\]|?]/g,"");return e.value=t,t.length>=3}var dn="user_photo_modal",pn={},gn=null,hn=null,mn=!1,fn=[],yn=void 0,vn=void 0,_n=void 0,kn=void 0,bn=void 0,wn=void 0;function Fn(e,t,n){if(e){var o=document.querySelector(".user-photo__image-box");o.innerHTML="",pn.hasOwnProperty(e.imageURL)?o.appendChild(pn[e.imageURL]):o.appendChild(Bn(e)),_n.textContent=e.title;var i=_n.innerHTML.replace(/#(\w+)/gi,'<a href="'+BeFunky.Params.siteUrl+'explore/photos/$1/">#$1</a>');if(_n.innerHTML=i||"Untitled",kn.innerHTML='by <a href="'+BeFunky.Params.siteUrl+"gallery/"+e.nick+'/">'+e.nick+"</a>",t){var a=t.indexOf(e);gn=t[a-1],hn=t[a+1];var r=c(BeFunky.getModal(dn).arrowButtons,2),s=r[0],l=r[1];s.disabled=!gn,l.disabled=!hn,requestIdleCallback(function(){gn&&Bn(gn),hn&&Bn(hn)})}}else vn.src="",_n.innerHTML="",kn.innerHTML="",Object.keys(pn).forEach(function(e){delete pn[e]});if(bn.toggleClass("user-photo__report-abuse--hidden",!n),e){wn=e.id.replace("befunky_photo_","");var u=fn.includes(wn);bn.disabled=u,bn.setLang(u?"abuse_reported":"report_abuse")}}function Bn(e){var t=new Image;return t.src=e.imageURL,t.setClass("image-box__image explore-modal__image"),t.id="explore-image",pn[t.src]=t,t}function En(e){return"explore/gallery/"+e.id.split("_").pop()+"/"}function Sn(e){if(!BeFunky.isLoggedIn())return BeFunky.openLoginPanel("SIGNIN",function(){BeFunky.befunkyPopupContainerClose(),Sn(e)});if(!(null!=BeFunky.User.isMailVerified?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified))return BeFunky.confirm("please_verify_email",{onConfirm:BeFunky.sendVerificationEmail,confirmText:"send_verification_email"});var t=document.createElement("div");t.appendChild(document.createElement("p").setLang("report_abuse_prompt_1")),t.appendChild(document.createElement("p").setLang("report_abuse_prompt_2")),BeFunky.confirm(t,{heading:"report_abuse",confirmText:"report",onConfirm:function(){var t={mode:"reportAbuse",img_key:e};BeFunky.requestAPI("photo/report-abuse",t,{showLoadScreen:!0}).then(function(){fn.push(e)}).catch(function(t){BeFunky.throwError("Unable to Report Abuse on image",t,e)}).then(function(){BeFunky.acknowledge("report_abuse_thank_you",{heading:"report_abuse_sorry"})})}})}BeFunky.onDocumentReady(function(){(yn=document.getElementById(dn))&&(vn=yn.querySelector(".user-photo__image"),_n=yn.querySelector(".user-photo__title"),kn=yn.querySelector(".user-photo__author"),(bn=yn.querySelector(".user-photo__report-abuse")).addEventListener("click",function(){if(!wn)return BeFunky.throwError("reportAbuseImageID not found");var e=BeFunky.getModal(dn);e&&e.isVisible&&BeFunky.closeModal(dn),Sn(wn)}))}),BeFunky.reportAbuse=Sn,BeFunky.openUserPhotoModal=function(e,t,n,o){if(!yn)return BeFunky.throwError("User Photo Modal not available");BeFunky.openModal(yn,{onOpen:function(){mn=!0,Fn(e,t,o),BeFunky.pushRoute(En(e))},onClose:function(){mn=!1,Fn(),BeFunky.pushRoute(n)},addSiteClass:!0,addCloseButton:!0,size:"large",onArrowClick:function(e){var n="left"===e?gn:hn;n&&(Fn(n,t,o),BeFunky.pushRoute(En(n)))}})},BeFunky.closeUserPhotoModal=function(){mn&&BeFunky.closeModal(dn)};var In={batch_processing_video:"https://player.vimeo.com/video/293033309",collage_wizard_video:"https://player.vimeo.com/video/159379542",lens_flare_video:"https://player.vimeo.com/video/168091282?byline=0"};BeFunky.openVimeoModal=function(e){var t=In[e];if(!t)return BeFunky.throwError("Invalid video ID",{videoID:e});var n=document.getElementById("vimeo_modal");n.innerHTML=function(e){return'\n    <div style="padding: 56.25% 0 0 0; position: relative;">\n        <iframe src="'+e+'" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n    </div>\n    <script src="https://player.vimeo.com/api/player.js"><\/script>\n'}(t),BeFunky.openModal(n,{onClose:function(){n.innerHTML=""},size:"large"})};var Cn=!1;if("undefined"!=typeof window){var Ln={get passive(){Cn=!0}};window.addEventListener("testPassive",null,Ln),window.removeEventListener("testPassive",null,Ln)}var Pn,xn="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform),An=[],Tn=!1,Rn=-1,Mn=void 0,Dn=void 0,Un=function(e){return An.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},On=function(e){var t=e||window.event;return!!Un(t.target)||(t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1))},Nn=function(e,t){if(xn){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(e&&!An.some(function(t){return t.targetElement===e})){var n={targetElement:e,options:t||{}};An=[].concat(p(An),[n]),e.ontouchstart=function(e){1===e.targetTouches.length&&(Rn=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-Rn;!Un(e.target)&&(t&&0===t.scrollTop&&n>0?On(e):function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?On(e):e.stopPropagation())}(t,e)},Tn||(document.addEventListener("touchmove",On,Cn?{passive:!1}:void 0),Tn=!0)}}else{!function(e){setTimeout(function(){if(void 0===Dn){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(Dn=document.body.style.paddingRight,document.body.style.paddingRight=n+"px")}void 0===Mn&&(Mn=document.body.style.overflow,document.body.style.overflow="hidden")})}(t);var o={targetElement:e,options:t||{}};An=[].concat(p(An),[o])}},Hn=function(){xn?(An.forEach(function(e){e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),Tn&&(document.removeEventListener("touchmove",On,Cn?{passive:!1}:void 0),Tn=!1),An=[],Rn=-1):(setTimeout(function(){void 0!==Dn&&(document.body.style.paddingRight=Dn,Dn=void 0),void 0!==Mn&&(document.body.style.overflow=Mn,Mn=void 0)}),An=[])},jn=function(){var e=document.createElement("div").setClass("modal-root modal-root--is-inactive");return e.id="modal_root",BeFunky.onDocumentReady(function(){e.parentElement||document.body.appendChild(e)}),e}(),qn=[],Vn=void 0,Gn={"extra-small":[320],small:[400],medium:[576],large:[960],"extra-large":[1280,800]},Wn=void 0;function zn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(e){if(e instanceof HTMLElement){if(!e.id)throw new Error("Modal elements must have unique IDs");return{modalElement:e,modalID:e.id}}if("string"==typeof e){var t=document.getElementById(e);if(!t)throw new Error("Unable to get modal element with id = "+e);return{modalElement:t,modalID:e}}throw new Error("Invalid modal element or id: "+BeFunky.getType(e))}(e),o=n.modalElement,i=n.modalID,a={closeOnClickOutside:!0,closeOnEscape:!0,destroyOnClose:!1,isCritical:!1,isDialog:!1,addSiteClass:!1,addCloseButton:!1,onOpen:void 0,onClose:void 0,onWindowResize:void 0,onArrowClick:void 0,size:void 0};void 0===t.size||Object.keys(Gn).includes(t.size)||(BeFunky.throwError("Invalid modal size: "+t.size+" - "+BeFunky.getType(t.size)),t.size=void 0),t=Object.assign({},a,t);var r,s,l,u=qn.findIndex(function(e){return e.modalID===i}),c=-1!==u,d=c?qn[u]:(r=function(e){var t=document.createElement("div").setClass("modal-root__outer"),n=document.createElement("div").setClass("modal-root__inner");return t.appendChild(n),n.appendChild(e),{outerContainer:t,innerContainer:n}}(o),s=r.innerContainer,l=r.outerContainer,{modalID:i,modalElement:o,isVisible:!0,innerContainer:s,outerContainer:l});if(Object.assign(d,t),c&&qn.splice(u,1),d.isCritical)qn.push(d);else{var p=qn.findIndex(function(e){return e.isCritical});-1===p?qn.push(d):qn.splice(p,0,d)}d.lastOpened=Date.now(),function(e){var t="function"==typeof e.onArrowClick,n=Array.isArray(e.arrowButtons);if(t===n)return;t?function(e){var t=function(t){var n=document.createElement("div").setClass("modal-root__arrow-container"),o=document.createElement("button").setClass("modal-root__arrow-button modal-root__arrow-button--"+t+" button button--icon button--grey");return o.setAttribute("aria-label","left"===t?"Previous":"Next"),o.innerHTML=BeFunky.getSvgHtml("global-arrow-icon"),o.addEventListener("click",function(){return e.onArrowClick(t)}),n.appendChild(o),{container:n,button:o}},n=t("left"),o=n.button,i=n.container,a=t("right"),r=a.button,s=a.container;e.arrowButtons=[o,r];var l=e.outerContainer;l.insertBefore(i,e.innerContainer),l.appendChild(s)}(e):function(e){e.arrowButtons.map(function(e){return e.parentElement}).forEach(function(t){e.outerContainer.removeChild(t)}),delete e.arrowButtons}(e)}(d),function(e){var t=!0===e.addCloseButton,n=!!e.closeButton;if(t===n)return;t?function(e){var t=document.createElement("button").setClass("button button--icon modal-root__close-button");t.setAttribute("aria-label","Close"),t.innerHTML=BeFunky.getSvgHtml("global-cancel-icon"),t.addEventListener("click",function(){try{t.dispatchEvent(new Event("CLOSE"))}catch(e){BeFunky.logError("Unable to dispatch event on close button",e)}}),e.closeButton=t,e.innerContainer.appendChild(t)}(e):function(e){e.innerContainer.removeChild(e.closeButton)}(e)}(d),d.outerContainer.toggleClass("site",d.addSiteClass),c?(d.outerContainer.removeClass("modal-root__outer--is-hidden"),d.isVisible=!0):function(e){jn.appendChild(e)}(d.outerContainer);var g=qn.filter(function(e){return e.isVisible});g.forEach(function(e,t){var n=e.outerContainer;n.setStyles({zIndex:t+1}),n.toggleClass("modal-root__outer--is-bottommost",0===t),n.toggleClass("modal-root__outer--is-topmost",t===g.length-1)}),Vn=g[g.length-1],Kn([d]),Wn=document.activeElement,$n(d.outerContainer),Jn(),"function"==typeof d.onOpen&&d.onOpen(),window.zE&&window.zE.hide&&window.zE.hide()}function Xn(e){var t="string"==typeof e?e:e.id;if(!t)throw new Error("Missing modal ID");var n=qn.findIndex(function(e){return e.modalID===t});if(-1===n)throw new Error("Specified modal "+t+" is not on screen");var o,i=qn[n];i.outerContainer.addClass("modal-root__outer--is-hidden"),i.isVisible=!1,(Vn=qn.slice().reverse().find(function(e){return e.isVisible}))&&Vn.outerContainer.addClass("modal-root__outer--is-topmost"),Yn(i.destroyOnClose)&&(qn.splice(n,1),o=i.outerContainer,jn.removeChild(o)),Vn?Vn.modalElement.contains(Wn)&&Wn.offsetParent?Wn.focus():$n(Vn.outerContainer):Wn&&Wn.offsetParent&&Wn.focus(),Jn(),"function"==typeof i.onClose&&i.onClose()}function Jn(){jn.toggleClass("modal-root--is-inactive",!Vn).toggleClass("modal-root--is-dialog",Vn&&Vn.isDialog),Vn?Nn(jn):Hn()}function Yn(e){return"function"==typeof e&&(e=e()),!!e}function $n(e){e.setAttribute("tabindex","0"),e.focus(),e.addEventListener("blur",function t(){e.removeEventListener("blur",t),e.removeAttribute("tabindex")})}function Kn(e){requestAnimationFrame(function(){var t={availableWidth:window.innerWidth-32,availableHeight:window.innerHeight-32},n=t.availableWidth,o=t.availableHeight;e.filter(function(e){var t=e.isVisible,n=e.size,o=e.onWindowResize;return t&&(n||"function"==typeof o)}).reverse().forEach(function(e){var t=e.onWindowResize,i=e.size,a=e.modalElement;if(i){var r=c(Gn[i],2),s=r[0],l=r[1],u=Math.min(n,s),d=l?Math.min(o,l):o;return a.setStyles({width:u+"px",height:l?d+"px":""}),void("function"==typeof t&&t({availableWidth:u,availableHeight:d}))}"function"==typeof t&&t({availableWidth:n,availableHeight:o})})})}function Qn(e){if(e instanceof HTMLElement&&["BUTTON","A"].includes(e.nodeName))return e;var t=document.createElement("button").setClass("dialog__button button");return Zn(e.text,t),"string"==typeof e.type?t.addClass("button--"+e.type):Array.isArray(e.type)&&e.type.forEach(function(e){t.addClass("button--"+e)}),"function"==typeof e.onClick&&t.addEventListener("click",e.onClick),t}function Zn(e,t){return!!e&&("string"==typeof e?(t.setLang(e,void 0,"modal"),!0):e instanceof HTMLElement?(t.appendChild(e),!0):Array.isArray(e)&&"string"==typeof e[0]?(t.setLang(e[0],e[1],"modal"),!0):(BeFunky.logError("Invalid content passed to dialog",e),!1))}BeFunky.addArrowKeyHandler({condition:function(){return Vn&&"function"==typeof Vn.onArrowClick},callback:function(e,t,n){if("keyup"===n.type&&("left"===t||"right"===t)){var o="left"===t?0:1;Vn.arrowButtons[o].disabled||Vn.onArrowClick(t)}}}),document.addEventListener("keyup",function(e){if(27===e.which&&Vn){var t=Vn,n=t.modalID,o=t.closeOnEscape;e.stopImmediatePropagation(),Yn(o)&&(Xn(n),BeFunky.reportUserAction("User closed "+n+" modal by pressing Escape"))}}),Pn=!1,jn.addEventListener(BeFunky.pointerdown,function(e){Pn=Vn.outerContainer!==e.target}),jn.addEventListener("click",function(e){if(!Pn&&Vn){var t=Vn,n=t.outerContainer,o=t.closeOnClickOutside,i=t.modalID;e.target===n&&(Date.now()-Vn.lastOpened<500||Yn(o)&&(Xn(i),BeFunky.reportUserAction("User closed "+i+" modal by clicking outside")))}}),jn.addEventListener("CLOSE",function(e){var t=e.target.closest(".modal-root__inner"),n=t.firstElementChild;t===Vn.innerContainer?Xn(n):BeFunky.throwError("CLOSE fired unexpectedly in non-topmost modal",n.id,Vn.modalElement.id)},!0),window.addEventListener("resize",BeFunky.debounce(function(){return Kn(qn.slice())},100)),BeFunky.openModal=zn,BeFunky.closeModal=Xn,BeFunky.toggleModal=function(e,t,n){e?zn(t,n):Xn(t)},BeFunky.getModal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t="string"==typeof e?qn.find(function(t){return t.modalID===e}):Vn;return t?Object.assign({},t):void 0},BeFunky.isModalOpen=function(){return!!Vn},BeFunky.moveModalRoot=function(e){e!==jn.parentElement&&e.appendChild(jn)},BeFunky.focusModalContainer=$n,BeFunky.showDialog=function(e){var t=e.onClose,n=e.heading,o=e.body,i=e.buttons,a=void 0===i?[]:i,r=e.isCritical,s=void 0!==r&&r,l=e.disableClose,u=void 0!==l&&l,c=e.size,d=void 0===c?"small":c,p=e.imageUrl,g=e.isDialog,h=void 0===g||g,m=e.addCloseButton,f=void 0!==m&&m,y=e.addSiteClass,v=e.closeOnClickOutside,_=void 0!==v&&v,k=document.createElement("div").addClass("dialog"),b=document.createDocumentFragment();if(p){d="large",k.addClass("dialog--card");var w=document.createElement("div").addClass("dialog__image").setStyles({backgroundImage:"url('"+p+"')"});b.appendChild(w)}void 0===y&&(y=!!p);var F=document.createElement("div").setClass("dialog__body-container"),B=document.createElement("h4").setClass("dialog__heading"),E=document.createElement("div").addClass("dialog__body"),S=document.createElement("div").addClass("dialog__footer");if(Zn(n,B)&&F.appendChild(B),!Zn(o,E))throw new Error("dialog body required");F.appendChild(E),F.appendChild(S),a.map(Qn).forEach(function(e){S.appendChild(e),e.addEventListener("click",P)}),b.appendChild(F);var I=F.textContent;console.log("Opening dialog:",I.slice(0,35)+"..."),k.id="dialog_"+BeFunky.hash(I+s+u+d+p);var C=document.getElementById(k.id);C?(C.innerHTML="",C.appendChild(b)):k.appendChild(b);var L={onClose:t,destroyOnClose:!0,isCritical:s,size:d,isDialog:h,closeOnClickOutside:_,addCloseButton:f,addSiteClass:y};return u&&(Object.assign(L,{onClose:function(){BeFunky.throwError("User closed dialog which should never be closed",{content:k.textContent})},closeOnEscape:!1}),k.addClass("dialog--disable-close")),BeFunky.openModal(k,L),P;function P(){BeFunky.getModal(k.id)&&BeFunky.closeModal(k.id)}},BeFunky.acknowledge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onAcknowledge,o=t.buttonText,i=void 0===o?"ok_got_it":o,a=t.heading,r=t.isCritical,s=void 0!==r&&r,l=t.disableClose,u=void 0!==l&&l,c=t.size;if(!(("string"==typeof e||Array.isArray(e))&&e.length||e instanceof HTMLElement))throw new Error("message required");var d={onClose:n,buttons:[{text:i,type:"blue"}],heading:a,body:e,isCritical:s,disableClose:u,size:c};return BeFunky.showDialog(d)},BeFunky.confirm=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onConfirm,o=t.onCancel,i=void 0===o?function(){}:o,a=t.confirmText,r=void 0===a?"ok":a,s=t.cancelText,l=void 0===s?"cancel":s,u=t.heading,c=t.isCritical,d=void 0!==c&&c,p=t.size,g=void 0===p?"small":p,h=t.imageUrl,m=void 0===h?void 0:h;if(!(("string"==typeof e||Array.isArray(e))&&e.length||e instanceof HTMLElement))throw new Error("message required");if("function"!=typeof n)throw new Error("onConfirm callback required");var f=!1,y={onClose:function(){f?n():i()},buttons:[{text:l,type:window.isFlashOpenned?"grey":"medium-grey"},{text:r,type:"blue",onClick:function(){f=!0}}],heading:u,body:e,isCritical:d,size:g,imageUrl:m};return BeFunky.showDialog(y)};var eo=[".navbar-dropdown",".popover",".modal-root__outer",".dialog",".side-panel .tool-menu",".preset-menu","#alternateMenu",".dropdown__list",".preset-menu-item-basic-settings","#globalHistoryMenu",".canvas-footer",".site-nav__dropdown-content",".site-nav__popup-root"].join(", "),to=[".focus-avoid",".popover:not(.active)",".image-gallery__images",".image-manager__images",".tab__panel:not(.active)",".tab__button.active",".accordion__panel",".control-item-disabled",".autocomplete__item--selected:first-child"].join(", ");function no(e,t,n){t(),e.addEventListener("blur",function t(){e.removeEventListener("blur",t),n()})}function oo(e){var t={upgrade:function(){BeFunky.openUpgradePanel(null,!0)},register:function(){BeFunky.openLoginPanel("REGISTER")},sign_in:function(){BeFunky.openLoginPanel("SIGNIN")},sign_out:function(){BeFunky.signOut()},pay_monthly:function(){BeFunky.openPaymentPanel("monthly","charge")},pay_yearly:function(){BeFunky.openPaymentPanel("yearly","charge")},switch_to_yearly:function(){return BeFunky.promptUserToUpgradeToYearly()},get_started_header:function(){return io("HEADER")},get_started:function(){return io()}};return t[e]?t[e]():BeFunky.isCreateRoute(e)?(BeFunky.throwError('Unexpected deep link handled like button: "'+e+'"'),BeFunky.pushRoute(e)):void BeFunky.throwError('Unhandled Prismic button action: "'+e+'" ('+BeFunky.getType(e)+")")}function io(e){if(!BeFunky.Params.canUseWebapp)return BeFunky.trackDeepLink("GET-STARTED",e),BeFunky.handleMobileUserAttemptToOpenApp("web_mobile_apps");var t=document.getElementById("get_started_modal");[].concat(p(t.querySelectorAll("img"))).forEach(function(e){return window.loadLazyImage(e)}),BeFunky.openModal(t,{size:"large",addCloseButton:!0})}function ao(){var e=this;this.init=function(){this.initPublicAPI(),this.initSearchForm(),this.initGallery()},this.initPublicAPI=function(){var e=this;BeFunky.explorePage.isAvailable=!0,BeFunky.explorePage.search=function(t){e.searchInput.value=t,e.loadSearchResults(t,1)},BeFunky.explorePage.openImage=function(t){if(!t)return e.closeModal();var n=e.gallery.images.find(function(e){return e.id==="befunky_photo_"+t});n?e.openModal(n):BeFunky.logError("Unable to open Explore image",{imageID:t})}},this.initSearchForm=function(){var e=this;this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.previousSearchQuery=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",function(){return e.searchInput.focus()}),this.searchForm.addEventListener("submit",this.handleSearch)},this.initGallery=function(){var e=this;this.gallery=this.querySelector(".explore__gallery");BeFunky.imageGallery(this.gallery,{imagesPerRow:this.getImagesPerRow(),imageSelectionHandler:function(t){return e.openModal(t),!1},gutterWidth:16}),this.gallery.addClass("image-gallery--use-borders"),window.addEventListener("resize",BeFunky.debounce(function(){return e.handleGalleryResize()},300))},this.loadSearchResults=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.previousSearchQuery===e&&n<=this.previousSearchPage||(this.previousSearchQuery=e,this.previousSearchPage=n,BeFunky.pushRoute(e?"explore/photos/"+encodeURIComponent(e)+"/":"explore/"),1===n&&(this.gallery.images=[],this.gallery.scrollTop=0),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2],o={start:100*(t-1),end:100};e&&e.length>0&&(o.keyword=e);BeFunky.requestAPI("/photo/explore/",o).then(function(e){if(!Array.isArray(e.data))throw"invalid_response";if(!e.data.length)return n({error:"no_results"});var t=e.data.map(function(e){return{id:"befunky_photo_"+e.id,thumbWidth:200,thumbHeight:200,thumbURL:e.thumb_url,imageURL:e.url,nick:e.nick,title:e.title,dateCreated:e.dateCreated}});return n({images:t})})}(e,n,function(o){var i=o.error,a=o.images;if(e===t.previousSearchQuery){if(t.gallery.isLoading=!1,t.toggleInteractivity(!0),i)return BeFunky.logError("Unable to fetch images",i),void("no_results"===i?(t.gallery.message="",t.gallery.emptyState={icon:"no-results-icon",text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'+e+'</strong>"'})}):(t.gallery.message={isError:!0,text:BeFunky.failureReason(i),buttonText:"try_again",buttonAction:function(){return t.loadSearchResults(e,n)}},t.gallery.emptyState="",t.previousSearchPage=t.previousSearchPage-1));if(t.gallery.images=[].concat(p(t.gallery.images),p(a)),t.gallery.message="",!(a.length<100)){t.gallery.message={buttonText:"load_more",buttonAction:function(){return t.loadSearchResults(e,n+1)}}}}}))},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e},this.openModal=function(t){var n=e.previousSearchQuery?"explore/photos/"+e.previousSearchQuery+"/":"explore/";BeFunky.openUserPhotoModal(t,e.gallery.images,n,!0)},this.closeModal=function(){BeFunky.closeUserPhotoModal()},this.getImagesPerRow=function(){var t=e.gallery.offsetWidth;return t<1200?Math.round(Math.max(2,5*t/1200)):5},this.handleSearch=function(t){t&&t.preventDefault();var n=e.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();e.searchInput.value=n,e.loadSearchResults(n)},this.handleGalleryResize=function(){window.isFlashOpenned||(e.gallery.imagesPerRow=e.getImagesPerRow())},this.init()}function ro(){var e=this;this.init=function(){this.initPublicAPI(),this.setMetaData(),this.initGallery(),this.initResults()},this.setMetaData=function(){this.userNickName=window.location.href.match(/\/gallery\/([^\/]+)/)[1],document.title=this.userNickName+"'s Public Gallery | BeFunky: Free Online Photo Editor & Photo Effects, Edit Images & Share Photos",document.querySelector(".user-gallery__username").textContent=this.userNickName,document.querySelector('link[rel="canonical"]').href=BeFunky.Params.siteUrl+"gallery/"+this.userNickName+"/"},this.initPublicAPI=function(){var e=this;BeFunky.galleryPage.isAvailable=!0,BeFunky.galleryPage.openImage=function(t){if(!t)return e.closeModal();var n=e.gallery.images.find(function(e){return e.id==="befunky_photo_"+t});n?e.openModal(n):BeFunky.logError("Unable to open Gallery image",{imageID:t})}},this.initGallery=function(){var e=this;this.gallery=this.querySelector(".user-gallery__gallery");BeFunky.imageGallery(this.gallery,{imagesPerRow:this.getImagesPerRow(),imageSelectionHandler:function(t){return e.openModal(t),!1},gutterWidth:16}),this.gallery.addClass("image-gallery--use-borders"),window.addEventListener("resize",BeFunky.debounce(function(){return e.handleGalleryResize()},300))},this.initResults=function(){this.loadResults(1)},this.loadResults=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t<=this.previousSearchPage||(this.previousSearchPage=t,1===t&&(this.gallery.images=[],this.gallery.scrollTop=0),this.gallery.message="",this.gallery.isLoading=!0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2],o={start:100*(t-1),end:100,user_nick:e};BeFunky.requestAPI("photo/gallery",o).then(function(e){if(!Array.isArray(e.data))throw"invalid_response";if(!e.data.length)return n({error:"no_results"});var t=e.data.map(function(e){return{id:"befunky_photo_"+e.id,thumbWidth:200,thumbHeight:200,thumbURL:e.thumb_url,imageURL:e.url,nick:e.nick,title:e.title,dateCreated:e.dateCreated}});return n({images:t})}).catch(function(e){"user_does_not_exist"!==e?n({error:e}):window.location.href=BeFunky.Params.siteUrl+"404/"})}(this.userNickName,t,function(n){var o=n.error,i=n.images;if(e.gallery.isLoading=!1,o)return BeFunky.logError("Unable to fetch images",o),void("no_results"===o?(e.gallery.message="",e.gallery.emptyState={icon:"no-results-icon",text:"no_photos"}):(e.gallery.message={isError:!0,text:BeFunky.failureReason(o),buttonText:"try_again",buttonAction:function(){return e.loadResults(t)}},e.gallery.emptyState="",e.previousSearchPage=e.previousSearchPage-1));if(e.gallery.images=[].concat(p(e.gallery.images),p(i)),e.gallery.message="",!(i.length<100)){e.gallery.message={buttonText:"load_more",buttonAction:function(){return e.loadResults(t+1)}}}}))},this.openModal=function(t){BeFunky.openUserPhotoModal(t,e.gallery.images,"gallery/"+e.userNickName+"/",!0)},this.closeModal=function(){BeFunky.closeUserPhotoModal()},this.getImagesPerRow=function(){var t=e.gallery.offsetWidth;return t<1200?Math.round(Math.max(2,5*t/1200)):5},this.handleGalleryResize=function(){window.isFlashOpenned||(e.gallery.imagesPerRow=e.getImagesPerRow())},this.init()}BeFunky.onDocumentReady(function(){var e=[document.getElementById("bfn-app"),document.getElementById("modal_root"),document.getElementById("site_root")].filter(Boolean);document.addEventListener("keydown",function(t){!function(t){if("Tab"!==t.key&&9!==t.keyCode)return;if(!e.some(function(e){return e.contains(t.target)}))return;if(t.preventDefault(),BeFunky.isPointerDown)return;BeFunky.handleNextFocus(t.target,t.shiftKey?-1:1)}(t)}),BeFunky.handleNextFocus=function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n=parseInt(n),isNaN(n)&&(n=1);var i=t.closestParent(function(t){return e.includes(t)||t.matches(eo)});if(!(!i||e.includes(i)&&"site_root"!==i.id||i.matches(to))){var a=yt(i);[].concat(p(i.querySelectorAll(to))).forEach(function(e){a=a.filter(function(n){return!e.contains(n)||n===t})});var r=a.indexOf(t);if(0!==a.length&&(1!==a.length||i!==a[0]||0===n)){var s=(r+=n)<0||r>a.length-1;if(s&&"function"==typeof i.exitFocusTrap)return i.exitFocusTrap(n);s&&(r=r<0?a.length-1:0),function e(t,n,o){if(!t)return;if("function"==typeof t.delegateFocus)return e(t.delegateFocus(n),n,o);if(!t.focus)return;if(t===document.activeElement)return;o&&function(e){if(e.hasClass("button"))return void no(e,function(){return e.addClass("button--focus")},function(){return e.removeClass("button--focus")});"A"===e.nodeName&&no(e,function(){return e.addClass("link--focus")},function(){return e.removeClass("link--focus")});if("INPUT"!==e.nodeName)return;if("checkbox"===e.type){var t=e.parentElement;if(t&&t.hasClass("checkbox"))return void no(e,function(){return t.addClass("checkbox--focus")},function(){return t.removeClass("checkbox--focus")});var n=e.nextElementSibling;return void(n&&n.hasClass("button--toggle")&&no(e,function(){return n.addClass("button--focus")},function(){return n.removeClass("button--focus")}))}if("radio"===e.type){var o=e.parentElement;if(!o)return;o.hasClass("toggle-group__label")?no(e,function(){return o.addClass("toggle-group__label--focus-within")},function(){return o.removeClass("toggle-group__label--focus-within")}):o.hasClass("radio-button")&&no(e,function(){return o.addClass("radio-button--focus-within")},function(){return o.removeClass("radio-button--focus-within")})}}(t);t.focus();"input"===t.tagName.toLowerCase()&&t.select()}(a[r],n,o)}}}}),BeFunky.onDocumentReady(function(){if(window.prismicButtonActions.length){var e=window.prismicButtonActions[window.prismicButtonActions.length-1],t=e.action,n=e.time,o=Date.now()-n;o<2e3?(console.log('Handling Prismic button action "'+t+'" that occurred '+o+"ms before befunky.core.js loaded or document was ready:"),oo(t)):BeFunky.logError('Prismic button action "'+t+'" ignored b/c it occurred '+o+"ms before befunky.core.js loaded or document was ready")}window.onClickPrismicButton=function(e){oo(e)}}),BeFunky.onDocumentReady(function(){var e,t,n,o;e=Array.from(document.querySelectorAll(".comparison")),t=BeFunky.isIOS||BeFunky.isAndroid,n=t?"touchmove":BeFunky.pointermove,o=window.innerHeight,e.forEach(function(e){var i=e.getBoundingClientRect(),a=e.querySelector(".comparison__image-before-container"),r=e.querySelector(".comparison__handle"),s=Date.now(),l=0,u=!1,c=void 0,d=!1,p=function(t){e.toggleClass("comparison--show-text",t)},g=BeFunky.debounce(function(e){var t=100*e/i.width;a.setStyles({width:t+"%"})},300),h=function(e){var t=e.pageX>=0?e.pageX:e.touches[0].pageX;e.preventDefault&&i.height<o/2&&e.preventDefault();var n=i.width,d=Math.max(0,Math.min(n,t-i.x)),p=d-i.width/2,h=Math.abs(d-l);l=d;var m=Date.now(),f=m-s;function y(){a.setStyles({width:d+"px"}),r.setStyles({transform:"translateX("+p+"px)"}),g(d)}s=m,h>50&&f>50?(u||(u=!0,cancelAnimationFrame(c),a.setStyles({transition:""}),r.setStyles({transition:""})),c=requestAnimationFrame(y)):(u&&(u=!1,cancelAnimationFrame(c),a.setStyles({transition:"none"}),r.setStyles({transition:"none"})),y())},m=function(t){d||(d=!0,h(t),p(!0),e.addEventListener(n,h))},f=function(){d&&(d=!1,p(!1),e.removeEventListener(n,h))};t?(e.addEventListener("touchstart",m),e.addEventListener("touchend",f)):(e.addEventListener(BeFunky.pointerdown,m),e.addEventListener(BeFunky.pointerover,function(e){BeFunky&&BeFunky.isPointerDown&&m(e)}),e.addEventListener(BeFunky.pointerup,f),e.addEventListener(BeFunky.pointerout,f)),window.addEventListener("resize",BeFunky.debounce(function(){i=e.getBoundingClientRect(),o=window.innerHeight;var t=parseFloat(a.style.width)/100*i.width;isNaN(t)||h({pageX:i.x+t})},300))})}),BeFunky.imageGallery=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.imagesPerRow,o=void 0===n?5:n,a=t.gutterWidth,r=void 0===a?12:a,s=t.minAspectRatio,l=void 0===s?.75:s,u=t.startNewRowCondition,c=t.imageSelectionHandler,d=t.isSelected,g=t.isGraphic,h=t.tooltipHandler,m=t.extendItem;return function(){this.innerHTML='\n        <div class="image-gallery__images" style="padding: '+r/2+'px"></div>\n        <div class="image-gallery__message"></div>\n        <div class="image-gallery__empty-state"></div>\n    ',this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this._message=void 0,this._emptyState="",this._images=[],this.imagesPerRow=this._imagesPerRow=o,this.imageIDRowIndexes=[],this.imagesContainer=this.querySelector(".image-gallery__images"),this.messageContainer=this.querySelector(".image-gallery__message"),this.emptyStateContainer=this.querySelector(".image-gallery__empty-state"),this.imagesContainer.addEventListener("click",this.handleItemClick),this.loadingElements=document.createElement("div").addClass("image-gallery__loading");var e=document.createElement("div").addClass("loading-spinner"),t=document.createElement("string");t.textContent="Loading...",this.loadingElements.appendChild(e),this.loadingElements.appendChild(t),this.loadingContainer=null,this.staggerLoading=!0},this.displayImages=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.staggerLoading,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.images||!this.images.length)return this.imageIDRowIndexes=[],void(this.imagesContainer.innerHTML="");var o=n?0:this.getFirstOutdatedRowIndex();[].concat(p(this.imagesContainer.children)).filter(function(e,t){return t>=o}).forEach(function(t){return e.imagesContainer.removeChild(t)});var i=this.imageIDRowIndexes.findIndex(function(e){return e.rowIndex===o});-1===i&&(i=0);var a=this.images.slice(i);this.imageIDRowIndexes=this.imageIDRowIndexes.filter(function(e){return e.rowIndex<o});var s=document.createDocumentFragment(),f=[],y=void 0,v=o-1,_=function(){(y=document.createElement("div").addClass("image-gallery__row")).aspectRatioSum=0,y.imageAspectRatios=[],s.appendChild(y),f.push(y),v++};if("function"!=typeof u&&(u=function(e,t){return Math.abs(e-t)>Math.abs(e)}),_(),a.forEach(function(t){var n=e._imagesPerRow-y.aspectRatioSum,o=t.thumbWidth&&t.thumbHeight?Math.max(l,t.thumbWidth/t.thumbHeight):1;u(n,o,y.imageAspectRatios)&&_();var i=document.createElement("div").addClass("image-gallery__item").setStyles({margin:r/2+"px"});BeFunky.imageGalleryItem(i,t,{imageSelectionHandler:c,isSelected:d,isGraphic:g,tooltipHandler:h,extendItem:m}),function(t,n,o){y.appendChild(t),y.aspectRatioSum+=n,y.imageAspectRatios.push(n),e.imageIDRowIndexes.push({id:o,rowIndex:v})}(i,o,t.id)}),f.length){var k=f[f.length-1],b=Math.abs(this._imagesPerRow-k.aspectRatioSum);if(b>.6){var w=document.createElement("div").addClass("image-gallery__item");w.setStyles({flex:b,paddingLeft:Math.round(b-1)*r+"px",margin:r/2+"px"}),k.appendChild(w)}}f.forEach(function(e,n){function o(){[].concat(p(e.children)).forEach(function(e){return e.loadImage&&e.loadImage()})}t&&0!==n?setTimeout(o,30*n):o()}),this.imagesContainer.appendChild(s)},this.getFirstOutdatedRowIndex=function(){for(var e=void 0,t=0;t<this.images.length;t++){var n=this.images[t].id;if(!this.imageIDRowIndexes[t]){e=0===t?0:this.imageIDRowIndexes[t-1].rowIndex;break}if(n!==this.imageIDRowIndexes[t].id){e=this.imageIDRowIndexes[t].rowIndex;break}}return void 0===e&&(e=this.imageIDRowIndexes[this.images.length-1].rowIndex),e},this.handleItemClick=function(e){var t=e.target.parentElement;t&&t.hasClass&&t.hasClass("image-gallery__item")&&(t.selected=!t.selected)},Object.defineProperty(this,"emptyState",{set:function(e){if(this.emptyStateContainer.innerHTML="",e){if("object"!==(void 0===e?"undefined":i(e)))throw"Image Gallery emptyState must be an object";if(this._emptyState=Object.assign({},e),e.icon&&(this.emptyStateContainer.innerHTML='\n                    <svg class="icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+e.icon+'"></use></svg>'),e.text){var t=document.createElement("string").setLang(e.text);this.emptyStateContainer.appendChild(t)}if(e.buttonText&&e.buttonAction){var n=document.createElement("button").setClass("button button--blue").setLang(e.buttonText);n.addEventListener("click",e.buttonAction),this.emptyStateContainer.appendChild(n)}}else this._emptyState=void 0},get:function(){return this._emptyState}}),Object.defineProperty(this,"message",{set:function(e){if(this.messageContainer.innerHTML="",e){if("object"!==(void 0===e?"undefined":i(e)))throw"Image Gallery message must be an object";this._message=Object.assign({},e);var t=!0===e.isError;if(this.messageContainer.toggleClass("image-gallery__message--is-error",t),e.text){var n=document.createElement("string").setLang(e.text);this.messageContainer.appendChild(n)}if(e.buttonText&&e.buttonAction){var o=document.createElement("button").setClass("button "+(t?"button--small button--white":"button--grey")).setLang(e.buttonText);o.addEventListener("click",e.buttonAction),this.messageContainer.appendChild(o)}}else this._message=void 0},get:function(){return this._message}}),Object.defineProperty(this,"isLoading",{set:function(e){if(this._isLoading!==e){if("boolean"!=typeof e)throw"isLoading must be a boolean";this._isLoading=e,e?(this.loadingContainer=this.images.length?this.messageContainer:this.emptyStateContainer,this.loadingContainer.innerHTML="",this.loadingContainer.removeClass("image-gallery__message--is-error"),this.loadingContainer.appendChild(this.loadingElements.cloneNode(!0))):this.loadingContainer===this.messageContainer?this.message=this._message:this.loadingContainer===this.emptyStateContainer&&(this.emptyState=this._emptyState)}},get:function(){return this._isLoading}}),Object.defineProperty(this,"images",{set:function(e){if(this._images!==e){if(!Array.isArray(e))throw"images must be an Array";this._images=e,this.displayImages()}},get:function(){return this._images}}),Object.defineProperty(this,"imagesPerRow",{set:function(e){if(this._imagesPerRow!==e){if("number"!=typeof e)throw"imagesPerRow must be a number";this._imagesPerRow=e,this.displayImages(!1,!0)}},get:function(){return this._imagesPerRow}}),this.init()}.bind(e)()},BeFunky.imageGalleryItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.imageSelectionHandler,i=n.isSelected,a=void 0===i?function(){return!1}:i,r=n.isGraphic,s=void 0!==r&&r,l=n.tooltipHandler,u=n.extendItem;return function(){var n=this,i=t.id,r=t.isTransparent,c=void 0!==r&&r;this.id="image_gallery_item--"+i,this.init=function(){this.initDefaultValues(),this.initImagePlaceholder(),"function"==typeof u&&u(e,t)},this.initDefaultValues=function(){this._selected=a(t.id),this.selected=this._selected,this.toggleClass("image-gallery__item--selected",this._selected),this.imagePlaceholder=document.createElement("div"),"function"==typeof l&&(this.dataset.bfntooltip=l(t))},this.initImagePlaceholder=function(){var e=t.thumbWidth,n=t.thumbHeight,o=e&&n?e/n:1;this.setStyles({flex:o}),this.addClass("image-gallery__item--"+(o>=1?"wide":"narrow")),this.imagePlaceholder.addClass("image-gallery__placeholder").setStyles({paddingBottom:100/o+"%"}),this.appendChild(this.imagePlaceholder);var i=document.createElement("div").addClass("image-gallery__item-outline");i.innerHTML='\n            <svg class="icon icon-selected">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#global-apply-icon"></use>\n            </svg>',this.appendChild(i)},this.loadImage=function(){if(t.svgPlaceholder){if(!t.thumbURL)return void(n.imagePlaceholder.innerHTML='<svg class="icon">\n                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+t.svgPlaceholder+'"></use>\n                </svg>');n.imagePlaceholder.innerHTML=""}var e="",o="";s?(e="url('"+t.thumbURL+"') no-repeat center",o="contain",n.graphicPlaceholder=document.createElement("div").addClass("image-gallery__graphic"),n.imagePlaceholder.appendChild(n.graphicPlaceholder)):(e="url('"+t.thumbURL+"') no-repeat center",o="cover",c&&(e+=", url('"+BeFunky.Params.globalImagesPath+"app/checker_pattern.jpg') repeat",o+=", auto"));var i=new Image;i.onload=function(){s?n.graphicPlaceholder.setStyles({background:e,backgroundSize:o}):n.imagePlaceholder.setStyles({background:e,backgroundSize:o})},i.onerror=function(){n.hasRetried?BeFunky.logError("Failed to load thumbnail for a second time"):(n.hasRetried=!0,BeFunky.logError("Failed to load thumbnail. Trying again in 3 seconds..."),setTimeout(n.loadImage.bind(n),3e3))},i.src=t.thumbURL},Object.defineProperty(this,"selected",{set:function(e){e!==this._selected&&o(t,e)&&(this._selected=e,this.toggleClass("image-gallery__item--selected",e))},get:function(){return this._selected}}),this.init()}.bind(e)()},BeFunky.explorePage={search:function(){BeFunky.throwError("Explore page not available")},openImage:function(){BeFunky.throwError("Explore page not available")},isAvailable:!1},BeFunky.onDocumentReady(function(){var e=document.getElementById("explore");e&&ao.call(e)}),BeFunky.galleryPage={openImage:function(){BeFunky.throwError("Gallery page not available")},isAvailable:!1},BeFunky.onDocumentReady(function(){var e=document.getElementById("user_gallery");e&&ro.call(e)});var so=window.deferredPromise();function lo(){var e=this;this.init=function(){this.initDefaultValues(),this.initPublicAPI(),this.initMenuItems(),this.initGallery(),this.initSearchForm(),this.initEditTitle()},this.initDefaultValues=function(){this.supportsTouch="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},this.initPublicAPI=function(){var e=this;BeFunky.myPhotosPage.isAvailable=!0,BeFunky.myPhotosPage.openImage=function(t){if(!t)return e.closeModal();var n=e.gallery.images.find(function(e){return e.id==="befunky_photo_"+t});n?e.openModal(n):BeFunky.logError("Unable to open Gallery image",{imageID:t})},BeFunky.myPhotosPage.selectFilter=function(t){e.closeModal(),t!==e.previousFilter&&e.loadResults("",t)}},this.initMenuItems=function(){var e=this;this.menuItems={editTitle:{domId:"edit_title_form",title:function(){return"title"},onClick:function(e,t){var n=document.getElementById("edit_title_modal"),o=n.querySelector("input[name=imgId]"),i=t.id.replace("befunky_photo_","");o.value=""+i+t.key,n.querySelector("input[name=title]").value=t.title,BeFunky.openModal("edit_title_modal",{size:"small",addCloseButton:!0})}},openInApp:{title:function(){return"editor"},onClick:function(e,t){BeFunky.myPhotosPage.imageToEdit=t.imageURL,BeFunky.isUseHTML5||BeFunky.Params.isFlashPlayerCorrect?BeFunky.pushRoute("create"):BeFunky.pushRoute("create/?openurl="+encodeURIComponent(t.imageURL))}},publicPrivate:{title:function(e){return!0===e.isPublic?"set_to_private":"set_to_public"},onClick:function(t,n){t.target.disabled=!0,function(e,t){var n=e.isPublic,o=e.key,i=e.id;if((null!=BeFunky.User.isMailVerified?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified)||n){var a=i.replace("befunky_photo_",""),r={imgId:a+o,isPublic:n?"0":"1"};BeFunky.requestAPI("photo/update-image-info/",r).then(function(o){if("success"!==o.data||"1"!==o.message)throw"invalid_response";var a=!n;e.isPublic=a,t({isPublic:a,id:i})}).catch(function(e){t({error:e})})}else BeFunky.confirm("photos_public_verify_email",{confirmText:"send_verification_email",onConfirm:BeFunky.sendVerificationEmail}),t({error:"email_not_verified"})}(n,function(n){var o=n.error,i=n.isPublic,a=n.id;if(t.target.disabled=!1,o)BeFunky.logError("Unable to change photo status",o);else{var r=document.querySelector("#image_gallery_item--"+a+" .image-gallery__edit-options .my-photos__item-3");if(!0===i?r.setLang("set_to_private"):r.setLang("set_to_public"),"public"===e.previousFilter||"private"===e.previousFilter){var s=document.getElementById("image_gallery_item--"+a);s.parentElement.removeChild(s),e.gallery.images=e.gallery.images.filter(function(e){return e.id!==a})}}})}},deleteImage:{title:function(){return"trash"},onClick:function(t,n){BeFunky.confirm("delete_this_photo",{onConfirm:function(){!function(e,t){var n=e.id,o=e.key,i={imgIds:""+(n.replace("befunky_photo_","")+o)};BeFunky.requestAPI("photo/delete-image/",i).then(function(e){if("success"!==e.data||"1"!==e.message)throw"invalid_response";t({id:n})}).catch(function(e){return t({error:e})})}(n,function(t){var n=t.error,o=t.id;if(n)BeFunky.logError("Unable to delete photo",n);else{var i=document.getElementById("image_gallery_item--"+o);i.parentElement.removeChild(i),e.gallery.images=e.gallery.images.filter(function(e){return e.id!==o})}})}})}}}},this.initGallery=function(){var e=this;this.gallery=this.querySelector(".my-photos__gallery");BeFunky.imageGallery(this.gallery,{imagesPerRow:this.getImagesPerRow(),imageSelectionHandler:function(t){return e.openModal(t),!1},extendItem:this.addPhotoOptions,gutterWidth:16}),this.gallery.addClass("image-gallery--use-borders"),window.addEventListener("resize",BeFunky.debounce(function(){return e.handleGalleryResize()},300))},this.initSearchForm=function(){var e=this;this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.validFilters=["all","public","private"],this.filterButtons=this.validFilters.reduce(function(t,n){var o=document.getElementById("my_photos_filter_"+n);return t[n]=o,o.addEventListener("click",function(){return e.loadResults("",n)}),t},{}),this.previousSearchQuery=null,this.previousFilter=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",function(){e.loadResults("",e.previousFilter),e.searchInput.focus()}),this.searchForm.addEventListener("submit",this.handleSearch)},this.initEditTitle=function(){var e=this,t=this.menuItems.editTitle.domId,n=document.getElementById(t);n.addEventListener("submit",function(t){t.preventDefault(),function(e,t){var n=e.querySelector('input[name="title"]').value,o=e.querySelector('input[name="imgId"]').value,i=n.match(/#(\w+)/gi);i=null!=i?i.join().replace(/#/g,""):"";var a={imgId:o,title:n,tags:i};BeFunky.requestAPI("photo/update-image-info",a,{showLoadScreen:!0}).then(function(e){if("success"!==e.data||"1"!==e.message)throw"invalid_response";t({imageId:o.substring(0,o.length-1),title:e.title})}).catch(function(e){t({error:e})})}(n,function(t){var n=t.error,o=t.imageId,i=t.title;if(n){BeFunky.logError("Unable to set title on photo",n);var a=BeFunky.failureReason(n);$t.displayError("#edit_title_modal",a)}else{e.gallery.images.find(function(e){return e.id==="befunky_photo_"+o}).title=i,BeFunky.closeModal("edit_title_modal")}})})},this.loadResults=function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!(this.previousSearchQuery===e&&this.previousFilter===t&&o<=this.previousSearchPage))if(this.validFilters.includes(t)){this.searchInput.value=e;var i=this.filterButtons[t];Object.values(this.filterButtons).forEach(function(e){e.toggleClass("my-photos__filter--active",e===i)}),console.log("Loading results...",{searchQuery:e,filter:t,page:o}),this.previousSearchQuery=e,this.previousFilter=t,this.previousSearchPage=o,BeFunky.pushRoute("all"===t?"myphotos/":"myphotos/"+t+"/"),1===o&&(this.gallery.images=[],this.gallery.scrollTop=0),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments[3],i={start:100*(n-1),end:100};e?i.keyword=e:i.type=t;BeFunky.requestAPI("photo/me/",i).then(function(e){if(!Array.isArray(e.data))throw"invalid_response";if(!e.data.length)throw"no_results";var t=e.data.map(function(e){return{id:"befunky_photo_"+e.id,key:e.key,thumbWidth:200,thumbHeight:200,thumbURL:e.thumb_url,imageURL:e.url,isPublic:"1"===e.isPublic,nick:e.nick,title:e.title,dateCreated:e.dateCreated}});return o({images:t})}).catch(function(e){o({error:e})})}(e,t,o,function(i){var a=i.error,r=i.images;if(e===n.previousSearchQuery&&t===n.previousFilter){if(n.gallery.isLoading=!1,n.toggleInteractivity(!0),a)return BeFunky.logError("Unable to fetch images",a),void("no_results"===a?(n.gallery.message="",n.gallery.emptyState={icon:"no-results-icon",text:e?BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:'"<strong>'+e+'</strong>"'}):"error_no_results"}):(n.gallery.message={isError:!0,text:BeFunky.failureReason(a),buttonText:"try_again",buttonAction:function(){return n.loadResults(e,t,o)}},n.gallery.emptyState="",n.previousSearchPage=n.previousSearchPage-1));if(n.gallery.images=[].concat(p(n.gallery.images),p(r)),n.gallery.message="",!(r.length<100)){n.gallery.message={buttonText:"load_more",buttonAction:function(){return n.loadResults(e,t,o+1)}}}}})}else BeFunky.logError("Invalid MyPhotos filter",{filter:t})},this.createEllipsis=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.createElement("div").setClass("image-gallery__edit-button");t&&n.addClass("image-gallery__edit-button--always-show");var o=document.createElement("div").setClass("image-gallery__edit-ellipsis");o.appendChild(document.createElement("div")),o.appendChild(document.createElement("div")),o.appendChild(document.createElement("div")),n.appendChild(o);var i=document.createElement("div");i.setClass("image-gallery__edit-options"),e.appendChild(n),e.appendChild(i);var a=!1;function r(t){e.contains(t.target)||function(){if(!a)return;a=!1,i.removeClass("image-gallery__edit-options--visible"),document.removeEventListener("touchstart",r),document.removeEventListener("mouseover",r)}()}n.addEventListener("click",function(){if(a)return;a=!0,i.addClass("image-gallery__edit-options--visible"),document.addEventListener("touchstart",r),document.addEventListener("mouseover",r)})},this.addPhotoOptions=function(t,n){t.addClass("image-gallery__item--has-button"),e.createEllipsis(t,e.supportsTouch);var o=t.querySelector(".image-gallery__edit-options");Object.keys(e.menuItems).forEach(function(t,i){var a=document.createElement("button");a.setClass("button button--list image-gallery__edit-option my-photos__item-"+(i+1)),a.addEventListener("click",function(o){e.menuItems[t].onClick(o,n)}),a.setLang(e.menuItems[t].title(n)),o.appendChild(a)})},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e,Object.values(this.filterButtons).forEach(function(t){return t.disabled=!e})},this.openModal=function(t){var n="all"===e.previousFilter?"myphotos/":"myphotos/"+e.previousFilter+"/";BeFunky.openUserPhotoModal(t,e.gallery.images,n,!1)},this.closeModal=function(){BeFunky.closeUserPhotoModal()},this.getImagesPerRow=function(){var t=e.gallery.offsetWidth;return t<1200?Math.round(Math.max(2,5*t/1200)):5},this.handleSearch=function(t){t&&t.preventDefault();var n=e.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();e.searchInput.value=n,e.loadResults(n,"all")},this.handleGalleryResize=function(){window.isFlashOpenned||(e.gallery.imagesPerRow=e.getImagesPerRow())},window.initialUserStatus.then(function(){BeFunky.isLoggedIn()?(e.init(),so.resolve(!0)):window.location.href=BeFunky.Params.siteUrl+"sign-in/?next="+encodeURIComponent(window.location.href)})}BeFunky.myPhotosPage={openImage:function(e){so.then(function(t){t?BeFunky.myPhotosPage.openImage(e):BeFunky.throwError("MyPhotos page not available")})},selectFilter:function(e){so.then(function(t){t?BeFunky.myPhotosPage.selectFilter(e):BeFunky.throwError("MyPhotos page not available")})},imageToEdit:"",isAvailable:!1},BeFunky.onDocumentReady(function(){var e=document.getElementById("my_photos");e?lo.call(e):so.resolve(!1)});var uo=d(['\n        <div class="section__text section__text--centered">\n            <div class="loading-spinner"></div>\n        </div>\n        '],['\n        <div class="section__text section__text--centered">\n            <div class="loading-spinner"></div>\n        </div>\n        ']),co=d(['\n        <div class="section__text section__text--centered">\n            <h1 class="close-account__heading h2">',"</h1>\n        </div>\n        "],['\n        <div class="section__text section__text--centered">\n            <h1 class="close-account__heading h2">',"</h1>\n        </div>\n        "]),po=d(['\n        <div class="modal user-photo">\n            <figure>\n                <div class="image-box user-photo__image-box">\n                    <img src="','" class="image-box__image user-photo__image" alt="" />\n                </div>\n                <figcaption class="user-photo__footer">\n                    <div class="user-photo__caption">\n                        <h4 class="user-photo__title">','</h4>\n                        <p class="user-photo__author">by <a href="',"gallery/",'/">','</a></p>\n                    </div>\n                    <button class="user-photo__report-abuse button button--small button--link" @click=',">","</button>\n                </figcaption>\n            </figure>\n        </div>\n        "],['\n        <div class="modal user-photo">\n            <figure>\n                <div class="image-box user-photo__image-box">\n                    <img src="','" class="image-box__image user-photo__image" alt="" />\n                </div>\n                <figcaption class="user-photo__footer">\n                    <div class="user-photo__caption">\n                        <h4 class="user-photo__title">','</h4>\n                        <p class="user-photo__author">by <a href="',"gallery/",'/">','</a></p>\n                    </div>\n                    <button class="user-photo__report-abuse button button--small button--link" @click=',">","</button>\n                </figcaption>\n            </figure>\n        </div>\n        "]),go=BeFunky.lit,ho=go.html,mo=go.setupState,fo=go.render,yo=go.lang;function vo(e){var t,n,o=BeFunky.debounce(function(){return fo(function(){if(r.imageNotFound)return ho(co,u("image_not_found"));return r.isLoading?ho(uo):ho(po,r.imageSrc,r.imageTitle,BeFunky.Params.siteUrl,r.imageUser,r.imageUser,l,u("report_abuse"))}(),e)},"raf"),i=mo({canonicalUrl:"",imageTitle:"",imageTitleFallBack:"",imageUser:"",imageDate:"",imageSrc:"",isLoading:!0,imageId:""},o),a=c(i,2),r=a[0],s=a[1];function l(){BeFunky.reportAbuse(r.imageId)}function u(e){return yo(e,"site")}t=window.location.href.match(/gallery\/([0-9]+)/)[1],n={img_key:t},BeFunky.requestAPI("photo/get-image-data",n).then(function(e){var n,o;n=e.data,o=t,s({imageTitle:n.imageTitle,imageTitleFallBack:n.imageTitleFallback,imageUser:n.byUser,imageDate:n.imageCreationDate,imageSrc:n.ogImage,isLoading:!1,imageId:o}),function(e){var t=e.canonical,n=e.metaDescription,o=e.ogDescription,i=e.ogTitle,a=e.pageTitle;document.querySelector('link[rel="canonical"]').href=t,document.title=a,document.querySelector("meta[name=description]").setAttribute("content",n),document.querySelector('meta[property="og:description"]').setAttribute("content",o),document.querySelector('meta[property="og:title"]').setAttribute("content",i)}(e.data)}).catch(function(e){"redirect_to_my_photos"!==e?"redirect_to_explore"!==e?"request_failed"!==e&&(s({imageNotFound:!0}),BeFunky.throwError("Error when trying to display single image",e)):window.location.href=BeFunky.Params.siteUrl+"explore/":window.location.href=BeFunky.Params.siteUrl+"myphotos/"}),BeFunky.singleImagePage={openImage:function(){},isAvailable:!0}}BeFunky.singleImagePage={openImage:function(){BeFunky.throwError("Single Image page not available")},isAvailable:!1},BeFunky.onDocumentReady(function(){document.getElementById("explore_single_image")&&vo(document.getElementById("explore_single_image_template_container"))});var _o=d([""],[""]),ko=d(['\n        <h3 class="h5">',"</h3>\n        <form class="," @submit=",">\n            ","\n            ","\n            ",'\n            <button class="button button--blue button--x-large" type="submit">',"</button>\n        </form>\n        "],['\n        <h3 class="h5">',"</h3>\n        <form class="," @submit=",">\n            ","\n            ","\n            ",'\n            <button class="button button--blue button--x-large" type="submit">',"</button>\n        </form>\n        "]),bo=d(['\n                <p class="form-modal__notification">',"</p>\n            "],['\n                <p class="form-modal__notification">',"</p>\n            "]),wo=d(['\n                <div class="form-errors">\n                    <div class="form-errors__container">\n                    ',"\n                    </div>\n                    <button @click=",' type="button" class="button button--circle button--outline button--white button--icon button--tiny form-errors__close-button">\n                        ',"\n                    </button>\n                </div>                    \n            "],['\n                <div class="form-errors">\n                    <div class="form-errors__container">\n                    ',"\n                    </div>\n                    <button @click=",' type="button" class="button button--circle button--outline button--white button--icon button--tiny form-errors__close-button">\n                        ',"\n                    </button>\n                </div>                    \n            "]),Fo=d(["<div>","</div>"],["<div>","</div>"]),Bo=d(['\n                    <input\n                        class="','"\n                        id=',"\n                        name=","\n                        type=","\n                        maxLength=","\n                        required\n                        @change=","\n                        @keyup=","\n                        @blur=","\n                    >\n                "],['\n                    <input\n                        class="','"\n                        id=',"\n                        name=","\n                        type=","\n                        maxLength=","\n                        required\n                        @change=","\n                        @keyup=","\n                        @blur=","\n                    >\n                "]),Eo=d(['\n                    <input \n                        class="','" \n                        id='," \n                        name="," \n                        type="," \n                        maxLength="," \n                        required\n                    >\n                "],['\n                    <input \n                        class="','" \n                        id='," \n                        name="," \n                        type="," \n                        maxLength="," \n                        required\n                    >\n                "]),So=d(['\n                    <div class="material-field">\n                        ','\n                        <p class="material-field__error">','</p>\n                        <label class="material-field__label" for=',">","</label>\n                    </div>\n                "],['\n                    <div class="material-field">\n                        ','\n                        <p class="material-field__error">','</p>\n                        <label class="material-field__label" for=',">","</label>\n                    </div>\n                "]),Io=BeFunky.lit,Co=Io.html,Lo=Io.setupState,Po=Io.render,xo=Io.lang,Ao=Io.icon;function To(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).formClass,o=void 0===n?"form-modal__form":n,i={title:"test",notification:"",button:"submit",context:"site",fields:[{name:"test",label:"label",maxLength:100,errorMessage:"error_message",isValid:!0,type:"text",sanitize:function(e){return e},validate:function(){return!0}}],onSubmit:console.log,submissionErrors:[]};t=Object.assign(i,t);var a=!1,r=BeFunky.debounce(function(){Po(Co(ko,xo(u.title,u.context),o,h,u.notification?Co(bo,xo(u.notification,u.context)):"",u.submissionErrors.length?Co(wo,u.submissionErrors.map(function(e){return Co(Fo,xo(e,u.context))}),g,Ao("global-cancel-icon","icon icon-size-tiny")):"",u.fields.map(function(e){var t=e.name,n=e.label,o=e.type,i=void 0===o?"text":o,a=e.errorMessage,r=void 0===a?"":a,s=e.maxLength,l=e.isValid,c=e.sanitize,d=void 0;"function"==typeof c&&(d=BeFunky.debounce(function(e){e.target.value=c(e.target.value)},100));var p=d?Co(Bo,"material-field__input "+(!1===l?"material-field__input--invalid":""),m(t),t,i,s,d,d,d):Co(Eo,"material-field__input "+(!1===l?"material-field__input--invalid":""),m(t),t,i,s);return Co(So,p,xo(r,u.context),m(t),xo(n,u.context))}),xo(u.button,u.context)),e),a||(a=!0,function(e){for(var t=e.querySelectorAll("input"),n=0;n<t.length;n++)if(t[n].offsetParent){t[n].focus();break}}(e))},"raf"),s=Lo(t,r),l=c(s,2),u=l[0],d=l[1];BeFunky.LanguageManager.addLanguageUpdateListener(r);var p=Math.floor(1e6*Math.random());return{teardown:function(){return Po(Co(_o),e)},setFormState:d};function g(){d({submissionErrors:[]})}function h(e){e.preventDefault();var t=u.fields.map(function(e){return e.name}).reduce(function(e,t){return e[t]=document.getElementById(m(t)).value,e},{}),n=u.fields.map(function(e){var n="function"!=typeof e.validate||e.validate(t[e.name],t);return Object.assign({},e,{isValid:n})});d({fields:n}),n.every(function(e){return e.isValid})&&u.onSubmit(t)}function m(e){return"input_"+p+"_"+e.replace(/^[^a-z]+|[^\w:.-]+/gi,"")}}var Ro=d(['\n        <h1 class="my-account__title h2">','</h1>\n        \n        <div class="','">\n        \n            <h2 class="my-account__heading body-font">','</h2>\n            <div class="my-account__row my-account__row--username">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">',"</span>\n                ",'\n            </div>\n            <div class="my-account__row my-account__row--email">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">',"</span>\n                <button @click=",' class="button button--link my-account__button">','</button>\n            </div>\n            <div class="my-account__row my-account__row--password">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">••••••••••••</span>\n                <button @click=',' class="button button--link my-account__button">','</button>\n            </div>\n        </div>\n        \n        <div class="','">\n            <h2 class="my-account__heading body-font">','</h2>\n            <div class="my-account__row subscription-row">\n            ',"\n            </div>\n        \n            ",'\n            </div>\n            \n            <div class="','">\n                <h2 class="my-account__heading body-font">','</h2>\n                <div id="account_newsletter_subscription" class="my-account__row my-account__row--email-notifications">\n                    <span>',"</span>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n            </div>\n            \n            <div class="','">\n                ',"\n            </div>\n            \n        </div>\n        "],['\n        <h1 class="my-account__title h2">','</h1>\n        \n        <div class="','">\n        \n            <h2 class="my-account__heading body-font">','</h2>\n            <div class="my-account__row my-account__row--username">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">',"</span>\n                ",'\n            </div>\n            <div class="my-account__row my-account__row--email">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">',"</span>\n                <button @click=",' class="button button--link my-account__button">','</button>\n            </div>\n            <div class="my-account__row my-account__row--password">\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">••••••••••••</span>\n                <button @click=',' class="button button--link my-account__button">','</button>\n            </div>\n        </div>\n        \n        <div class="','">\n            <h2 class="my-account__heading body-font">','</h2>\n            <div class="my-account__row subscription-row">\n            ',"\n            </div>\n        \n            ",'\n            </div>\n            \n            <div class="','">\n                <h2 class="my-account__heading body-font">','</h2>\n                <div id="account_newsletter_subscription" class="my-account__row my-account__row--email-notifications">\n                    <span>',"</span>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n            </div>\n            \n            <div class="','">\n                ',"\n            </div>\n            \n        </div>\n        "]),Mo=d(["<button @click=",' class="button button--link my-account__button">',"</button>"],["<button @click=",' class="button button--link my-account__button">',"</button>"]),Do=d(["\n                <span>\n                    <string>","</string>\n                    <br>\n                    <string>","</string>\n                </span>\n                <button @click=",' class="button button--link my-account__button">',"</button>            \n            "],["\n                <span>\n                    <string>","</string>\n                    <br>\n                    <string>","</string>\n                </span>\n                <button @click=",' class="button button--link my-account__button">',"</button>            \n            "]),Uo=d(['\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">BeFunky '," ","</span>\n                ","\n                ","\n            "],['\n                <span class="my-account__label">','</span>\n                <span class="my-account__data">BeFunky '," ","</span>\n                ","\n                ","\n            "]),Oo=d(["<button @click=",' class="button button--dark-blue">',"</button>"],["<button @click=",' class="button button--dark-blue">',"</button>"]),No=d(["<button @click=",' class="button button--dark-blue button--small">',"</button>"],["<button @click=",' class="button button--dark-blue button--small">',"</button>"]),Ho=d(["\n                ",'\n                <div class="my-account__row my-account__row--credit-card">\n                    <span class="my-account__label">','</span>\n                    <div class="my-account__data">',"</div>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n                <div class="my-account__row my-account__row--billing-history">\n                    <span class="my-account__label">',"</span>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n                <div class="my-account__row my-account__row--cancel-subscription">\n                    ',"\n                </div>\n            "],["\n                ",'\n                <div class="my-account__row my-account__row--credit-card">\n                    <span class="my-account__label">','</span>\n                    <div class="my-account__data">',"</div>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n                <div class="my-account__row my-account__row--billing-history">\n                    <span class="my-account__label">',"</span>\n                    <button @click=",' class="button button--link my-account__button">','</button>\n                </div>\n                <div class="my-account__row my-account__row--cancel-subscription">\n                    ',"\n                </div>\n            "]),jo=d(['\n                    <div class="my-account__row">\n                        <span class="my-account__label">','</span>\n                        <span class="my-account__data">',"</span>\n                    </div>\n                "],['\n                    <div class="my-account__row">\n                        <span class="my-account__label">','</span>\n                        <span class="my-account__data">',"</span>\n                    </div>\n                "]),qo=d(["\n                    <button @click=",' class="button button--grey button--small my-account__button">',"</button>\n                    "],["\n                    <button @click=",' class="button button--grey button--small my-account__button">',"</button>\n                    "]),Vo=d(['\n        <p className="my-account__delete-contact-support">',"</p>\n        <p>","</p>\n        ","        \n        "],['\n        <p className="my-account__delete-contact-support">',"</p>\n        <p>","</p>\n        ","        \n        "]),Go=d(["\n            <p>","</p>\n            <a href=",' class="button button--link my-account__button" target="_blank" rel="noopener">',"</a>\n            "],["\n            <p>","</p>\n            <a href=",' class="button button--link my-account__button" target="_blank" rel="noopener">',"</a>\n            "]),Wo=d(["\n            <p>","</p>\n            <button @click=",' class="button button--link my-account__button">',"</button>\n            "],["\n            <p>","</p>\n            <button @click=",' class="button button--link my-account__button">',"</button>\n            "]),zo=d(["<button @click=",' class="button button--link my-account__button my-account__button--delete">',"</button>"],["<button @click=",' class="button button--link my-account__button my-account__button--delete">',"</button>"]),Xo=d(["Card Number: "," <br><string>","</string> ",""],["Card Number: "," <br><string>","</string> ",""]),Jo=d(['\n                <div id="invoices" class="form-modal statement-panel modal">\n                    <h3 data-lang="billing_history" class="h5">Your Billing History</h3>\n                    <ul class="statement-panel__invoice-list">\n                    ',"\n                    </ul>\n                </div>                \n            "],['\n                <div id="invoices" class="form-modal statement-panel modal">\n                    <h3 data-lang="billing_history" class="h5">Your Billing History</h3>\n                    <ul class="statement-panel__invoice-list">\n                    ',"\n                    </ul>\n                </div>                \n            "]),Yo=d(['\n                        <li class="statement-panel__list-item">\n                            <span class="title">','</span>\n                            <button class="button button--link" @click=',">","</button>\n                        </li>\n                    "],['\n                        <li class="statement-panel__list-item">\n                            <span class="title">','</span>\n                            <button class="button button--link" @click=',">","</button>\n                        </li>\n                    "]),$o=d(["\n            <div>\n                <p>","</p>\n                ","\n            </div>\n        "],["\n            <div>\n                <p>","</p>\n                ","\n            </div>\n        "]),Ko=d(["<p>","</p>"],["<p>","</p>"]),Qo=d(["\n            <div>\n                <p>","</p>\n                <p>","</p>\n                <p>","</p>\n            </div>\n        "],["\n            <div>\n                <p>","</p>\n                <p>","</p>\n                <p>","</p>\n            </div>\n        "]),Zo=d(["<div>\n                            <p>","</p>\n                            <p>","</p>\n                        </div>"],["<div>\n                            <p>","</p>\n                            <p>","</p>\n                        </div>"]),ei=d(['\n            <div class="invoice">\n                ',"\n                ","\n                ",'\n            \n                <img src="','site/logo-dark1.svg" alt="BeFunky" style="margin: 0 auto; width: 320px; display: block;">\n                <hr style="border-top: 1px solid #EDEDED; margin: 2rem 0">\n                <h2>Invoice</h2>\n                <p>\n                    <strong>Date:</strong> ',"<br>\n                    ","\n                </p>\n                \n                <br>\n                <h6>Billed To</h6>\n                <p>\n                    ","<br>\n                    ","<br>\n                    **** **** **** ","\n                </p>\n                \n                <br>\n                <h6>Invoice Number</h6>\n                <p>","</p>\n                \n                <br>\n                <h6>Description</h6>\n                <p>\n                    Plan: BeFunky "," ","<br>\n                    Charge: ",'\n                </p>\n \n                <br>\n                <p style="text-align: right"><strong>Total Amount Paid:</strong> ',"</p>\n                \n                ",'\n                <button onclick="window.print()" class="button button--blue print-button">Print</button>\n            </div>\n        '],['\n            <div class="invoice">\n                ',"\n                ","\n                ",'\n            \n                <img src="','site/logo-dark1.svg" alt="BeFunky" style="margin: 0 auto; width: 320px; display: block;">\n                <hr style="border-top: 1px solid #EDEDED; margin: 2rem 0">\n                <h2>Invoice</h2>\n                <p>\n                    <strong>Date:</strong> ',"<br>\n                    ","\n                </p>\n                \n                <br>\n                <h6>Billed To</h6>\n                <p>\n                    ","<br>\n                    ","<br>\n                    **** **** **** ","\n                </p>\n                \n                <br>\n                <h6>Invoice Number</h6>\n                <p>","</p>\n                \n                <br>\n                <h6>Description</h6>\n                <p>\n                    Plan: BeFunky "," ","<br>\n                    Charge: ",'\n                </p>\n \n                <br>\n                <p style="text-align: right"><strong>Total Amount Paid:</strong> ',"</p>\n                \n                ",'\n                <button onclick="window.print()" class="button button--blue print-button">Print</button>\n            </div>\n        ']),ti=d(["<strong>Billing Period:</strong> "," - ",""],["<strong>Billing Period:</strong> "," - ",""]),ni=BeFunky.lit,oi=ni.html,ii=ni.setupState,ai=ni.render,ri=ni.lang,si=ni.elem;function li(e){var t=BeFunky.debounce(function(){return ai(oi(Ro,w("my_account"),"my-account__card "+(i.isLoading?"my-account__card--loading":""),w("my_profile"),w("username"),i.username,i.canChangeUsername?oi(Mo,l,w("change")):"",w("email"),i.email,u,w("change"),w("password"),d,w("change"),"my-account__card "+(i.isLoading?"my-account__card--loading":""),w("my_subscription"),i.hasCancelledSubscription?oi(Do,w("cancelled_subscription"),w(["previous_plan",{next_billing_date:E(i.nextBillingDate)}]),m,w("resubscribe")):oi(Uo,w("plan"),i.packageName,i.billingCycle,i.canUpgrade?oi(Oo,g,w("upgrade")):"","Monthly"!==i.billingCycle||i.isPayPalSubscriber?"":oi(No,h,w("switch_to_annual"))),"Plus"===i.packageName?oi(Ho,i.hasCancelledSubscription?"":oi(jo,w("next_billing_date"),E(i.nextBillingDate)),w("billing_method"),i.paymentInfo,f,w("change"),w("billing_history"),y,w("view"),i.hasCancelledSubscription?"":oi(qo,v,w("cancel_my_subscription"))):"","my-account__card "+(i.isLoading?"my-account__card--loading":""),w("email_notifications"),w("email_notification_settings"),_,w("change"),"my-account__card my-account__card--delete-account "+(i.isLoading?"my-account__card--loading":""),oi(Vo,w(["delete_account_contact_support",{contact_support:'<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank" rel="noopener">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}]),w("delete_account_info"),i.isPayPalSubscriber?oi(Go,w("delete_account_paypal"),S(),w("open_paypal")):i.isEmailVerified?oi(zo,b,w("delete_account")):oi(Wo,w("delete_account_verify_email"),k,w("send_verification_email")))),e)},"raf"),n=ii({email:"",username:"",hasCancelledSubscription:!1,isLoading:!0,isEmailVerified:!1,isPayPalSubscriber:!1,isSocialUser:!0,isEmailSubscriber:!0,canChangeUsername:!0,canUpgrade:!1,billingCycle:"",nextBillingDate:"",packageName:"",paymentInfo:""},t),o=c(n,2),i=o[0],a=o[1];BeFunky.LanguageManager.addLanguageUpdateListener(t);var r=void 0;function s(e){return e.then(function(e){var t=e.data,n="paypal_subscr"===t.PaymentType;a({hasCancelledSubscription:1===t.iscancelled,isPaypalSubscriber:n&&BeFunky.isPlus(),billingCycle:t.billingCycle||"",nextBillingDate:new Date(t.nextbillingdate),packageName:t.packageName});var o,i,r=n?"PayPal Account: "+t.SubscrEmai:oi(Xo,t.last4,w("expiration_date"),(o=t.exp_month,i=t.exp_year,(o<10?"0"+o:o)+" / "+i));a({paymentInfo:r}),window.location.href.includes("openThanks=1")&&BeFunky.openThankYouPanel()}).catch(function(e){BeFunky.isPlus()?"user_not_plus"!==e&&"request_failed"!==e&&BeFunky.throwError("Unable to get customer data for Plus user",e):a({packageName:"Free"})}).then(function(){a({canUpgrade:!BeFunky.isPlus()})})}function l(){var e=F("username"),t=To(e,{title:"change_username",notification:"username_change_warning",fields:[{name:"username",label:"new_username",maxLength:100,errorMessage:"username_length",validate:function(e){return e.length>=4&&e.length<=100},sanitize:function(e){return e.replace(/[^a-zA-Z0-9_-]/g,"")}}],button:"update_username",onSubmit:function(t){var n=t.username;(function(e){return BeFunky.requestAPI("auth/update-username",{newName:e},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"})})(n).then(function(){a({username:n,canChangeUsername:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{user_name:n})),BeFunky.closeModal(e)}).catch(function(e){BeFunky.logError('Unable to change username to "'+n+'"',e),o({submissionErrors:[BeFunky.failureReason(e)]})})}}),n=t.teardown,o=t.setFormState;B(e,n)}function u(){var e=F("email"),t=To(e,{title:"change_email",fields:[{name:"email",label:"new_email",errorMessage:"error_invalid_email",validate:window.isEmailAddress,sanitize:function(e){return e.trim()}},{name:"email_confirmed",label:"confirm_email",errorMessage:"error_email_mismatch",validate:function(e,t){return e===t.email},sanitize:function(e){return e.trim()}},{name:"password",label:"password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:function(e){return e.length>=6}}],button:"update_email",onSubmit:function(t){var n=t.email,i=t.password;(function(e,t){var n={e:e,ea:e,pa:t};return BeFunky.requestAPI("auth/update-email",n,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";return{requiresEmailVerification:"1"!==e.social}})})(n,i).then(function(t){var o=t.requiresEmailVerification;a({email:n,isEmailVerified:o}),o&&window.setCookie("mailVerificationSend","",-1),window.updateUserStatus(Object.assign(window.latestUserData,{email:n})),BeFunky.closeModal(e)}).catch(function(e){BeFunky.logError('Unable to change email to "'+n+'"',e),o({submissionErrors:[BeFunky.failureReason(e)]})})}}),n=t.teardown,o=t.setFormState;B(e,n)}function d(){var e=F("password"),t=[{name:"new_password",label:"new_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:function(e){return e.length>=6}},{name:"new_password_confirmed",label:"confirm_password",type:"password",maxLength:100,errorMessage:"error_password_mismatch",validate:function(e,t){return e===t.new_password}}],n=To(e,{title:"change_password",fields:i.isSocialUser?t:[{name:"current_password",label:"current_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:function(e){return e.length>=6}}].concat(t),button:"change_password",onSubmit:function(t){(function(e,t){var n={np:e,npa:e};t&&(n.op=t);return BeFunky.requestAPI("auth/update-pwd",n,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"})})(t.new_password,t.current_password).then(function(){BeFunky.closeModal(e)}).catch(function(e){BeFunky.logError("Unable to change password",e),a({submissionErrors:[BeFunky.failureReason(e)]})})}}),o=n.teardown,a=n.setFormState;B(e,o)}function g(){BeFunky.openUpgradePanel(null,!0)}function h(){BeFunky.promptUserToUpgradeToYearly()}function m(){BeFunky.requestAPI("transaction/re-subscribe",{},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";a({hasCancelledSubscription:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{pl:"1"})),BeFunky.acknowledge("my_account_resubscribed")}).catch(function(e){BeFunky.logError("Unable to resubscribe user:",e)})}function f(){BeFunky.openPaymentPanel("","update")}function y(){(L?Promise.resolve(L):BeFunky.requestAPI("transaction/invoices",{},{showLoadScreen:!0}).then(function(e){if(!Array.isArray(e.data))throw"invalid_response";return L=e.data,e.data})).then(function(e){BeFunky.openModal(function(e){return si(Jo,e.map(function(e){return oi(Yo,e.date,function(e){return function(){return t=Object.assign(e,{email:i.email}),n="Invoice"+BeFunky.randomString(10),o=window.open("about:blank",n),a=function(e){var t=e.date,n=e.period_start,o=e.period_end,i=e.name,a=e.package_name,r=e.billing_cycle,s=e.charge,l=e.id,u=e.last4,c=e.email,d=Math.round(11/8.5*700),g="\n            .invoice {\n                position: relative;\n                max-width: 100%; \n                width: 700px; \n                min-height: "+d+"px; \n                margin: 0 auto; \n                background: white; \n                padding: 4rem;\n            }   \n            .print-button {\n                position: absolute;\n                top: 2rem;\n                right: 2rem;\n            }\n            @media print {\n                .print-button { display: none; }\n            }\n        ",h=document.createElement("style");h.appendChild(document.createTextNode(g));var m=document.createElement("style");m.appendChild(document.createTextNode([].concat(p(document.getElementById("inline-fonts").sheet.cssRules)).reduce(function(e,t){return e+t.cssText.replace(/url\("\//g,'url("'+BeFunky.Params.siteUrl)},"")));var f=document.querySelector('link[rel="stylesheet"][href*="screen"]').cloneNode();return f.href=f.href.replace(/^\//,BeFunky.Params.siteUrl),si(ei,f,m,h,BeFunky.Params.globalImagesPath,t,n===o?"":oi(ti,n,o),i,c,u,l,a,r,s,s,"")}(t),void(BeFunky.isEdgeHTML||BeFunky.isInternetExplorer||BeFunky.isFirefox?(o.document.title="BeFunky - "+t.date+" Invoice",o.document.write(a.outerHTML),o.document.close()):(o.document.title="BeFunky - "+t.date+" Invoice",o.document.body.appendChild(a)));var t,n,o,a}}(e),w("view"))}))}(e),{addSiteClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0})}).catch(function(e){BeFunky.throwError("Unable to fetch invoices",e)})}function v(){var e=si($o,w(["cancellation_prompt",{next_billing_date:E(i.nextBillingDate)}]),i.isPayPalSubscriber?oi(Ko,w("cancel_via_paypal")):"");BeFunky.confirm(e,{heading:"thank_you_befunky_titlecase",confirmText:i.isPayPalSubscriber?"open_paypal":"cancel_subscription",cancelText:"dont_cancel_subscription",size:"large",imageUrl:BeFunky.Params.globalImagesPath+"site/cancel-subscriptions.jpg",onConfirm:function(){if(i.isPayPalSubscriber)return window.open(S(),"_blank");BeFunky.requestAPI("transaction/cancel-subscr",{},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"}).then(function(){a({hasCancelledSubscription:!0}),BeFunky.acknowledge(["my_account_unsubscribed",{my_account_link:'<a href="'+BeFunky.Params.siteUrl+'my-account/">My Account</a>',plan_expiration_date:E(i.nextBillingDate)}])}).catch(function(e){BeFunky.throwError("Unable to cancel subscription",e)})}})}function _(){var e=document.getElementById("email_subscribe_newsletters"),t=document.getElementById("email_notifications_modal");e.checked=i.isEmailSubscriber,BeFunky.openModal(t,{addSiteClass:!0,addCloseButton:!0,size:"small"});var n=t.querySelector("form");n.submitHandled||(n.submitHandled=!0,n.addEventListener("submit",function(n){n.preventDefault();var o,i,r=e.checked;(o=r,i={em:"effects",is_:o?"0":"1"},BeFunky.requestAPI("auth/update-email-pref",i,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"})).then(function(){BeFunky.closeModal(t.id),a({isEmailSubscriber:r})}).catch(function(e){BeFunky.throwError("Unable to update email subscription",e)})}))}function k(){ui()}function b(){var e=si(Qo,w(["delete_account_first_paragraph",{email:'<a href="mailto:support@befunky.com">support@befunky.com</a>'}]),w("delete_account_second_paragraph"),w("delete_account_thanks"));BeFunky.confirm(e,{heading:"sorry_to_see_you_go",confirmText:"yes_delete_account",cancelText:"cancel",size:"medium",onConfirm:function(){BeFunky.requestAPI("auth/close-account-request",{},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"}).then(function(){BeFunky.acknowledge(si(Zo,w("delete_account_email_sent"),w("thank_you_befunky")),{heading:"sorry_see_you_go"})}).catch(function(e){BeFunky.throwError("Unable to send close account email",e)})}})}function w(e){return ri(e,"site")}function F(e){var t=document.createElement("div").setClass("modal form-modal");return t.id="modal_form_"+e,t}function B(e,t){BeFunky.openModal(e,{addSiteClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:t})}function E(e){return e instanceof Date?e.toLocaleDateString(BeFunky.LanguageManager.siteLanguage,{day:"numeric",month:"long",year:"numeric"}):e}function S(){return"https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias="+encodeURIComponent("tekin2@befunky.com")}function I(){return BeFunky.requestAPI("transaction/customer")}function C(e){BeFunky.showNotification({message:e,type:"success"}),a({isEmailVerified:!0}),BeFunky.pushRoute("my-account")}BeFunky.isPlus()&&(r=I()),window.initialUserStatus.then(function(e){var t=e.data;if(!BeFunky.isLoggedIn())return window.onbeforeunload=null,void(window.location.href=BeFunky.Params.siteUrl+"sign-in/?next="+encodeURIComponent(window.location.href));t||console.log("No user data, but user detected as logged in?",JSON.stringify(e));var n="1"===t.isMailVerified;a({email:t.email,username:t.user_name,isEmailVerified:n,canChangeUsername:t.can_change_user_name,isEmailSubscriber:t.is_subscribe_newsletter,isSocialUser:1===t.isSocialUser});var o,i=BeFunky.getUrlParameter("mv");i?n?C("email_already_verified"):(o=i,BeFunky.requestAPI("auth/verify-email",{mv:o},{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";return C("email_successfully_verified")}).catch(function(e){return"logged_out_reload_page"===e?window.location.reload():"already_verified"===e?C("email_already_verified"):void BeFunky.throwError("Unable to verify email:",e)})):n||BeFunky.showNotification({message:"please_verify_email",button:{text:"send_verification_email",onClick:ui},type:"warning"}),r||(r=BeFunky.isPlus()?I():Promise.reject("not_plus_user")),s(r).then(function(){a({isLoading:!1})})}),BeFunky.updateMyAccountPageAfterUpgrade=function(){a({isLoading:!0}),s(I()).then(function(){return a({isLoading:!1})})};var L=void 0}function ui(){var e=!!window.getCookie("mailVerificationSend");if(BeFunky.Params.IS_LC&&(e=!0),e)return BeFunky.confirm("confirm_resend_verification_email",{onConfirm:t,confirmText:"resend_email"});function t(){BeFunky.requestAPI("auth/send-verify-email",{},{showLoadScreen:!0}).then(function(e){if(!e.userEmail)throw"invalid_response";BeFunky.acknowledge("verification_email_sent")}).catch(function(e){BeFunky.logError("Unable to verify email",e),"not_user"===e?BeFunky.acknowledge("error_email_not_registered"):BeFunky.acknowledge(BeFunky.failureReason(e))})}t()}BeFunky.sendVerificationEmail=ui,BeFunky.onDocumentReady(function(){var e=document.getElementById("my_account");e&&li(e.querySelector(".my-account__inner"))});var ci=d(['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner"></div>\n            </div>\n        </div>\n        '],['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner"></div>\n            </div>\n        </div>\n        ']),di=d(['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <h1 class="close-account__heading h2">',"</h1>\n                <p>",'</p>\n                <div class="close-account__buttons button-group">\n                    <button id="close_account_no" class="button button--x-large button--dark-blue" @click=',">",'</button>\n                    <button id="close_account_yes" class="button button--x-large button--light-grey" @click=',">","</button>\n                </div>\n            </div>\n        </div>\n        "],['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <h1 class="close-account__heading h2">',"</h1>\n                <p>",'</p>\n                <div class="close-account__buttons button-group">\n                    <button id="close_account_no" class="button button--x-large button--dark-blue" @click=',">",'</button>\n                    <button id="close_account_yes" class="button button--x-large button--light-grey" @click=',">","</button>\n                </div>\n            </div>\n        </div>\n        "]),pi=d(["\n        <div>\n            <p>","</p>\n            <p>","</p>\n        </div>\n        "],["\n        <div>\n            <p>","</p>\n            <p>","</p>\n        </div>\n        "]),gi=BeFunky.lit,hi=gi.html,mi=gi.setupState,fi=gi.render,yi=gi.lang,vi=gi.elem;function _i(e){var t=BeFunky.debounce(function(){return fi(i.isLoading?hi(ci):hi(di,u("permanently_close_account"),u("delete_your_account"),s,u("no_close_account"),l,u("yes_close_account")),e)},"raf"),n=mi({isLoading:!0},t),o=c(n,2),i=o[0],a=o[1];BeFunky.LanguageManager.addLanguageUpdateListener(t);var r=BeFunky.getUrlParameter("q");function s(){BeFunky.acknowledge("thanks_for_staying",{onAcknowledge:function(){window.location.href=BeFunky.Params.siteUrl}})}function l(){var e;e={closeKey:r},BeFunky.requestAPI("auth/close-account",e,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(g,2555)}).catch(function(e){BeFunky.throwError("Unable to close account",JSON.stringify({error:e})),h()})}function u(e){return yi(e,"site")}window.initialUserStatus.then(function(){var e;BeFunky.isLoggedIn()?(e={closeKey:r},BeFunky.requestAPI("auth/close-account-key-control",e).then(function(e){if("success"!==e.data)throw"invalid_response";a({isLoading:!1})}).catch(function(e){if("request_failed"!==e)return BeFunky.throwError("Unable to process close account",e),void(window.location.href=BeFunky.Params.siteUrl)})):window.location.href=BeFunky.Params.siteUrl+"sign-in/?next="+encodeURIComponent(window.location.href)});var d=!1,p=0;function g(){d||(d=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(function(e){d=!1;var t=parseInt(e.data.stepPercentageComplete)||0;if(t?p=t:p<100&&p++,BeFunky.showLoadScreen({message:"closing_account",progress:p}),1===parseInt(e.data.isFinished))return BeFunky.hideLoadScreen(),void BeFunky.acknowledge("account_deleted",{onAcknowledge:function(){window.location.href=BeFunky.Params.siteUrl+"sign-out/"}});setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(function(e){d=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:e})),h()}))}function h(){var e=vi(pi,u("error_close_account"),u(["error_please_refresh",{contact_support:function(){return'<a href="https://support.befunky.com/hc/en-us/requests/new">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}}]));BeFunky.acknowledge(e)}}BeFunky.onDocumentReady(function(){var e=document.getElementById("close_account");e&&_i(e)});var ki=d(['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner"></div>\n            </div>\n        </div>\n        '],['\n        <div class="section__inner">\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner"></div>\n            </div>\n        </div>\n        ']),bi=d(["\n        ",""],["\n        ",""]),wi=d(['\n            <section class="superstar">\n                <div class="superstar__header">\n                    <a href="/gallery/','/" class="superstar__thumbnail">\n                        <img src="','app/default-avatar.jpg" alt="','">\n                    </a>\n                    <h5><a href="/gallery/','/">','</a></h5>\n                </div>\n                <div class="superstar__images">\n                    <div class="superstar__left-column">\n                        <img src="','" alt="','" title="','" data-id="','">\n                    </div>\n                    <div class="superstar__right-column">\n                        <img src="','" alt="','" title="','" data-id="','">\n                        <img src="','" alt="','" title="','" data-id="','">\n                    </div>\n                </div>\n            </section>'],['\n            <section class="superstar">\n                <div class="superstar__header">\n                    <a href="/gallery/','/" class="superstar__thumbnail">\n                        <img src="','app/default-avatar.jpg" alt="','">\n                    </a>\n                    <h5><a href="/gallery/','/">','</a></h5>\n                </div>\n                <div class="superstar__images">\n                    <div class="superstar__left-column">\n                        <img src="','" alt="','" title="','" data-id="','">\n                    </div>\n                    <div class="superstar__right-column">\n                        <img src="','" alt="','" title="','" data-id="','">\n                        <img src="','" alt="','" title="','" data-id="','">\n                    </div>\n                </div>\n            </section>']),Fi=BeFunky.lit,Bi=Fi.html,Ei=Fi.setupState,Si=Fi.render;Fi.lang;function Ii(e){var t=BeFunky.debounce(function(){return Si(i.isLoading?Bi(ki):Bi(bi,i.superStars.map(function(e){return Bi(wi,e.username,BeFunky.Params.globalImagesPath,e.username,e.username,e.username,e.images[0].url,e.images[0].title,e.images[0].title,e.images[0].id,e.images[1].thumb_url,e.images[1].title,e.images[1].title,e.images[1].id,e.images[2].thumb_url,e.images[2].title,e.images[2].title,e.images[2].id)})),e)},"raf"),n=Ei({isLoading:!0,superStars:[]},t),o=c(n,2),i=o[0],a=o[1];BeFunky.requestAPI("photo/superstars",{}).then(function(e){if(!Array.isArray(e.data))throw"invalid_request";var t=e.data;a({superStars:t,isLoading:!1})}).catch(function(e){"request_failed"!==e&&BeFunky.throwError("Unable to fetch Superstars",e)})}BeFunky.onDocumentReady(function(){document.getElementById("superstars")&&Ii(document.getElementById("superstars_gallery"))});var Ci=d(['\n        <h1 class="reset-password__heading h2">',"</h1>\n        <p>","</p>\n        <p>","</p>\n        "],['\n        <h1 class="reset-password__heading h2">',"</h1>\n        <p>","</p>\n        <p>","</p>\n        "]),Li=d(["\n            <div></div>"],["\n            <div></div>"]),Pi=d(['\n        <h1 class="reset-password__heading h2">Reset Password</h1>\n        ',"\n        "],['\n        <h1 class="reset-password__heading h2">Reset Password</h1>\n        ',"\n        "]),xi=d(['\n         <h1 class="reset-password__heading h2">','</h1>\n         <a href="/sign-in/" class="button button--dark-blue button--x-large" style="margin: 0 auto; display: inline-block;">',"</a>\n        "],['\n         <h1 class="reset-password__heading h2">','</h1>\n         <a href="/sign-in/" class="button button--dark-blue button--x-large" style="margin: 0 auto; display: inline-block;">',"</a>\n        "]),Ai=BeFunky.lit,Ti=Ai.html,Ri=Ai.setupState,Mi=Ai.render,Di=Ai.lang,Ui=Ai.elem;function Oi(e){var t=BeFunky.debounce(function(){return Mi(function(){if(i.hasBeenReset)return Ti(xi,s("password_updated"),s("sign_in"));return i.linkIsValid?(o=Ui(Li),l=To(o,{title:"",fields:[{name:"pass",label:"new_password",maxLength:100,errorMessage:"register_modal_password_error",type:"password",validate:function(e){return e.length>=6}},{name:"passAgain",label:"confirm_password",maxLength:100,errorMessage:"error_password_mismatch",type:"password",validate:function(e,t){var n=t.pass;return e===n}}],button:"reset_password",onSubmit:function(e){var t,n,o,i,s=e.pass,l=e.passAgain;(t=r,n=s,o=l,i={qKey:t,pass:n,passAgain:o},BeFunky.requestAPI("auth/reset-pass",i,{showLoadScreen:!0}).then(function(e){if("success"!==e.data)throw"invalid_response"})).then(function(){a({hasBeenReset:!0})}).catch(function(e){u({submissionErrors:[BeFunky.failureReason(e)]}),"request_failed"!==e&&BeFunky.throwError("Unable to reset password",e)})}},{formClass:"reset-password__form"}),l.teardown,u=l.setFormState,Ti(Pi,o)):(e=BeFunky.Params.siteUrl+"sign-in/",t=s(["reset_password_link_options",{send_new_link:function(){return'<a href="'+e+'?opn=fp">'+BeFunky.LanguageManager.getString("send_new_link")+"</a>"},sign_in_lowercase:function(){return'<a href="'+e+'">'+BeFunky.LanguageManager.getString("sign_in_lowercase")+"</a>"}}]),n=s(["reset_password_support",{contact_support:function(){return'<a href="https://support.befunky.com/hc/en-us/requests/new">'+BeFunky.LanguageManager.getString("contact_support")+"</a>"}}]),Ti(Ci,s("reset_password_link_invalid"),t,n));var e,t,n;var o,l,u}(),e)},"raf"),n=Ri({linkIsValid:!1,hasBeenReset:!1,operationFailed:!1},t),o=c(n,2),i=o[0],a=o[1];BeFunky.LanguageManager.addLanguageUpdateListener(t);var r=BeFunky.getUrlParameter("q");function s(e){return Di(e,"site")}r.match(/^[0-9a-f]{40}$/i)?(window.initialUserStatus.then(function(){BeFunky.isLoggedIn()&&BeFunky.signOut(window.location.href)}),a({linkIsValid:!0})):a({linkIsValid:!1})}BeFunky.onDocumentReady(function(){document.getElementById("reset_password")&&Oi(document.getElementById("password_reset_content"))});var Ni=d(['\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner save-image__size-spinner"></div>\n            </div>\n        '],['\n            <div class="section__text section__text--centered">\n                <div class="loading-spinner save-image__size-spinner"></div>\n            </div>\n        ']),Hi=d(['\n            <div class="section__text section__text--centered">\n                <h3>No results for ',"</h3>\n            </div>\n        "],['\n            <div class="section__text section__text--centered">\n                <h3>No results for ',"</h3>\n            </div>\n        "]),ji=d(['\n            <div class="section__text section__text--centered">\n                <h3>Unable to retrieve posts</h3>\n            </div>\n        '],['\n            <div class="section__text section__text--centered">\n                <h3>Unable to retrieve posts</h3>\n            </div>\n        ']),qi=d(['\n            <div class="section__grid section__grid--3-per-row section__grid--has-at-least-2 section__grid--has-at-least-3">\n                ',';\n        \x3c!-- View More Button --\x3e\n        </div>\n        <div class="section__text section__text--centered">\n            <div class="section__buttons button-group">\n                <button @click=',' ?disabled="','" \n                class="button button--grey blog__view-more \n                ','\n                ">View More</button>\n            </div>\n        </div>'],['\n            <div class="section__grid section__grid--3-per-row section__grid--has-at-least-2 section__grid--has-at-least-3">\n                ',';\n        \x3c!-- View More Button --\x3e\n        </div>\n        <div class="section__text section__text--centered">\n            <div class="section__buttons button-group">\n                <button @click=',' ?disabled="','" \n                class="button button--grey blog__view-more \n                ','\n                ">View More</button>\n            </div>\n        </div>']),Vi=d(['<a href="',"learn/",'/" class="section__grid-item grid-item grid-item--3 grid-item--link">\n                    <figure class="grid-item__figure grid-item__figure--blog">\n                        <img src="http://editors.befunky.com/wp-content/uploads/','" class="blog__search-result-image grid-item__image--blog" alt="','">\n                    </figure>\n                <div class="grid-item__text">\n                    <h3 class="grid-item__heading h6">',"</h3>\n                    ","\n                </div>\n            </a>"],['<a href="',"learn/",'/" class="section__grid-item grid-item grid-item--3 grid-item--link">\n                    <figure class="grid-item__figure grid-item__figure--blog">\n                        <img src="http://editors.befunky.com/wp-content/uploads/','" class="blog__search-result-image grid-item__image--blog" alt="','">\n                    </figure>\n                <div class="grid-item__text">\n                    <h3 class="grid-item__heading h6">',"</h3>\n                    ","\n                </div>\n            </a>"]),Gi=BeFunky.lit,Wi=Gi.html,zi=Gi.setupState,Xi=Gi.render;function Ji(){var e=this,t=document.getElementById("blog_search_results"),n=BeFunky.debounce(function(){return Xi(function(){if(a.isLoading)return Wi(Ni);if(0===a.posts.length)return Wi(Hi,a.searchTerm);if(a.cannotRetrievePosts)return Wi(ji);return Wi(qi,a.posts.map(function(e){var t=Wi([e.excerpt.rendered]);return Wi(Vi,BeFunky.Params.siteUrl,e.slug,e["featured-image"].file,e["featured-image"].alt,e.title.rendered,t)}),l,a.viewMoreDisabled,1===a.totalPages||a.pageNumber>a.totalPages?"blog__view-more--hidden":"")}(),t)},"raf"),o=zi({isLoading:!0,posts:[],searchTerm:"",pageNumber:1,totalPages:1,viewMoreDisabled:!1,cannotRetrievePosts:!1},n),i=c(o,2),a=i[0],r=i[1];function s(e){var t=[];return new Promise(function(n,o){var i="https://editors.befunky.com/wp-json/wp/v2/posts?search="+e+"&per_page=12&page="+a.pageNumber,s=BeFunky.request(i,{},function(i){var l=i.error,u=i.response;l&&o(),0===u.length&&r({isLoading:!1,posts:u,searchTerm:e});var c=s.getResponseHeader("X-WP-TotalPages");if(t.push.apply(t,p(u)),a.pageNumber<=a.totalPages){var d=a.pageNumber;r({pageNumber:++d,totalPages:parseInt(c)}),n(t)}})})}function l(){r({viewMoreDisabled:!0}),s(a.searchTerm).then(function(e){r({posts:[].concat(p(a.posts),p(e)),viewMoreDisabled:!1})}).catch(function(){r({cannotRetrievePosts:!0})})}this.init=function(){this.initPublicAPI(),this.initSearchForm()},this.initSearchForm=function(){this.searchInput=document.querySelector(".search-box__input")},this.initPublicAPI=function(){var e=this;BeFunky.blogSearchResults.isAvailable=!0,BeFunky.blogSearchResults.search=function(t){return r({isLoading:!0,pageNumber:1,totalPages:1}),s(t).then(function(n){document.title='Search results for "'+t+'"',e.updateDom(t,n)}).catch(function(){r({cannotRetrievePosts:!0})})}},this.updateDom=function(t,n){document.querySelector("#blog_search h1").textContent="Results for: "+t,e.searchInput.value=t,r({isLoading:!1,posts:n,searchTerm:t})},this.init()}BeFunky.blogSearchResults={search:function(){BeFunky.throwError("Blog search results not available")},isAvailable:!1},BeFunky.onDocumentReady(function(){var e=document.getElementById("blog_search_results");e&&Ji.call(e)}),BeFunky.blogSearchInput={search:function(){BeFunky.throwError("Blog search not available")},isAvailable:!1},BeFunky.onDocumentReady(function(){var e=document.getElementById("blog_search");e&&function(){var e=this;this.init=function(){this.initPublicAPI(),this.initSearchForm()},this.initPublicAPI=function(){BeFunky.blogSearchInput.isAvailable=!0},this.initSearchForm=function(){var e=this;this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.searchAutocomplete=this.querySelector(".blog__search-autocomplete"),this.searchForm.addEventListener("submit",this.submitSearch),this.searchButton.addEventListener("click",this.submitSearch),this.clearButton.addEventListener("click",function(){return setTimeout(function(){return e.searchInput.focus()},0)}),BeFunky.autocomplete(this.searchAutocomplete,{inputElement:this.searchInput,options:window.wordpressTagData.map(function(e){return{label:e}}),selectFirstItem:!1,onSelect:function(e){var t=e.label;return BeFunky.pushRoute("/learn/tag/"+t)}})},this.submitSearch=function(t){t.preventDefault();var n=e.searchInput.value;BeFunky.pushRoute("/learn/search/"+n)},this.init()}.call(e)}),window.logLang=function(){console.log("Language:",Object.assign({},BeFunky.LanguageManager.language,{flash:BeFunky.Params.swfFlashVars.language,cookie:getCookie("lang")}))},window.rebuildVersion=6}();

//# sourceMappingURL=befunky.core.js.map
